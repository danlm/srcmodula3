%!PS-Adobe-2.0
%%Creator: dvips 5.55 Copyright 1986, 1994 Radical Eye Software
%%Title: stablegen.dvi
%%CreationDate: Thu Jan 19 14:32:06 1995
%%Pages: 74
%%PageOrder: Ascend
%%BoundingBox: 0 0 612 792
%%DocumentFonts: Times-Bold Times-Roman Courier Times-Italic
%%EndComments
%DVIPSCommandLine: dvips stablegen.dvi
%DVIPSParameters: dpi=300, comments removed
%DVIPSSource:  TeX output 1995.01.19:1431
%%BeginProcSet: tex.pro
/TeXDict 250 dict def TeXDict begin /N{def}def /B{bind def}N /S{exch}N
/X{S N}B /TR{translate}N /isls false N /vsize 11 72 mul N /hsize 8.5 72
mul N /landplus90{false}def /@rigin{isls{[0 landplus90{1 -1}{-1 1}
ifelse 0 0 0]concat}if 72 Resolution div 72 VResolution div neg scale
isls{landplus90{VResolution 72 div vsize mul 0 exch}{Resolution -72 div
hsize mul 0}ifelse TR}if Resolution VResolution vsize -72 div 1 add mul
TR[matrix currentmatrix{dup dup round sub abs 0.00001 lt{round}if}
forall round exch round exch]setmatrix}N /@landscape{/isls true N}B
/@manualfeed{statusdict /manualfeed true put}B /@copies{/#copies X}B
/FMat[1 0 0 -1 0 0]N /FBB[0 0 0 0]N /nn 0 N /IE 0 N /ctr 0 N /df-tail{
/nn 8 dict N nn begin /FontType 3 N /FontMatrix fntrx N /FontBBox FBB N
string /base X array /BitMaps X /BuildChar{CharBuilder}N /Encoding IE N
end dup{/foo setfont}2 array copy cvx N load 0 nn put /ctr 0 N[}B /df{
/sf 1 N /fntrx FMat N df-tail}B /dfs{div /sf X /fntrx[sf 0 0 sf neg 0 0]
N df-tail}B /E{pop nn dup definefont setfont}B /ch-width{ch-data dup
length 5 sub get}B /ch-height{ch-data dup length 4 sub get}B /ch-xoff{
128 ch-data dup length 3 sub get sub}B /ch-yoff{ch-data dup length 2 sub
get 127 sub}B /ch-dx{ch-data dup length 1 sub get}B /ch-image{ch-data
dup type /stringtype ne{ctr get /ctr ctr 1 add N}if}B /id 0 N /rw 0 N
/rc 0 N /gp 0 N /cp 0 N /G 0 N /sf 0 N /CharBuilder{save 3 1 roll S dup
/base get 2 index get S /BitMaps get S get /ch-data X pop /ctr 0 N ch-dx
0 ch-xoff ch-yoff ch-height sub ch-xoff ch-width add ch-yoff
setcachedevice ch-width ch-height true[1 0 0 -1 -.1 ch-xoff sub ch-yoff
.1 sub]{ch-image}imagemask restore}B /D{/cc X dup type /stringtype ne{]}
if nn /base get cc ctr put nn /BitMaps get S ctr S sf 1 ne{dup dup
length 1 sub dup 2 index S get sf div put}if put /ctr ctr 1 add N}B /I{
cc 1 add D}B /bop{userdict /bop-hook known{bop-hook}if /SI save N @rigin
0 0 moveto /V matrix currentmatrix dup 1 get dup mul exch 0 get dup mul
add .99 lt{/QV}{/RV}ifelse load def pop pop}N /eop{SI restore showpage
userdict /eop-hook known{eop-hook}if}N /@start{userdict /start-hook
known{start-hook}if pop /VResolution X /Resolution X 1000 div /DVImag X
/IE 256 array N 0 1 255{IE S 1 string dup 0 3 index put cvn put}for
65781.76 div /vsize X 65781.76 div /hsize X}N /p{show}N /RMat[1 0 0 -1 0
0]N /BDot 260 string N /rulex 0 N /ruley 0 N /v{/ruley X /rulex X V}B /V
{}B /RV statusdict begin /product where{pop product dup length 7 ge{0 7
getinterval dup(Display)eq exch 0 4 getinterval(NeXT)eq or}{pop false}
ifelse}{false}ifelse end{{gsave TR -.1 .1 TR 1 1 scale rulex ruley false
RMat{BDot}imagemask grestore}}{{gsave TR -.1 .1 TR rulex ruley scale 1 1
false RMat{BDot}imagemask grestore}}ifelse B /QV{gsave newpath transform
round exch round exch itransform moveto rulex 0 rlineto 0 ruley neg
rlineto rulex neg 0 rlineto fill grestore}B /a{moveto}B /delta 0 N /tail
{dup /delta X 0 rmoveto}B /M{S p delta add tail}B /b{S p tail}B /c{-4 M}
B /d{-3 M}B /e{-2 M}B /f{-1 M}B /g{0 M}B /h{1 M}B /i{2 M}B /j{3 M}B /k{
4 M}B /w{0 rmoveto}B /l{p -4 w}B /m{p -3 w}B /n{p -2 w}B /o{p -1 w}B /q{
p 1 w}B /r{p 2 w}B /s{p 3 w}B /t{p 4 w}B /x{0 S rmoveto}B /y{3 2 roll p
a}B /bos{/SS save N}B /eos{SS restore}B end
%%EndProcSet
%%BeginProcSet: texps.pro
TeXDict begin /rf{findfont dup length 1 add dict begin{1 index /FID ne 2
index /UniqueID ne and{def}{pop pop}ifelse}forall[1 index 0 6 -1 roll
exec 0 exch 5 -1 roll VResolution Resolution div mul neg 0 0]/Metrics
exch def dict begin Encoding{exch dup type /integertype ne{pop pop 1 sub
dup 0 le{pop}{[}ifelse}{FontMatrix 0 get div Metrics 0 get div def}
ifelse}forall Metrics /Metrics currentdict end def[2 index currentdict
end definefont 3 -1 roll makefont /setfont load]cvx def}def
/ObliqueSlant{dup sin S cos div neg}B /SlantFont{4 index mul add}def
/ExtendFont{3 -1 roll mul exch}def /ReEncodeFont{/Encoding exch def}def
end
%%EndProcSet
TeXDict begin 40258431 52099146 1000 300 300
(/tmp_mnt/shellgame/r/dlusers9/kalsow/pkg/m3/stablegen/doc/stablegen.dvi)
@start /Fa 137[18 21 12 16 16 1[21 21 21 30 12 18 1[12
21 21 1[18 21 18 21 21 10[25 2[21 25 1[25 8[30 1[25 30
9[14 58[{}27 41.666668 /Times-Italic rf /Fb 81[28 52[25
25 1[25 28 17 19 22 1[28 25 28 41 14 28 1[14 28 25 17
22 28 22 28 25 11[36 33 28 36 39 30 1[36 47 33 2[19 39
39 2[36 36 33 36 7[25 25 25 25 25 25 25 25 25 25 1[12
46[{}50 50.000000 /Times-Bold rf /Fc 48 122 df<00C18000E1C000E1C000E1C0
01C38001C3803FFFC07FFFF07FFFF0070E00070E00070E00070E000E1C000E1C000E1C00
FFFFC0FFFFC07FFF8038700038700038700070E00070E00030600014197D9816>35
D<0018007800F001C0038007000E000E001C001C0038003800700070007000E000E000E0
00E000E000E000E000E000E000E00070007000380038001C000E00070003000D21789C16
>40 D<06000700038001C000E00070007000700038003800380038003800380038003800
380038003800700070007000E000E001C00380038007000E001C007800F000C0000D217C
9C16>I<3078F878300505788416>46 D<00FC0003FF0007FF800E03C01E01C00E01C000
01C00001C0000380000F0001FE0003FC0001FE00000F0000038000038000038000038060
0380F00780E00700F01E007FFC003FF8000FE00012197D9816>51
D<0C1E1F1E0C00000000000000003078F878300812789116>58 D<3FFFC07FFFE07FFFE0
000000000000000000000000000000FFFFC0FFFFC07FFF80130B7D9116>61
D<000E00001F00001F00003B0000370000370000770000670000E70000E70000C70001C7
0001C70003870003870003878007FF8007FF800FFF800E03800E03801C03807F0FE0FF1F
E07F0FE013197F9816>65 D<0FFF001FFFC00FFFC00381E00700E00700F0070070070070
0700700700700E00700E00700E00700E00700E00700E00E01C00E01C01E01C01C01C03C0
1C07801C0F00FFFE00FFFC00FFF00014197F9816>68 D<07FFF80FFFFC07FFFC01C01C03
803803803803801803800003800003830007070007FF0007FF0007FF000707000706000E
00000E00300E00700E00700E00700E00707FFFE0FFFFE07FFFE016197F9816>I<0FFFFC
0FFFFE0FFFFE01C00E03801C03801C03800C03800003800003830007070007FF0007FF00
07FF000707000706000E00000E00000E00000E00000E00000E00007F8000FFC0007F8000
17197F9816>I<0FFFC00FFFE00FFFC00038000070000070000070000070000070000070
0000E00000E00000E00000E00000E00000E00001C00001C00001C00001C00001C00001C0
007FFE00FFFE007FFE0013197D9816>73 D<0FF8000FFC000FF80001C000038000038000
0380000380000380000380000700000700000700000700000700000700000E00000E0020
0E00700E00700E00700E00707FFFE0FFFFE07FFFE014197F9816>76
D<0FC07E0FE0FE0FE0FE03A1B80761700763700763700763700766700766700E66E00E6E
E00E6CE00E6CE00E78E00E78E01C31C01C01C01C01C01C01C01C01C01C01C07E07E0FE0F
E07E07E017197F9816>I<0FC0FE1FE1FF0FE0FE03A03807307007307007307007307007
30700730700E38E00E38E00E38E00E38E00E18E00E18E01C19C01C1DC01C1DC01C1DC01C
0DC01C0DC0FE0F80FF0F80FE078018197F9816>I<01FF8007FFC00FFFE01E01E01C00E0
1C00E03800E03800E03800E03800E07001C07001C07001C07001C07001C07001C0F00380
E00380E00380E00780F00700F80F00FFFE007FFC001FF80013197D9816>I<07FF800FFF
E007FFF001C0F00380780380380380380380380380380380700700F00701E007FFC007FF
8007FE000700000E00000E00000E00000E00000E00000E00007F8000FF80007F80001519
7F9816>I<0FFE001FFF800FFFC00383E00701E00700E00700E00700E00701E00701C00E
07800FFF800FFE000FFE000E07000E07001C07001C07001C07001C07101C07381C0770FE
07F0FF03E0FE01C015197F9816>82 D<007E3001FFF003FFF00781F00E00E01C00E01C00
601C00001C00000E00000FE00007FC0001FF00001F800003C00001C00001C00001C03001
C07001C0700380780F00FFFE00FFFC0047F00014197E9816>I<7FFFE07FFFF07FFFF070
7070E0E0E0E0E0E060E06000E00000E00000E00001C00001C00001C00001C00001C00001
C0000380000380000380000380000380000380003FE0003FF0003FE00014197C9816>I<
7F07F0FF8FF87F07F01C01C0380380380380380380380380380380380380700700700700
700700700700700700700700E00E00E00E00E00E00E01C00703C007878003FF0001FE000
07800015197C9816>I<7E03F0FF07F07E03F03801E03801C03801C03801C07003807003
8070038071E30071E70073E700736700736600776E00766E00766C0066EC006CCC006CD8
006CD80078F80078780070700014197C9816>87 D<FE0FC0FE1FE0FE0FC03C07001C0E00
1C1E001C1C001E38000E38000E70000E700006E00007C00007C000038000038000070000
0700000700000700000700000700003F80003FC0003F800013197B9816>89
D<07FF0007FF800FFF000E00000E00000E00000E00000E00001C00001C00001C00001C00
001C00001C00003800003800003800003800003800003800007000007000007000007000
00700000700000E00000E00000E00000FFE000FFF000FFE0001120789C16>91
D<07FF0007FF8007FF00000700000700000700000700000700000E00000E00000E00000E
00000E00000E00001C00001C00001C00001C00001C00001C000038000038000038000038
00003800003800007000007000007000FFF000FFF000FFE00011207F9C16>93
D<07F0001FFC001FFE001C0F0008070000070000070003FF001FFF003F0E00780E00E00E
00E00E00E01E00F03E007FFFC03FCFC01F07C012127D9116>97 D<7C00007E00007E0000
0E00001C00001C00001C00001C7C001DFE001FFF003F07803C03803803803803C03801C0
3801C0700380700380700380700700780F00783E00EFFC00E7F00063E00012197C9816>
I<00FE0003FF0007FF800F07001C0200380000700000700000700000E00000E00000F000
007006007807003C1E001FFC000FF80007E00011127C9116>I<0007C00007E00007E000
00E00001C00001C00001C001F1C007FDC00FFFC01F07803C038038038070038070038070
0380E00700E00700F00700700F00700F00783F003FFFC01FEFE00787C013197E9816>I<
00FC0003FE000FFF001F07803C03803801C07001C07FFFC07FFFC0FFFF80E00000700000
7003007803803C0F001FFF000FFC0003F00012127D9116>I<0003C0001FE0003FF00078
E000E04000E00000E0003FFF803FFFC03FFF8001C00001C00001C00001C00001C00001C0
00038000038000038000038000038000038000FFF800FFFC00FFF80014197E9816>I<00
3E3800FFFC01FFFE03C3CC0381C00701C00701C00701C007038007878003FF0007FE000E
F8000C00000E00000FFE000FFF801FFFC03C01E07000E07000E0E000E0E000E07001E07C
07C03FFF801FFE0007F800171C809116>I<0F80000FC0000FC00001C000038000038000
038000039F0003BF8003FFC007E1C00781C00701C00701C00701C00701C00E03800E0380
0E03800E03800E03800E0380FF8FE0FFCFF0FF8FE014197F9816>I<0030007800780030
00000000000000001FE01FF01FF000E000E000E000E000E000E001C001C001C001C001C0
01C0FFFEFFFEFFFE0F1A7C9916>I<0001800003C00003C0000180000000000000000000
00000001FF0001FF8001FF80000700000700000700000700000700000700000E00000E00
000E00000E00000E00000E00001C00001C00001C00001C00001C00001C00003800607800
F0F000FFE0007FC0003F000012237F9916>I<07F8000FFC0007FC00001C000038000038
0000380000380000380000380000700000700000700000700000700000700000E00000E0
0000E00000E00000E00000E0007FFF80FFFF807FFF8011197E9816>108
D<1E78F03FFDF81FFFF80F9F380F1E380E1C380E1C380E1C380E1C381C38701C38701C38
701C38701C38701C3870FE7CF8FF7EFCFE3C781612809116>I<1F1F003FBF801FFFC007
E1C00781C00701C00701C00701C00701C00E03800E03800E03800E03800E03800E0380FF
8FE0FFCFF0FF8FE014127F9116>I<00F80003FE000FFF001F0F803C07803803807001C0
7001C07001C0E00380E00380F00780700700780F007C3E003FFC001FF00007C00012127D
9116>I<07C3E00FEFF007FFF801F83C01E01C01C01C01C01E01C00E01C00E03801C0380
1C03801C03803803C07803C1F0077FE0073F80071F000700000700000700000E00000E00
000E00007FC000FFC0007FC000171B819116>I<00F8C003FCE00FFEE01F07C01C03C038
01C07001C07001C07001C0E00380E00380F00380700780700F807C1F803FFF001FF70007
C700000700000700000700000E00000E00000E00007FC000FFC0007FC0131B7E9116>I<
1FC1F01FE7F81FEFFC01DE1801F80001E00001E00001C00001C000038000038000038000
0380000380000380007FFC00FFFC007FFC0016127F9116>I<01F90007FF800FFF801E07
003807003803003C00001FE0000FF80001FE00000E00300700700700700700781E00FFFC
00FFF80047E00011127D9116>I<03000380070007000700FFFEFFFFFFFE0E000E000E00
0E000E000E001C001C041C0E1C0E1C1C1C3C1FF80FF007C010177C9616>I<7C1F00FE3F
807E1F801C07001C07001C07001C07001C07001C0700380E00380E00380E00380E00381E
00383E003FFF801FFFC00F8F8012127D9116>I<FF1FC0FF3FE0FF1FC03C0E001C0E001C
1C001C1C001C3C001C38001C38001C70000C70000EE0000EE0000EC0000FC0000F800007
000013127C9116>I<1FC7E03FCFF01FC7E0038F0003CE0001DC0001F80000F00000F000
00F00001F00003B800073C000F1C001E1E00FE3F80FF3FC0FE3F8014127E9116>120
D<1FE3F81FE7FC1FE3F80381C00381C003838003838003838001C70001C70001CE0001CE
0001CC0000DC0000D80000F80000F00000F00000E00000E00001C00001C000738000F780
00FF0000FE0000780000161B7F9116>I E /Fd 55 122 df<0007E1F0001C173800703C
3800E07C7801C0783001C0380001C0380001C038000380700003807000038070003FFFFF
0003807000038070000700E0000700E0000700E0000700E0000700E0000700E0000E01C0
000E01C0000E01C0000E01C0000E01C0000E01C0001C0380001C03C000FF8FF8001D1D7F
9C18>11 D<0007E0001C1000703800E07801C07801C03001C00001C00003800003800003
80003FFFF00380F00380700700E00700E00700E00700E00700E00700E00E01C00E01C00E
01C00E01C00E01C00E01C01C03801C03C0FF8FF0151D7F9C17>I<0007F07E00001C09C1
0000701F038000E03E078001C03C078001C03C030001C01C000001C01C00000380380000
038038000003803800003FFFFFFF000380380F0003803807000700700E000700700E0007
00700E000700700E000700700E000700700E000E00E01C000E00E01C000E00E01C000E00
E01C000E00E01C000E00E01C001C01C038001E01E03C00FF8FF9FF00211D7F9C23>14
D<18183C3C7C7C3434040404040808080810101010606080800E0C7C9C15>34
D<183C7C340404080810106080060C799C0C>39 D<000800100020004000800180030003
0006000E000C001C001800180038003000300070007000600060006000E000E000E000E0
00E000C000C000C000E000E000600060006000600030003000100008000C0004000D2A7B
9E10>I<0100008000C00040006000200030003000300018001800180018001800180018
00180018001800380038003800300030007000700060006000E000C000C0018001800300
030006000400080018003000600080000D2A809E10>I<00C000C000C000806083708F39
9C0FF003C003C00D603938E31CC30C030002000600060010127A9E15>I<387878380808
101020204080050C7D830C>44 D<7FF0FFE00C027F890E>I<7070F06004047C830C>I<0C
1E1C1C000000000000000000007070F06007127C910C>58 D<060F0E0E00000000000000
000000387878380808101020204080081A7D910C>I<3FFFFFE07FFFFFF0000000000000
0000000000000000000000000000000000000000000000000000FFFFFFE07FFFFFC01C0C
7D8F20>61 D<0000200000003000000070000000F0000000F0000001F0000001F8000002
78000002780000047800000478000008780000083C0000103C0000103C0000203C000020
3C0000403E0000401E0000FFFE0000801E0001001E0001001F0002000F0002000F000400
0F000C000F001E000F80FF807FF01C1D7F9C1F>65 D<0007F010001C0C300070026000C0
01E0038000E0070000E00E0000600E0000601C0000403C00004038000040780000007800
000078000000F0000000F0000000F0000000F0000000F0000000F0000080F00001007000
01007000010038000200380004001C0004000C001800060020000380C000007F00001C1E
7C9C1E>67 D<07FFFFE000F801E000F000E000F0004000F0004000F0004000F0004001E0
004001E0204001E0200001E0200001E0600001E0E00003FFC00003C0C00003C0400003C0
400003C0400003C040800780008007800080078001000780010007800300078006000F00
0E000F003E00FFFFFC001B1C7E9B1C>69 D<07FFFFC000F803C000F001C000F0008000F0
008000F0008000F0008001E0008001E0208001E0200001E0200001E0600001E0E00003FF
C00003C0C00003C0400003C0400003C0400003C040000780000007800000078000000780
000007800000078000000F0000000F800000FFF800001A1C7E9B1B>I<0007F010001C0C
300070026000C001E0038000E0070000E00E0000600E0000601C0000403C000040380000
40780000007800000078000000F0000000F0000000F0000000F000FFF0F0000F80F00007
80F0000F0070000F0070000F0038000F0038000F001C001F000C001E0006006600038182
00007E00001C1E7C9C21>I<07FF00F800F000F000F000F000F001E001E001E001E001E0
01E003C003C003C003C003C003C00780078007800780078007800F000F80FFF0101C7F9B
0F>73 D<07FFC000F80000F00000F00000F00000F00000F00001E00001E00001E00001E0
0001E00001E00003C00003C00003C00003C00003C00003C0040780040780040780040780
080780080780180F00380F00F0FFFFF0161C7E9B1A>76 D<07F800FF8000F8003C0000BC
00180000BC001000009E001000009F001000008F001000010F80200001078020000107C0
20000103C020000103E020000101E020000200F040000200F04000020078400002007840
0002003C400002003C400004001E800004001F800004000F800004000F80000400078000
04000780000C000300001E00010000FF80010000211C7F9B1F>78
D<0007F00000381C0000E00E0001C0030003800380070001C00E0001C01E0001E01C0000
E03C0000E0380000E0780000F0780000F0780000F0F00001E0F00001E0F00001E0F00001
E0F00003C0F00003C0F00003C0700007807000070078000F0038001E003C001C001C0038
000E00E0000383800000FE00001C1E7C9C20>I<07FFFC0000F80F0000F0038000F003C0
00F001C000F001C000F001C001E003C001E003C001E003C001E0038001E0070001E00E00
03C03C0003FFE00003C0000003C0000003C0000003C00000078000000780000007800000
0780000007800000078000000F0000000F800000FFF000001A1C7E9B1C>I<0FFFF80000
F80E0000F0078000F003C000F001C000F001E000F001E001E003C001E003C001E0038001
E0070001E00E0001E03C0003FFE00003C0780003C01C0003C01E0003C00E0003C00F0007
801E0007801E0007801E0007801E0007801E0007801E080F001E100F801E10FFF00E2000
0003C01D1D7E9B1F>82 D<003F0400C0CC0180380300380600180E00180E00180E00181E
00101E00001F00000F80000FF80007FF0003FF8001FFC0003FE00003E00001E00000E000
00E04000E04000E04000E04000C06001C0E00180F00300CC0E0083F800161E7E9C17>I<
1FFFFFF03C07C0F03007803020078020600780204007802040078020400F0020800F0020
000F0000000F0000000F0000000F0000001E0000001E0000001E0000001E0000001E0000
001E0000003C0000003C0000003C0000003C0000003C0000003C000000780000007C0000
1FFFE0001C1C7C9B1E>I<FFF01FF01F0007801E0003001E0002001E0002001E0002001E
0002003C0004003C0004003C0004003C0004003C0004003C000400780008007800080078
000800780008007800080078000800F0001000F000100070001000700020007000200038
004000380080001C0100000E0E000001F000001C1D7A9B1F>I<FFE1FFC0FF801F003E00
3E000F001E0018000F001E0018000F001E0010000F001E0030000F001E0020000F003E00
60000F802F00400007804F00C00007804F00800007808F01800007808F01000007810F01
000007C10782000003C20782000003C20784000003C60784000003C40788000003CC0788
000003C807D0000001F803D0000001F003E0000001F003E0000001E003C0000001E003C0
000001C00380000000C001800000008001000000291D7B9B2B>87
D<04040808101020202020404040404040B8B8F8F8787830300E0C779C15>92
D<07F0001C18001E0C001C0E00180E00000E00000E0001FE000F0E001C1C00301C00701C
00E01C40E01C40E03C40E05C80709D803F0E0012127D9115>97 D<3F00000F00000E0000
0E00000E00000E00000E00000E00001C00001C00001C00001C7C001D87001E01803C0180
3801C03800C03800E03800E03800E07001C07001C07001C0700380700300700600F00C00
CC380083E000131D7C9C17>I<00FE000307000E07801C07003806003800007000007000
00700000E00000E00000E000006000007002007004003008001C300007C00011127E9112
>I<0001F80000780000700000700000700000700000700000700000E00000E00000E000
F8E00386E00601E00C01C01801C03801C07001C07001C07001C0E00380E00380E0038060
0380700380300780300F001C378007C7E0151D7E9C17>I<01F8070C0C06180738033003
70037FFF7000E000E000E00060006002700430081C3007C010127E9112>I<000F800039
C00061C000E3C001C18001C00001C00001C0000380000380000380003FF8000380000380
000700000700000700000700000700000700000E00000E00000E00000E00000E00000E00
001C00001E0000FFC000121D7F9C0D>I<000038007CCC01871C0303080703800E03800E
03800E03800E03800E0700060600070C0009F0000800001800001800001FFE000FFF800F
FFC03001C06000C06000E0C000C0C000C0600180200300180E0007F000161C809215>I<
07E00001E00001C00001C00001C00001C00001C00001C000038000038000038000038F80
03B0C003C0E00780E00780E00700E00700E00700E00700E00E01C00E01C00E01C00E01C0
0E01C00E01C01C03801E03C0FF9FF0141D7F9C17>I<00C001C001C00180000000000000
00000000000000001F80078003800700070007000700070007000E000E000E000E000E00
0E001C001E00FF800A1D7F9C0C>I<000300070007000600000000000000000000000000
00007E001E000E001C001C001C001C001C001C0038003800380038003800380070007000
7000700070007060E0F0E0F1C063803E001025849C0D>I<07E00001E00001C00001C000
01C00001C00001C00001C0000380000380000380000381FC0380E00380C0070100070200
07080007100007300007F8000F38000E3C000E1C000E1E000E0E000E0F001C07001C0F80
FF9FE0161D7F9C16>I<07E001E001C001C001C001C001C001C003800380038003800380
03800700070007000700070007000E000E000E000E000E000E001C001E00FF800B1D7F9C
0C>I<1F8FC0FC00079061060003E0760700078078070007807807000700700700070070
0700070070070007007007000E00E00E000E00E00E000E00E00E000E00E00E000E00E00E
000E00E00E001C01C01C001E01E01E00FF8FF8FF8021127F9124>I<1F8F8007B0C003C0
E00780E00780E00700E00700E00700E00700E00E01C00E01C00E01C00E01C00E01C00E01
C01C03801E03C0FF9FF014127F9117>I<00FC000307000E01801C01C03800C03000C070
00E07000E07000E0E001C0E001C0E001C0600180600380700700380E001C180007E00013
127E9115>I<0FC7C003D87001E03803C01803801C03800C03800E03800E03800E07001C
07001C07001C0700380700300700600F00C00EC3800E3E000E00000E00000E00001C0000
1C00001C00001C0000FF8000171A809117>I<00F8200384600602E00C01C01801C03801
C07001C07001C07001C0E00380E00380E00380600380700380300780380F001C370007C7
00000700000700000700000E00000E00000E00000E00007FC0131A7E9116>I<1F9C07EE
03CF078E078C07000700070007000E000E000E000E000E000E001C001E00FFC010127F91
10>I<03F20C0E18061004300438043E001FE00FF007F8003C401C400C400C6018E010D0
608FC00F127F9110>I<020002000200060006000C001C003C00FFE01C001C0038003800
3800380038003800700070407040704070407080708031001E000B1A7C9910>I<FC1F80
3C07801C0380380700380700380700380700380700380700700E00700E00700E00700E00
701E00701E00703C00305E001F9F8011127C9117>I<FF07E03C03803C03001C02001C02
001C04001C08000E08000E10000E10000E20000F200007400007C0000780000700000300
0002000013127C9116>I<FF3FC7E03C0F0380380E0100380E03003C1F02001C1706001C
3704001C270C001C6308001C4318001EC390000E83B0000F83A0000F03E0000F01C0000E
01C0000E018000040180001B127C911E>I<1FE1FC0781E003808003C10001C20000E600
00EC00007800007000003800007C00009C00011E00020E000407000C07003C0780FE1FF0
16127F9116>I<0FF07E03C03803C03001C02001C02001C04001C08000E08000E10000E1
0000E20000F200007400007C000078000070000030000020000020000040000040007080
00F10000F30000E60000780000171A809116>I E /Fe 86 126 df<E038F078F078F078
F078F078F078F078E038E03860300D0B7C9816>34 D<0387000387000387000387000387
000387007FFFC0FFFFE0FFFFE0070E00070E00070E000E1C000E1C000E1C000E1C00FFFF
E0FFFFE07FFFC01C38001C38001C38001C38001C38001C380013197F9816>I<03800007
E0000FE0001E70001C70001C70001C70001CF7E01CE7E01DC7E00FC7000F8E000F0E001F
0E003F1C007B9C00739C00E1F800E1F800E0F0E0E0F0E071F8E07FFFC03F9FC01E070013
197F9816>38 D<30787C3C1C1C1C1C3878F0E040060D789816>I<00E001E0038007000E
001C001C0038003800700070007000E000E000E000E000E000E000E000E000E000700070
007000380038001C001C000E000700038001E000E00B217A9C16>I<C000E00070003800
1C000E000E000700070003800380038001C001C001C001C001C001C001C001C001C00380
03800380070007000E000E001C0038007000E000C0000A217B9C16>I<03800380038003
80E38EF39EFFFE3FF80FE00FE03FF8FFFEF39EE38E03800380038003800F127D9516>I<
00E00000E00000E00000E00000E00000E00000E00000E000FFFFE0FFFFE0FFFFE000E000
00E00000E00000E00000E00000E00000E00000E00013137F9516>I<387C7E7E3E0E1E1C
78F060070B798416>I<FFFF80FFFF80FFFF8011037E8D16>I<70F8F8F8700505788416>
I<000180000380000380000700000700000E00000E00001C00001C000038000038000070
0000700000E00000E00001C00001C0000380000380000700000700000E00000E00001C00
001C0000380000380000700000700000E00000E00000C0000011207E9C16>I<03E0000F
F8001FFC001E3C00380E00780F00700700700700E00380E00380E00380E00380E00380E0
0380E00380E00380F00780700700700700780F003C1E001E3C001FFC000FF80003E00011
197E9816>I<0300070007000F001F00FF00FF00E7000700070007000700070007000700
0700070007000700070007000700FFF8FFF8FFF80D197B9816>I<07E0001FF8003FFC00
783E00E00700F00780F00380600380000380000380000700000700000E00001C00003800
00700000E00001C0000380000F00001E03803803807FFF80FFFF807FFF8011197E9816>
I<07E0001FF8003FFC00781E00780700300700000700000700000E00003E0007FC0007F0
0007FC00001E00000700000300000380000380600380F00380E00700781E003FFC001FF8
0007E00011197E9816>I<007C0000FC0000DC0001DC00039C00039C00071C000F1C000E
1C001E1C003C1C00381C00781C00F01C00FFFFE0FFFFE0FFFFE0001C00001C00001C0000
1C00001C0001FFC001FFC001FFC013197F9816>I<00F80003FC0007FE000F07001C0F00
380F00780600700000700000E3F800EFFC00FFFE00F80F00F00700F00380E00380E00380
7003807003807007803807003C1E001FFC000FF80003E00011197E9816>54
D<E00000FFFF80FFFF80FFFF80E00F00E01E00001C0000380000780000700000E00000E0
0001C00001C00001C0000380000380000380000380000700000700000700000700000700
00070000070000111A7E9916>I<03E0000FF8001FFC003C1E00700E00700700E00700E0
0780E00380E00380E00780700780780F803FFF801FFB800FE38000070000070030070078
0E00781C00707C003FF8001FE0000F800011197E9816>57 D<70F8F8F870000000000000
000070F8F8F8700512789116>I<387C7C7C38000000000000000038787C7C3C1C1C3870
F0400618799116>I<000180000780001F80003E0000F80001F00007C0000F80003E0000
FC0000F00000FC00003E00000F800007C00001F00000F800003E00001F80000780000180
11157E9616>I<7FFFC0FFFFE0FFFFE0000000000000000000000000000000FFFFE0FFFF
E07FFFC0130B7F9116>I<C00000F00000FC00003E00000F800007C00001F00000F80000
3E00001F80000780001F80003E0000F80001F00007C0000F80003E0000FC0000F00000C0
000011157E9616>I<00E00001F00001F00001B00001B00003B80003B80003B800031800
071C00071C00071C00071C00071C000E0E000E0E000FFE000FFE001FFF001C07001C0700
1C07007E0FC0FF1FE07E0FC013197F9816>65 D<7FF800FFFE007FFF001C07001C07801C
03801C03801C03801C03801C07001FFF001FFE001FFE001C1F001C03801C03C01C01C01C
01C01C01C01C01C01C03C01C07807FFF80FFFF007FFC0012197F9816>I<01F18007FB80
0FFF801F0F803C0780380380700380700380F00000E00000E00000E00000E00000E00000
E00000E00000F000007003807003803803803C07001F0F000FFE0007FC0001F00011197E
9816>I<7FF800FFFE007FFF001C0F001C07801C03C01C01C01C01C01C01E01C00E01C00
E01C00E01C00E01C00E01C00E01C00E01C00E01C01C01C01C01C03C01C07801C0F807FFF
00FFFE007FF8001319809816>I<7FFFC0FFFFC07FFFC01C01C01C01C01C01C01C01C01C
00001C00001C1C001C1C001FFC001FFC001FFC001C1C001C1C001C00001C00E01C00E01C
00E01C00E01C00E07FFFE0FFFFE07FFFE013197F9816>I<7FFFE0FFFFE07FFFE01C00E0
1C00E01C00E01C00E01C00001C00001C1C001C1C001FFC001FFC001FFC001C1C001C1C00
1C00001C00001C00001C00001C00001C00007F8000FFC0007F800013197F9816>I<01F1
8007FB800FFF801F0F803C0780380380700380700380F00000E00000E00000E00000E000
00E01FC0E01FE0E01FC0F003807003807007803807803C07801E0F800FFF8007FB8001F3
8013197F9816>I<7F07F0FF8FF87F07F01C01C01C01C01C01C01C01C01C01C01C01C01C
01C01FFFC01FFFC01FFFC01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C
01C07F07F0FF8FF87F07F01519809816>I<7FFCFFFE7FFC038003800380038003800380
03800380038003800380038003800380038003800380038003807FFCFFFE7FFC0F197D98
16>I<01FF0003FF8001FF00001C00001C00001C00001C00001C00001C00001C00001C00
001C00001C00001C00001C00001C00001C00001C00001C00601C00F01C00F038007FF800
7FF0001FC00011197E9816>I<7F0FE0FF8FF07F0FE01C07801C0F001C0E001C1C001C3C
001C78001CF0001CE0001DF0001FF0001FF8001F38001E1C001C1C001C0E001C0E001C07
001C07001C03807F07E0FF8FF07F07E01419809816>I<FF8000FFC000FF80001C00001C
00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C
00001C00401C00E01C00E01C00E01C00E0FFFFE0FFFFE0FFFFE013197F9816>I<FC07E0
FE0FE0FE0FE03A0B803B1B803B1B803B1B803B1B803B1B803BBB8039B38039B38039B380
39B38039F38038E38038E380380380380380380380380380380380FE0FE0FE0FE0FE0FE0
13197F9816>I<7E07F0FF0FF87F07F01D81C01D81C01D81C01DC1C01CC1C01CE1C01CE1
C01C61C01C71C01C71C01C71C01C31C01C39C01C39C01C19C01C1DC01C0DC01C0DC01C0D
C07F07C0FF87C07F03C01519809816>I<1FFC003FFE007FFF00780F00F00780E00380E0
0380E00380E00380E00380E00380E00380E00380E00380E00380E00380E00380E00380E0
0380F00780F00780780F007FFF003FFE001FFC0011197E9816>I<7FF800FFFE007FFF00
1C0F801C03801C03C01C01C01C01C01C01C01C03C01C03801C0F801FFF001FFE001FF800
1C00001C00001C00001C00001C00001C00001C00007F0000FF80007F000012197F9816>
I<1FFC003FFE007FFF00780F00F00780E00380E00380E00380E00380E00380E00380E003
80E00380E00380E00380E00380E00380E00380E0E380E1E380F0F780787F007FFF003FFE
001FFC00001C00001E00000E00000F00000700000700111F7E9816>I<7FF000FFFC007F
FE001C0F001C07801C03801C03801C03801C03801C07801C0F001FFE001FFC001FFE001C
0E001C07001C07001C07001C07001C07101C07381C07387F03F0FF83F07F01E015198098
16>I<07E3001FFF003FFF00781F00F00700E00700E00700E00000F000007800003F8000
1FF00007FC0000FE00000F00000700000380000380600380E00380E00700F80F00FFFE00
FFFC00C7F00011197E9816>I<7FFFE0FFFFE0FFFFE0E0E0E0E0E0E0E0E0E0E0E0E000E0
0000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E0
0000E00000E00007FC000FFE0007FC0013197F9816>I<7F07F0FF8FF87F07F01C01C01C
01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C
01C01C01C01C01C00E03800E038007070007FF0003FE0000F8001519809816>I<FE0FE0
FE0FE0FE0FE03803803C07801C07001C07001C07001E0F000E0E000E0E000E0E000E0E00
071C00071C00071C00071C0003180003B80003B80003B80001B00001F00001F00000E000
13197F9816>I<7E03F0FF07F87E03F03800E03800E03800E03800E01C01C01C01C01C01
C01C71C01CF9C01CF9C01CD9C01CD9C00CD9800CD9800CD9800DDD800D8D800D8D800D8D
80078F00078F000707001519809816>I<7F1F807F3FC07F1F800E1E000E1C00071C0007
380003B80003F00001F00001E00000E00001E00001F00003F00003B80007B800071C000F
1C000E0E000E0E001C07007E0FC0FF1FE07E0FC013197F9816>I<FE0FE0FF1FE0FE0FE0
1C07001C07000E0E000E0E00071C00071C00071C0003B80003B80001F00001F00000E000
00E00000E00000E00000E00000E00000E00000E00003F80007FC0003F80013197F9816>
I<7FFF80FFFF80FFFF80E00700E00F00E01E00E01C00003C0000780000700000F00001E0
0001C00003C0000780000700000F00001E03801C03803C0380780380700380FFFF80FFFF
80FFFF8011197E9816>I<FFF0FFF0FFF0E000E000E000E000E000E000E000E000E000E0
00E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000FFF0FF
F0FFF00C20789C16>I<C00000E00000E000007000007000003800003800001C00001C00
000E00000E000007000007000003800003800001C00001C00000E00000E0000070000070
00003800003800001C00001C00000E00000E000007000007000003800003800001801120
7E9C16>I<FFF0FFF0FFF000700070007000700070007000700070007000700070007000
700070007000700070007000700070007000700070007000700070FFF0FFF0FFF00C207F
9C16>I<03000F803FE0FDF8F07840100D067C9816>I<FFFF80FFFF80FFFF8011037E7E16
>I<081C3C7870E0E0E0E0F0F87830060D789B16>I<1FE0003FF0007FF800783C00300E00
000E00000E0003FE001FFE003E0E00700E00E00E00E00E00E00E00783E007FFFE03FE7E0
0F83E013127E9116>I<FC0000FC0000FC00001C00001C00001C00001C00001C7C001DFE
001FFF001F07801E03C01C01C01C00E01C00E01C00E01C00E01C00E01C00E01C01C01E03
C01F07801FFF001DFE000C780013197F9816>I<03F80FFC1FFE3C1E780C7000E000E000
E000E000E000F000700778073E0E1FFC0FF803F010127D9116>I<003F00003F00003F00
00070000070000070000070003C7000FF7001FFF003C1F00780F00700700E00700E00700
E00700E00700E00700E00700700F00780F003C1F001FFFE00FF7E007C7E013197F9816>
I<03F0000FFC001FFE003C0F00780700700380E00380FFFF80FFFF80FFFF80E00000E000
007003807803803E07801FFF0007FE0001F80011127E9116>I<001E00007F0001FF8001
C7800383000380000380007FFF00FFFF00FFFF0003800003800003800003800003800003
80000380000380000380000380000380000380007FFC00FFFE007FFC0011197F9816>I<
03E3C007F7E00FFFE01C1CC0380E00380E00380E00380E00380E001C1C000FF8001FF000
1BE0003800001800001FFC001FFF003FFF807003C0E000E0E000E0E000E0E000E07001C0
7C07C03FFF800FFE0003F800131C7F9116>I<FC0000FC0000FC00001C00001C00001C00
001C00001C78001DFC001FFE001F0F001E07001C07001C07001C07001C07001C07001C07
001C07001C07001C07001C0700FF8FE0FF9FE0FF8FE013197F9816>I<03000780078003
000000000000000000FF80FF80FF80038003800380038003800380038003800380038003
800380FFFCFFFEFFFC0F1A7C9916>I<003000780078003000000000000000000FF81FF8
0FF800380038003800380038003800380038003800380038003800380038003800380038
003800386070F0F0FFE07FC03F800D237E9916>I<7E0000FE00007E00000E00000E0000
0E00000E00000E7FE00E7FE00E7FE00E0F000E1E000E3C000E78000EF0000FF0000FF800
0FBC000F1E000E0E000E07000E07807F87F0FFCFF07F87F01419809816>I<7FC000FFC0
007FC00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C0
0001C00001C00001C00001C00001C00001C00001C00001C0007FFF00FFFF807FFF001119
7E9816>I<F9C380FFEFC0FFFFE03C78E03C78E03870E03870E03870E03870E03870E038
70E03870E03870E03870E03870E0FE7CF8FE7CF8FE7CF81512809116>I<FC7800FDFC00
FFFE001F0F001E07001C07001C07001C07001C07001C07001C07001C07001C07001C0700
1C0700FF8FE0FF9FE0FF8FE013127F9116>I<03E0000FF8001FFC003C1E00780F007007
00E00380E00380E00380E00380E00380F00780700700780F003C1E001FFC000FF80003E0
0011127E9116>I<FC7C00FDFE00FFFF001F07801E03C01C01C01C00E01C00E01C00E01C
00E01C00E01C00E01C01C01E03C01F07801FFF001DFE001C78001C00001C00001C00001C
00001C00001C0000FF8000FF8000FF8000131B7F9116>I<03E3800FF3801FFB803E0F80
780780700780E00380E00380E00380E00380E00380E003807007807807803C1F801FFB80
0FF38003E380000380000380000380000380000380000380001FF0003FF8001FF0151B7F
9116>I<7F0FC0FF3FE07F7FE007F04007C0000780000780000700000700000700000700
000700000700000700000700007FFC00FFFC007FFC0013127F9116>I<0FEC3FFC7FFCF0
3CE01CE01C70007F801FF007F8003C600EE00EF00EF81EFFFCFFF8C7E00F127D9116>I<
0300000700000700000700000700007FFF00FFFF00FFFF00070000070000070000070000
07000007000007000007010007038007038007038007870003FE0001FC0000F80011177F
9616>I<FC3F00FC3F00FC3F001C07001C07001C07001C07001C07001C07001C07001C07
001C07001C07001C07001C1F001FFFE00FF7E007C7E013127F9116>I<7F1FC0FF9FE07F
1FC01C07001C07000E0E000E0E000E0E00071C00071C00071C00071C0003B80003B80003
B80001F00001F00000E00013127F9116>I<FF1FE0FF1FE0FF1FE0380380380380380380
38038039F38039F38019F30019B30019B30019B3001DB7001D17001F1F000F1E000E0E00
13127F9116>I<7F1FC07F3FC07F1FC00F1E00073C0003B80003F00001F00000E00001E0
0001F00003B800073C00071C000E0E007F1FC0FF3FE07F1FC013127F9116>I<7F1FC0FF
9FE07F1FC01C07000E07000E0E000E0E00070E00071C00071C00039C00039C0003980001
B80001B80000F00000F00000F00000E00000E00000E00001C00079C0007BC0007F80007F
00003C0000131B7F9116>I<3FFFC07FFFC07FFFC0700780700F00701E00003C00007800
01F00003E0000780000F00001E01C03C01C07801C0FFFFC0FFFFC0FFFFC012127F9116>
I<001F80007F8000FF8001E00001C00001C00001C00001C00001C00001C00001C00001C0
0001C00003C0007F8000FF0000FF00007F800003C00001C00001C00001C00001C00001C0
0001C00001C00001C00001C00001E00000FF80007F80001F8011207E9C16>I<E0E0E0E0
E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E00320779C16>I<7C
0000FF0000FF800003C00001C00001C00001C00001C00001C00001C00001C00001C00001
C00001E00000FF00007F80007F8000FF0001E00001C00001C00001C00001C00001C00001
C00001C00001C00001C00003C000FF8000FF00007C000011207E9C16>I
E /Ff 1 16 df<03C00FF01FF83FFC7FFE7FFEFFFFFFFFFFFFFFFF7FFE7FFE3FFC1FF80F
F003C010107E9115>15 D E /Fg 81[33 52[30 3[33 20 23 27
1[33 30 33 50 17 33 1[17 33 30 20 27 33 27 33 30 10[43
1[40 33 43 1[37 1[43 56 40 2[23 1[47 37 40 1[43 1[43
7[30 30 30 30 30 30 30 30 30 30 1[15 46[{}46 59.999973
/Times-Bold rf /Fh 139[29 1[38 1[48 7[48 2[38 3[43 29[62
15[43 43 43 49[{}10 86.416687 /Times-Bold rf /Fi 166[30
1[39 30 30 25 23 28 1[23 30 30 37 25 30 1[14 30 30 23
25 30 28 28 30 7[21 21 21 21 21 21 21 21 21 21 1[10 46[{.167 SlantFont}
33 41.666668 /Times-Roman rf /Fj 1 59 df<60F0F06004047C830C>58
D E /Fk 134[21 1[30 21 23 14 16 18 1[23 21 23 35 12 2[12
23 21 14 18 23 18 1[21 12[28 3[25 32 1[39 3[16 4[30 2[30
7[21 3[21 1[21 21 21 49[{}32 41.666668 /Times-Bold rf
/Fl 136[75 52 57 34 40 46 1[57 52 57 86 29 2[29 2[34
46 57 46 1[52 17[80 1[97 3[40 5[75 67[{}21 103.666679
/Times-Bold rf /Fm 134[25 25 25 1[25 25 25 25 25 25 25
25 25 25 25 25 25 25 25 25 25 25 25 25 25 9[25 25 1[25
25 25 1[25 1[25 25 25 1[25 25 1[25 25 25 25 25 1[25 6[25
25 25 25 25 25 25 25 25 25 2[25 1[25 2[25 25 2[25 2[25
34[{}57 41.666668 /Courier rf /Fn 69[18 8[21 1[23 23
3[18 47[18 21 21 30 21 21 12 16 14 21 21 21 21 32 12
21 12 12 21 21 14 18 21 18 21 18 7[30 1[39 30 30 25 23
28 30 23 30 30 37 25 30 1[14 30 30 23 25 30 28 28 30
3[23 1[12 12 21 21 21 21 21 21 21 21 21 21 1[10 14 10
2[14 14 14 39[{}73 41.666668 /Times-Roman rf /Fo 134[25
3[25 14 19 17 2[25 25 1[14 2[14 25 25 1[22 1[22 1[22
9[47 8[36 3[19 2[36 3[33 9[25 3[25 3[25 4[12 44[{}23
50.000000 /Times-Roman rf /Fp 139[24 28 32 1[40 36 40
60 20 1[24 20 40 36 24 32 1[32 40 36 13[40 3[56 5[28
1[56 71[{}21 72.000000 /Times-Bold rf end
%%EndProlog
%%BeginSetup
%%Feature: *Resolution 300dpi
TeXDict begin

%%EndSetup
%%Page: 1 1
1 0 bop 291 1070 a Fp(Implementation)16 b(of)i(the)f(Stable)g(Object)g
(Generator)874 1161 y(stablegen)654 1344 y Fo(Carsten)c(W)l(eich)182
b(Greg)12 b(Nelson)846 1464 y(January)h(19,)f(1995)p
eop
%%Page: 2 2
2 1 bop 58 141 a Fn(2)120 258 y(This)7 b(document)g(gives)f(a)i(short)e
(overview)g(of)h(the)f(implementation)g(of)g(the)h(stable)g(object)f
(generator)h Fm(stablegen)p Fn(.)58 307 y(See)k(\252Stable)g
(Objects\272)g(for)e(an)i(overview)f(of)g(stable)g(objects)g(and)g(the)
g(man)h(page)g(for)f(the)g(program)g(described)g(here.)p
eop
%%Page: 3 3
3 2 bop 145 590 a Fl(Contents)145 849 y Fk(1)42 b(Overview)1490
b(5)208 899 y Fn(1.1)43 b(List)10 b(of)g(modules)h Fj(:)21
b(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h
(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)
h(:)f(:)g(:)54 b Fn(5)208 950 y(1.2)43 b(m3make\256le)13
b Fj(:)20 b(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)
h(:)f(:)g(:)g(:)h(:)f(:)g(:)54 b Fn(6)145 1042 y Fk(2)42
b(Interfaces)1484 b(9)208 1093 y Fn(2.1)43 b(Interface)11
b(GenCode)22 b Fj(:)e(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h
(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)
f(:)g(:)g(:)h(:)f(:)g(:)54 b Fn(9)208 1144 y(2.2)43 b(Interface)11
b(GenModuleCode)21 b Fj(:)f(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h
(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)
h(:)f(:)g(:)54 b Fn(9)208 1194 y(2.3)43 b(Interface)11
b(GenT)m(ypeCode)37 b Fj(:)20 b(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)
g(:)g(:)h(:)f(:)g(:)35 b Fn(1)n(1)208 1245 y(2.4)43 b(Interface)11
b(T)m(ypeNames)k Fj(:)21 b(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h
(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)
f(:)g(:)g(:)h(:)f(:)g(:)35 b Fn(1)n(1)208 1295 y(2.5)43
b(Interface)11 b(AstT)m(oT)m(ype)28 b Fj(:)21 b(:)f(:)g(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)
g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)33 b Fn(12)208
1346 y(2.6)43 b(Interface)11 b(ImportList)32 b Fj(:)21
b(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)
33 b Fn(12)208 1396 y(2.7)43 b(Interface)11 b(StablegenAr)o(gs)32
b Fj(:)20 b(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)
33 b Fn(13)208 1447 y(2.8)43 b(Interface)11 b(T)m(ype)32
b Fj(:)21 b(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)
g(:)g(:)h(:)f(:)g(:)33 b Fn(13)208 1497 y(2.9)43 b(Interface)11
b(V)-5 b(alue)20 b Fj(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)
f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)33 b Fn(17)208 1548
y(2.10)22 b(Interface)11 b(V)-5 b(alueProc)41 b Fj(:)21
b(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)
33 b Fn(17)208 1598 y(2.1)n(1)24 b(Interface)11 b(FRefRefTbl)f
Fj(:)21 b(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)
f(:)g(:)33 b Fn(18)208 1649 y(2.12)22 b(Interface)11
b(StablegenError)24 b Fj(:)c(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)
g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)g(:)h(:)f(:)g(:)33 b Fn(18)145 1741 y Fk(3)42 b(Implementation)9
b(Modules)1193 b(19)208 1792 y Fn(3.1)43 b(Module)10
b(Main)i Fj(:)20 b(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)
g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)33 b Fn(19)303 1842 y(3.1.1)50
b(Procedure)11 b(DoRun)33 b Fj(:)20 b(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h
(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)
f(:)g(:)g(:)h(:)f(:)g(:)33 b Fn(19)303 1893 y(3.1.2)50
b(Startup)18 b Fj(:)j(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)
g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)33 b Fn(20)208 1943 y(3.2)43
b(Module)10 b(GenCode)40 b Fj(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)
f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h
(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)33 b Fn(20)303
1994 y(3.2.1)50 b(List)10 b(of)g(additional)e(Imports)36
b Fj(:)21 b(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)33
b Fn(21)303 2044 y(3.2.2)50 b(Procedure)11 b(Do)39 b
Fj(:)20 b(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)
g(:)33 b Fn(21)303 2095 y(3.2.3)50 b(Procedure)11 b(CheckStableT)m(ype)
24 b Fj(:)c(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)33 b Fn(25)303
2146 y(3.2.4)50 b(Procedure)11 b(CheckBrands)27 b Fj(:)20
b(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)33 b Fn(25)303
2196 y(3.2.5)50 b(Procedure)11 b(GenStableImpl)31 b Fj(:)21
b(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)33 b Fn(26)303
2247 y(3.2.6)50 b(Procedure)11 b(BuildMethods)g Fj(:)20
b(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)33 b Fn(27)208
2297 y(3.3)43 b(Module)10 b(GenModuleCode)39 b Fj(:)20
b(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)33
b Fn(29)303 2348 y(3.3.1)50 b(Name)11 b(preambles)22
b Fj(:)e(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)
h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)33
b Fn(30)303 2398 y(3.3.2)50 b(Utility)8 b(procedures)i(and)g
(abreviations)39 b Fj(:)20 b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)
g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)33 b
Fn(30)303 2449 y(3.3.3)50 b(Generate)11 b(procedure)f(calls)18
b Fj(:)i(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)
f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)33
b Fn(30)303 2499 y(3.3.4)50 b(Procedure)11 b(Header)35
b Fj(:)20 b(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h
(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)33
b Fn(31)1007 2604 y(3)p eop
%%Page: 4 4
4 3 bop 58 141 a Fn(4)1506 b Fi(CONTENTS)216 258 y Fn(3.3.5)50
b(Procedure)10 b(Revealation)20 b Fj(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)
f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)33 b Fn(32)216 307 y(3.3.6)50 b(Procedure)10
b(Surrogates)41 b Fj(:)21 b(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)
g(:)33 b Fn(33)216 357 y(3.3.7)50 b(Procedure)10 b(SurrBody)24
b Fj(:)c(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)
f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)33
b Fn(34)216 407 y(3.3.8)50 b(Procedure)10 b(Dispatcher)39
b Fj(:)21 b(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)33
b Fn(36)216 457 y(3.3.9)50 b(Procedure)10 b(ReplayStubs)41
b Fj(:)20 b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)33
b Fn(37)216 507 y(3.3.10)c(Procedure)10 b(Checkpoint)26
b Fj(:)21 b(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)33
b Fn(38)216 557 y(3.3.1)n(1)e(Marshalling)9 b(Procedures)35
b Fj(:)20 b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)33
b Fn(39)216 606 y(3.3.12)c(De\256ne)11 b(the)f(signature)f(of)h(replay)
g(stubs)34 b Fj(:)21 b(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)33 b Fn(44)120
656 y(3.4)44 b(Module)9 b(GenT)m(ypeCode)23 b Fj(:)e(:)f(:)g(:)g(:)h(:)
f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)33 b Fn(45)216
706 y(3.4.1)50 b(Produce)10 b(type)g(speci\256cation)g(text)16
b Fj(:)k(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)
g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)33 b Fn(45)216
756 y(3.4.2)50 b(Procedure)10 b(ProcHeader)24 b Fj(:)d(:)f(:)g(:)h(:)f
(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)
f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)33 b Fn(48)216 806 y(3.4.3)50
b(Procedure)10 b(QidT)m(oT)m(ext)40 b Fj(:)21 b(:)f(:)g(:)h(:)f(:)g(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)
h(:)f(:)g(:)h(:)f(:)g(:)33 b Fn(49)120 855 y(3.5)44 b(Module)9
b(T)m(ypeNames)34 b Fj(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)
g(:)h(:)f(:)g(:)h(:)f(:)g(:)33 b Fn(49)120 905 y(3.6)44
b(Module)9 b(AstT)m(oT)m(ype)15 b Fj(:)20 b(:)g(:)h(:)f(:)g(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)
g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)33 b Fn(51)216
955 y(3.6.1)50 b(Procedure)10 b(Convert)20 b Fj(:)g(:)g(:)h(:)f(:)g(:)h
(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)
h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)33 b Fn(51)216 1005
y(3.6.2)50 b(Conversion)8 b(from)j(M3AST)f(type)g(to)g(T)m(ype.T)39
b Fj(:)21 b(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)33 b Fn(52)120 1055 y(3.7)44 b(Module)9
b(ImportList)19 b Fj(:)h(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)
g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)33 b Fn(59)216 1104 y(3.7.1)50
b(Producing)9 b(import)g(lists)27 b Fj(:)21 b(:)f(:)g(:)h(:)f(:)g(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)
h(:)f(:)g(:)h(:)f(:)g(:)33 b Fn(59)216 1154 y(3.7.2)50
b(Procedure)10 b(Add)18 b Fj(:)j(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)
g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)33 b Fn(62)216 1204 y(3.7.3)50
b(Procedure)10 b(T)m(oT)m(ext)39 b Fj(:)20 b(:)g(:)h(:)f(:)g(:)h(:)f(:)
g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)33 b Fn(63)120 1254 y(3.8)44
b(Module)9 b(StablegenAr)o(gs)18 b Fj(:)j(:)f(:)g(:)g(:)h(:)f(:)g(:)h
(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)
h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)33 b Fn(63)216 1304
y(3.8.1)50 b(Procedure)10 b(Get)30 b Fj(:)21 b(:)f(:)g(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)
g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)33 b Fn(64)216
1354 y(3.8.2)50 b(Initialisation)23 b Fj(:)d(:)h(:)f(:)g(:)g(:)h(:)f(:)
g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)33 b Fn(64)120
1403 y(3.9)44 b(Module)9 b(T)m(ype)19 b Fj(:)h(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)
f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)33
b Fn(65)120 1453 y(3.10)23 b(Module)9 b(V)-5 b(alue)39
b Fj(:)20 b(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h
(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)
f(:)g(:)h(:)f(:)g(:)33 b Fn(71)120 1503 y(3.1)n(1)25
b(Module)9 b(FRefRefTbl)29 b Fj(:)20 b(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h
(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)
h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)33 b Fn(73)120 1553
y(3.12)23 b(Module)9 b(StablegenError)h Fj(:)21 b(:)f(:)g(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)
g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)33 b Fn(73)p
eop
%%Page: 5 5
5 4 bop 145 570 a Fh(Chapter)22 b(1)145 779 y Fl(Overview)145
996 y Fn(The)11 b(stable)f(object)f(generator)h(was)h(implemented)f(by)
f(using)g(Susan)h(Owicki')n(s)f(network)g(object)h(stub)f(generator)h
(im-)145 1046 y(plementation)i(as)h(starting)e(point.)20
b(Especially)12 b(most)h(of)f(the)h(type)f(and)g(formal)h(parameter)g
(marshalling)f(code)h(was)145 1096 y(copied)d(from)g(her)h
(implementation.)208 1147 y(The)i(program)f(takes)g(the)h(name)g(of)f
(an)h(interface)f(as)h(parameter)n(.)21 b(It)12 b(looks)g(for)g(a)g
(type)g Fm(T)h Fn(in)e(that)h(interface)h(and)145 1196
y(produces)e(a)f(stable)h(subtype)e(of)h(this)g(type)g(\(again,)g(see)i
(\252Stable)f(Objects\272)f(for)g(details\).)k(An)c(implementation)f
(of)h(the)145 1246 y(generic)h(interface)f Fm(Stable.ig)g
Fn(is)g(the)g(result.)145 1393 y Fg(1.1)60 b(List)14
b(of)h(modules)145 1487 y Fn(The)9 b(implementation)d(of)i(the)g
(generator)g(uses)g(the)g(AST)g(toolkit)e(to)h(compile)h(the)f(object)h
(type)f(into)g(an)h(abstract)g(syntax)145 1537 y(tree.)15
b(The)c(modules)f(are)h(as)g(follows)197 1624 y(1.)21
b(Main)10 b(stearing)g(modules)299 1712 y Ff(\017)20
b Fm(Main)340 1761 y Fn(Read)11 b(run)f(string,)f(run)h(the)g(toolkit)e
(compiler)n(,)i(start)g(the)g(code)h(generation.)299
1830 y Ff(\017)20 b Fm(GenCode)340 1880 y Fn(T)m(ake)13
b(the)d(abstract)i(syntax)e(tree\(s\),)i(start)e(conversion)g(to)h
Fm(Type.T)p Fn(-structure,)f(main)h(code)h(generation)340
1930 y(procedures.)197 2018 y(2.)21 b(Code)10 b(generating)g(modules)
299 2105 y Ff(\017)20 b Fm(GenModuleCode)340 2155 y Fn(Produce)11
b(the)f(Modula-3)f(code.)299 2224 y Ff(\017)20 b Fm(GenTypeCode)340
2274 y Fn(Produce)11 b(pieces)g(of)f(code)h(out)e(of)h(type)g
(descriptions)f(\(called)h(by)g Fm(GenModuleCode)p Fn(\).)197
2362 y(3.)21 b Fm(Type.T)10 b Fn(structure)299 2449 y
Ff(\017)20 b Fm(Type)340 2499 y Fn(De\256ne)11 b(a)g(type)f
(speci\256cation)g(data)h(structure)e(which)h(is)g(independent)g(of)g
(the)g(AST)h(package.)1007 2604 y(5)p eop
%%Page: 6 6
6 5 bop 58 141 a Fn(6)1253 b Fi(CHAPTER)11 b(1.)21 b(OVER)m(VIEW)212
258 y Ff(\017)f Fm(Value)253 307 y Fn(Has)11 b(two)f(interfaces)h
Fm(Value.i3)e Fn(and)h Fm(ValueProc.i3)p Fn(.)k(Represent)c(constant)g
(values)g(for)g Fm(Type)p Fn(.)110 393 y(4.)21 b(Utility)8
b(modules)212 479 y Ff(\017)20 b Fm(StablegenArgs)253
529 y Fn(Parse)12 b(run)d(string)g(parameters.)212 596
y Ff(\017)20 b Fm(TypeNames)253 646 y Fn(Do)9 b(a)g(preprocess)h(run)e
(over)h(the)g(abstract)g(syntax)f(tree)h(\(attaches)h(typename)f
(information)e(to)i(type)f(spec-)253 696 y(i\256cation)i(nodes\).)212
764 y Ff(\017)20 b Fm(AstToType)253 813 y Fn(Convert)9
b(abstract)i(syntax)f(tree)g(into)f(equivalent)g Fm(Type.T)p
Fn(-structure.)212 881 y Ff(\017)20 b Fm(ImportList)253
931 y Fn(Find)10 b(out)f(about)h(necessary)h(imports)f(to)f(represent)i
(a)g(type.)212 999 y Ff(\017)20 b Fm(FRefRefTbl)253 1049
y Fn(An)10 b(unsafe)h Fm(Table.T)f Fn(for)g(references.)212
1116 y Ff(\017)20 b Fm(StablegenError)253 1166 y Fn(Declares)12
b(the)e(exception)g(raised)h(in)f(case)i(of)e(compilation)f(errors.)15
b(It)10 b(also)g(contains)g(the)h(procedures)f(to)253
1216 y(print)f(error)h(messages)i(and)f(warnings.)58
1359 y Fg(1.2)60 b(m3make\256le)58 1453 y Fm(\045)25
b(Copyright)f(\(C\))h(1992,)f(Digital)g(Equipment)g(Corporation.)58
1503 y(\045)h(Distributed)f(only)g(by)h(permission.)58
1553 y(\045)58 1603 y(\045)g(Created)f(by)h(Carsten)f(Weich)58
1652 y(\045)58 1702 y(\045)h(Last)f(modified)h(on)f(Thu)h(Jan)g(19)f
(14:28:12)g(PST)h(1995)g(by)f(kalsow)58 1752 y(\045)149
b(modified)25 b(on)f(Mon)h(Sep)g(26)f(17:44:13)g(PDT)h(1994)g(by)f
(weich)58 1802 y(\045)58 1852 y(\045)h(Makefile)f(for)h(stable)f
(object)g(stub)h(generator)58 1951 y(import\("libm3"\))58
2001 y(import\("m3tk"\))58 2101 y(module\("TypeNames"\))58
2151 y(module\("Value"\))58 2200 y(interface\("ValueProc"\))58
2250 y(module\("Type"\))58 2300 y(module\("AstToType"\))58
2350 y(module\("ImportList"\))58 2400 y(module\("GenCode"\))58
2449 y(module\("GenTypeCode"\))58 2499 y(module\("GenModuleCode"\))p
eop
%%Page: 7 7
7 6 bop 145 141 a Fi(1.2.)25 b(M3MAKEFILE)1369 b Fn(7)145
258 y Fm(module\("StablegenArgs"\))145 307 y
(module\("StablegenError"\))145 357 y(module\("FRefRefTbl"\))145
407 y(implementation\("Main"\))145 457 y(Program\("stablegen"\))145
557 y(import\("mtex"\))145 606 y(Mtex\("stablegen",1\))p
eop
%%Page: 8 8
8 7 bop 58 141 a Fn(8)1250 b Fi(CHAPTER)10 b(1.)25 b(OVER)m(VIEW)p
eop
%%Page: 9 9
9 8 bop 145 569 a Fh(Chapter)22 b(2)145 777 y Fl(Interfaces)145
1017 y Fg(2.1)60 b(Interface)13 b(GenCode)145 1134 y
Fn(Main)8 b(code)g(generating)f(module.)13 b Fe(Do\(\))7
b Fn(produces)h(the)g(implementation)f(of)g(a)h(stable)g(subtype)f(of)h
(its)f(parameter)i Fe(qid)p Fn(.)245 1230 y Fe(INTERFACE)20
b(GenCode;)245 1302 y(IMPORT)g(Type,)h(M3Context,)f(StablegenError;)245
1374 y(PROCEDURE)g(Do)h(\(c)523 b(:)21 b(M3Context.T;)550
1422 y(qid)479 b(:)21 b(Type.Qid;)550 1470 y(reveal,)f(implName,)g
(repName:)g(TEXT)196 b(\))289 1520 y(RAISES)20 b({StablegenError.E})o
(;)245 1581 y Fd(Generate)e(implemen)o(tation)c(for)i(the)i(ob)r(ject)g
(whic)o(h)f(t)o(yp)q(e)g(is)g(named)f(b)o(y)h Fc(qid)p
Fd(.)27 b Fc(c)17 b Fd(is)g(the)g(curren)o(t)245 1631
y(compilation)c(con)o(text.)25 b(An)16 b(exception)h(is)f(raised)g(if)f
(an)h(error)h(is)f(detected.)26 b Fc(reveal)15 b Fd(is)g(the)i(name)245
1681 y(of)e(the)g(in)o(terface)h(con)o(taining)e(the)i(most)e(sp)q
(eci\014c)j(rev)o(ealation)d(of)h Fc(qid)p Fd(.)21 b
Fc(implName)14 b Fd(is)h(the)h(name)e(of)245 1731 y(the)j(implem)o(en)o
(tation)c(mo)q(dule)i(for)h(the)g(stable)h(subt)o(yp)q(e.)26
b Fc(repName)14 b Fd(is)i(the)h(mo)q(dule)e(name)g(of)g(the)245
1781 y(generic)d(part)g(of)f(the)h(implemen)o(tation)c(of)j(the)i
(stable)f(ob)r(ject)g(\(usually)f(lik)o(e)g Fc(implName)f
Fd(with)h(a)g(\\Rep")245 1831 y(app)q(ended\).)19 b(The)14
b Fc(repName)f Fd(mo)q(dule)f(is)i(made)f(b)o(y)g(instatiating)g(the)i
(generic)f Fc(StableRep)e Fd(mo)q(dule.)245 1929 y Fe(END)21
b(GenCode.)145 2093 y Fg(2.2)60 b(Interface)13 b(GenModuleCode)145
2209 y Fn(Produce)h(Modula-3)f(code)i(for)f(the)f(stable)h(object')n(s)
g(implementation.)24 b(The)15 b(exception)e Fe(StablegenError.E)e
Fn(is)145 2259 y(raised)f(if)f(some)i(error)e(in)g(the)h(users)g(data)g
(structures)f(is)h(uncoverd.)j(In)d(general,)g(this)f(should)g(not)f
(occur)i(at)g(this)f(point.)245 2355 y Fe(INTERFACE)20
b(GenModuleCode;)245 2427 y(IMPORT)g(Formatter,)g(ImportList,)g
(StablegenError,)e(Type;)245 2499 y(PROCEDURE)i(Header)g(\(modWr)108
b(:)22 b(Formatter.T;)1007 2604 y Fn(9)p eop
%%Page: 10 10
10 9 bop 58 141 a Fn(10)1198 b Fi(CHAPTER)11 b(2.)24
b(INTERF)m(ACES)550 258 y Fe(implName)42 b(:)22 b(TEXT;)550
305 y(methods)64 b(:)22 b(ImportList.Meth)o(odLis)o(t;)550
355 y(importList:)e(ImportList.T)237 b(\);)158 421 y
Fd(Pro)q(duce)18 b(a)f(mo)q(dule)e(\(with)i(name)f Fc(implName)p
Fd(\))f(header)j(together)g(with)e(the)i Fc(IMPORT)e
Fd(statemen)o(ts)158 471 y(\(pro)q(duced)g(out)f(of)g
Fc(importList)p Fd(.)k(After)d(that)f(a)f(declaration)h(of)g(an)f(en)o
(umeration)g(t)o(yp)q(e)i(is)f(added.)158 521 y(It)f(en)o(umerates)g
(all)f(up)q(date)h(metho)q(ds)g(\(using)f(the)i(list)e
Fc(methods)p Fd(\).)k(Co)q(de)d(is)g(written)g(to)g Fc(modWr)p
Fd(.)158 626 y Fe(PROCEDURE)20 b(Revealation)f(\(modWr)43
b(:)21 b(Formatter.T;)659 674 y(repName:)f(TEXT;)659
722 y(methods:)g(ImportList.MethodL)o(ist\))201 772 y(RAISES)h
({StablegenError.E)o(};)158 838 y Fd(Pro)q(duce)d(the)g(co)q(de)g(for)e
(the)i(rev)o(ealation)e(of)h(the)h(generic)g(t)o(yp)q(e)f
Fc(Stable.T)p Fd(.)e(Co)q(de)i(is)g(written)h(to)158
888 y Fc(modWr)p Fd(,)10 b Fc(repName)g Fd(is)h(the)h(\014lename)e(of)g
(the)i(instatiation)e(of)h(the)h(generic)g(part)f(of)g(the)h(implem)o
(en)o(tation,)158 938 y Fc(methods)g Fd(is)i(a)f(list)h(of)f(its)h(up)q
(date)h(metho)q(ds)158 1043 y Fe(PROCEDURE)20 b(Surrogates)f(\(modWr)43
b(:)21 b(Formatter.T;)637 1091 y(name)65 b(:)21 b(Type.Qid;)637
1138 y(repName:)f(TEXT;)637 1186 y(methods:)g(ImportList.MethodLi)o
(st\))201 1236 y(RAISES)h({StablegenError.E)o(};)158
1302 y Fd(Pro)q(duce)d(the)f(co)q(de)g(of)f(the)h(metho)q(ds)f(that)h
(log)e(their)i(parameters.)26 b(Co)q(de)17 b(is)g(written)g(to)f
Fc(modWr)p Fd(,)158 1352 y Fc(name)e Fd(is)h(the)h(ob)r(ject's)f(name)f
(for)h(whic)o(h)g(a)g(stable)g(implemen)o(tation)d(is)j(pro)q(duced,)h
Fc(repName)d Fd(is)i(the)158 1402 y(name)d(of)h(the)h(instan)o(tiated)g
(generic)g(part)g(of)f(the)h(generated)h(co)q(de,)f Fc(methods)e
Fd(is)i(a)f(list)g(of)g(its)h(up)q(date)158 1452 y(metho)q(ds)158
1557 y Fe(PROCEDURE)20 b(Dispatcher)f(\(modWr)43 b(:)21
b(Formatter.T;)637 1605 y(methods:)f(ImportList.MethodLi)o(st\))201
1655 y(RAISES)h({StablegenError.E)o(};)158 1721 y Fd(Pro)q(duce)d(co)q
(de)g(for)e(pro)q(cedure)j(whic)o(h)d(reads)i(the)f(log)f(and)h(starts)
h(all)d(the)j(redo)f(stubs.)28 b(Co)q(de)17 b(is)158
1771 y(written)d(to)g Fc(modWr)p Fd(,)e Fc(methods)h
Fd(is)g(a)h(list)f(of)h(its)g(up)q(date)g(metho)q(ds)158
1876 y Fe(PROCEDURE)20 b(ReplayStubs)f(\(modWr)43 b(:)21
b(Formatter.T;)659 1924 y(name)65 b(:)21 b(Type.Qid;)659
1972 y(methods:)f(ImportList.MethodL)o(ist\))201 2021
y(RAISES)h({StablegenError.E)o(};)158 2088 y Fd(Pro)q(duce)c(co)q(de)f
(for)f(the)h(redo)g(stubs.)24 b(Again)15 b Fc(modWr)f
Fd(is)i(the)g(writer)g(that)f(tak)o(es)h(the)g(co)q(de,)h
Fc(type)d Fd(is)158 2137 y(the)g(ob)r(ject)h(and)f Fc(methods)e
Fd(is)i(the)g(list)g(of)f(the)h(up)q(date)h(metho)q(ds)158
2245 y Fe(PROCEDURE)20 b(Checkpoint\(modWr)o(:)f(Formatter.T;)g
(repName:)h(TEXT\);)158 2311 y Fd(Generate)c(the)f(call)f(to)h(the)h
(pro)q(cedure)h(that)e(do)q(es)g(the)h(c)o(hec)o(kp)q(oin)o(t)f(\(whic)
o(h)g(is)g(in)f(the)i(generic)g(part)158 2361 y(of)d(the)i(implem)o(en)
o(tation)c(of)i(stable)h(ob)r(jects)h Fc(repName)p Fd(\))158
2468 y Fe(END)21 b(GenModuleCode.)p eop
%%Page: 11 11
11 10 bop 145 141 a Fi(2.3.)25 b(INTERF)m(ACE)10 b(GENTYPECODE)1081
b Fn(1)n(1)145 258 y Fg(2.3)60 b(Interface)13 b(GenT)l(ypeCode)145
375 y Fn(Provide)f(a)i(procedure)f(to)f(produce)h(Modula-3)f(code)h
(out)f(of)h(type)g(structures.)21 b(Provide)12 b(a)i(procedure)f(to)f
(generate)145 424 y(procedure)f(header)g(Modula-3)e(code.)245
521 y Fe(INTERFACE)20 b(GenTypeCode;)245 593 y(IMPORT)g(Formatter,)g
(Type;)245 667 y(PROCEDURE)g(ToText)g(\(t:)i(Type.T;)e(byName:)g
(BOOLEAN)h(:=)g(TRUE\):)g(TEXT;)245 729 y Fd(Return)15
b(a)f(textual)g(represen)o(tation)i(of)d(the)i(t)o(yp)q(e)g(t.)k(If)14
b(b)o(yName)f(=)h(TR)o(UE,)g(and)g(t)o(yp)q(e)h(T)f(is)g(named,)245
779 y(then)g(return)h(the)f(name.)j(Otherwise)e(return)g(text)f(for)f
(the)i(delcaration)e(of)g(T.)g(Note)h(that)g(ev)o(en)g(with)245
828 y(b)o(yName)e(=)j(F)-5 b(ALSE,)14 b(t)o(yp)q(eNames)g(will)e(b)q(e)
i(used)h(within)e(the)i(text)f(for)g(t's)g(declaration)245
925 y Fe(PROCEDURE)20 b(ProcHeader)g(\(f)195 b(:)22 b(Formatter.T;)724
972 y(procName)42 b(:)22 b(TEXT;)724 1020 y(sig)152 b(:)22
b(Type.Signature;)724 1068 y(suffix)522 b(:=)22 b("";)724
1118 y(argPragmas:)e(REF)h(ARRAY)g(OF)g(TEXT)g(:=)h(NIL)f(\);)245
1180 y Fd(Output)15 b(on)g Fc(f)g Fd(a)f(header)i(for)e(a)h(pro)q
(cedure)i(with)d(name)g Fc(procName)f Fd(and)h(a)h(signature)g(deriv)o
(ed)g(from)245 1229 y Fc(sig)p Fd(.)22 b(The)15 b(signature)h
(di\013ers)g(from)e Fc(sig)h Fd(in)g(that)g(it's)g(\014rst)h(argumen)o
(t)e(is)h(a)g(self)h(argumen)o(t)e(\()p Fc(self:)245
1279 y(T)p Fd(\),)g(and)g(its)h(formal)d(parameters')j(names)e(are)j
(su\016xed)f(b)o(y)f Fc(suffix)p Fd(.)19 b Fc(pragmas)13
b Fd(is)i(a)f(list)g(of)g(text)i(for)245 1329 y(pragmas)11
b(to)h(precede)j(argumen)o(ts;)d Fc(pragma[i])e Fd(preceeds)15
b(the)f(ith)e(parameter)g(in)g Fc(sig.formals[i])p Fd(.)245
1427 y Fe(END)21 b(GenTypeCode.)145 1591 y Fg(2.4)60
b(Interface)13 b(T)l(ypeNames)145 1708 y Fn(W)m(alk)e(through)d(a)j
Fe(M3Context.T)e Fn(and)h(add)h(a)g(property)e(to)h(each)i(node)f(that)
e(represents)i(a)g(type)g(speci\256cation)f(that)g(is)145
1758 y(not)g(a)h(named)g(type.)i(The)e(property)e(added)i(is)f(the)g
(name)h(of)f(the)g(type)g(speci\256ed)h(\(precicly)f(one)g(name)i(of)d
(the)i(type\).)208 1808 y(This)f(typename)h(is)f(later)g(used)g
(instead)g(of)g(the)g(type)g(speci\256cation)g(\(see)h
Fe(AstToType.AddToTable)o Fn(\).)245 1904 y Fe(INTERFACE)20
b(TypeNames;)245 1976 y(IMPORT)g(M3Context;)245 2048
y(PROCEDURE)g(Preprocess\(c:)f(M3Context.T\);)245 2122
y(END)i(TypeNames.)145 2286 y Fg(2.5)60 b(Interface)13
b(AstT)-5 b(oT)l(ype)145 2403 y Fn(Convert)9 b(the)i(toolkit)c(type)j
(speci\256cation)g(into)f(a)i Fe(Type.T)245 2499 y(INTERFACE)20
b(AstToType;)p eop
%%Page: 12 12
12 11 bop 58 141 a Fn(12)1198 b Fi(CHAPTER)11 b(2.)24
b(INTERF)m(ACES)158 258 y Fe(IMPORT)c(M3AST_AS,)g(Type;)158
344 y(PROCEDURE)g(Convert\(m3type:)e(M3AST_AS.M3TYPE\):)h(Type.T;)158
418 y Fd(Recursivly)14 b(parse)g Fc(m3type)f Fd(and)h(pro)q(duce)h(an)e
(equiv)n(alen)o(t)h Fc(Type.T)e Fd(as)i(return.)158 540
y Fe(END)21 b(AstToType.)58 753 y Fg(2.6)60 b(Interface)13
b(ImportList)58 893 y Fn(A)7 b Fe(ImportList.T)t Fn(is)g(a)g(set)g(of)g
(interface)g(names.)14 b(The)8 b(procedure)f Fe(Get)f
Fn(generates)i(such)f(a)g(list.)12 b(It)6 b(takes)h(a)h
Fe(Type.Object)58 943 y Fn(and)f(looks)f(at)h(all)g(its)g(components)f
(to)h(construct)f(a)i(list)e(of)g(all)h(necessary)i(imports)d(to)g
(represent)h(the)g(type)g(in)f(a)i(Modula-3)58 993 y(program.)120
1048 y(A)j(procedure)g Fe(Add)f Fn(can)h(be)g(used)g(to)f(add)g(other)g
(interfaces)h(to)f(the)h(list.)j Fe(ToText)9 b Fn(produces)i(a)g(comma)
h(separated)58 1098 y(list)d(of)h(all)g(interface)h(names)g(\(useful)f
(for)g Fe(IMPORT)f Fn(statements\).)158 1219 y Fe(INTERFACE)20
b(ImportList;)158 1303 y(IMPORT)g(Atom,)h(Type;)158 1387
y(TYPE)201 1435 y(T)h(<:)f(REFANY;)201 1482 y(MethodList)f(=)i(REF)f
(ARRAY)g(OF)g(Method;)201 1530 y(Method)g(=)g(RECORD)441
1578 y(name:)g(Atom.T;)441 1626 y(sig)g(:)h(Type.Signature)397
1673 y(END;)158 1759 y(PROCEDURE)e(FromType)g(\(type:)g(Type.Object;)g
(methods:)g(MethodList\):)f(T;)158 1833 y Fd(Generate)g(a)f(new)h(imp)q
(ort)d(list.)31 b(Lo)q(ok)18 b(for)f(\014elds)i(in)f
Fc(type)f Fd(and)h(for)g(signature)h(of)e(metho)q(ds)h(in)158
1883 y Fc(methods)p Fd(.)158 2006 y Fe(PROCEDURE)i(Add)h(\(importList:)
e(T;)j(intf:)e(Atom.T\);)158 2079 y Fd(Add)14 b(the)g(in)o(terface)h
(name)d Fc(intf)h Fd(to)h Fc(importList)p Fd(.)i(This)e(is)g(a)f(no-op)
h(if)f Fc(intf)g Fd(is)g(already)h(in)f(the)i(list)158
2202 y Fe(PROCEDURE)20 b(ToText)g(\(imports:)g(T\):)h(TEXT;)158
2276 y Fd(Generate)13 b(a)g(comma)c(separated)14 b(list)e(of)g(in)o
(terface)h(names)e(out)i(of)f Fc(imports)p Fd(.)k(The)d(output)f(is)h
(suitable)158 2325 y(for)g(an)h Fc(IMPORT)f Fd(statemen)o(t.)158
2448 y Fe(END)21 b(ImportList.)p eop
%%Page: 13 13
13 12 bop 145 141 a Fi(2.7.)25 b(INTERF)m(ACE)10 b(ST)m(ABLEGENARGS)
1031 b Fn(13)145 258 y Fg(2.7)60 b(Interface)13 b(StablegenArgs)145
374 y Fn(The)e(module)f Fe(Args)g Fn(parses)h(the)f(command)h(line)f
(using)f Fe(M3Args)g Fn(of)h(the)g(toolkit.)245 470 y
Fe(INTERFACE)20 b(StablegenArgs;)245 542 y(IMPORT)g(Type,)h
(StablegenError;)245 614 y(PROCEDURE)f(Get\(VAR)g(object:)h(Type.Qid;)e
(VAR)j(reveal,)e(impl,)h(rep:)g(TEXT\))289 663 y(RAISES)f
({StablegenError.E})o(;)245 725 y Fd(P)o(arse)c(the)g(command)c(line)j
(and)g(return)i(the)f(t)o(yp)q(e)g(to)f(b)q(e)h(made)e(stable)h(in)g
Fc(object)f Fd(and)h(the)h(name)245 775 y(of)d(the)i(mo)q(dule)e(con)o
(taining)g(the)h(implemen)o(tation)d(of)i(the)i(stable)f(subt)o(yp)q(e)
h(in)f Fc(impl)p Fd(.)j Fc(reveal)c Fd(is)h(the)245 825
y(name)f(of)h(the)h(in)o(terface)g(con)o(taining)f(the)h(most)e(sp)q
(eci\014c)j(rev)o(ealation)e(of)g Fc(object)p Fd(.)k
Fc(rep)c Fd(is)h(the)g(name)245 875 y(of)d(the)i(instatiated)f
Fc(StableRep)f Fd(generic)i(mo)q(dule.)i(The)e(exception)f(is)g(raised)
h(if)e(the)i(parameters)f(are)245 924 y(un)o(usable)h(\(i.e.)f(in)o(v)n
(alid)f(or)i(\\-help"\))245 1022 y Fe(END)21 b(StablegenArgs.)145
1186 y Fg(2.8)60 b(Interface)13 b(T)l(ype)145 1302 y
Fn(A)f Fe(Type.T)e Fn(is)h(a)h(representation)e(for)h(a)h(Modula-3)e
(type,)h(together)g(with)f(information)f(about)i(the)g(name)h(of)f(the)
g(type)145 1352 y(and)g(its)e(constituent)g(types)h(in)f(some)i(scope,)
h(called)e(the)g(global)g(scope.)245 1448 y Fe(INTERFACE)20
b(Type;)245 1520 y(IMPORT)g(Atom,)h(Text,)g(Value;)245
1591 y(TYPE)289 1639 y(T)g(<:)g(OBJECT)g(name:)g(Qid;)g(visited)f(:=)h
(FALSE;)g(brandsOK)f(:=)i(TRUE)42 b(END;)289 1687 y(\(*)21
b(If)g(name)g(is)h(not)f(NIL,)g(it)g(is)h(the)f(name)g(of)g(the)g(type)
g(in)h(the)f(global)f(scope.)354 1735 y(If)h(the)g(type)g(has)h
(multiple)e(names)g(in)i(the)f(global)g(scope,)f(one)h(of)h(them)354
1782 y(is)f(chosen)g(arbitrarily.)354 1830 y(If)g(visited)g(is)g(TRUE,)
g(brandsOK)f(is)h(TRUE)g(iff)g(any)h(branded)e(type)h(on)g(which)354
1878 y(this)g(type)g(depends)f(has)h(an)h(explicit)e(brand)h(*\))289
1950 y(\(*)g(Ordinal)f(|)i(Real)f(|)g(LongReal)g(|)g(Extended)f(|)i
(Reference)42 b(|)21 b(Array)289 1997 y(|)g(Packed)g(|)g(Record)g(|)g
(Set)h(|)f(Procedure)42 b(*\))289 2069 y(Ordinal)20 b(=)43
b(T)22 b(BRANDED)e(OBJECT)h(END;)g(\(*)g(Enumeration)f(|)h(Subrange)f
(*\))289 2141 y(Enumeration)f(=)j(Ordinal)e(BRANDED)g(OBJECT)h(END;)g
(\(*)g(Char)g(|)h(UserDefined)d(*\))289 2213 y(Char)h(=)i(Enumeration)e
(BRANDED)g(OBJECT)g(END;)289 2284 y(UserDefined)f(=)j(Enumeration)d
(OBJECT)332 2332 y(elts)i(:)h(REF)f(ARRAY)g(OF)g(Atom.T;)289
2380 y(END;)289 2452 y(Subrange)f(=)h(Ordinal)g(OBJECT)332
2499 y(base)g(:)h(Ordinal;)p eop
%%Page: 14 14
14 13 bop 58 141 a Fn(14)1198 b Fi(CHAPTER)11 b(2.)24
b(INTERF)m(ACES)245 258 y Fe(min)43 b(:)21 b(Value.T;)245
305 y(max)43 b(:)21 b(Value.T;)201 353 y(END;)201 427
y(\(*)h(INTEGER)e(is)h(represented)f(by)h(a)h(Subrange)e(p)i(with)f
(p.base)f(=)i(p,)267 474 y(p.min)e(=)i(FIRST\(INTEGER\))d(and)i(p.max)g
(=)g(LAST\(INTEGER\).)e(*\))201 548 y(Real)i(=)h(T)f(BRANDED)g(OBJECT)f
(END;)201 622 y(LongReal)g(=)i(T)g(BRANDED)e(OBJECT)h(END;)201
695 y(Extended)f(=)i(T)g(BRANDED)e(OBJECT)h(END;)201
769 y(Reference)f(=)i(T)f(OBJECT)245 817 y(traced)f(:)i(BOOLEAN;)245
864 y(branded:)e(BOOLEAN;)245 912 y(brand)42 b(:)22 b(Atom.T;)42
b(\(*)22 b(IF)f(branded)f(AND)h(brand=NIL)f(then)h(the)h(type)e(was)703
960 y(declared)g(as)h(branded,)f(with)h(no)h(brand)e(given)h(*\))245
1007 y(revIntf)f(:)i(Atom.T;)245 1055 y(\(*)f(If)h(this)f(type)g(was)g
(declared)f(opaquely)g(but)h(revealed)f(in)310 1103 y(a)i(module)e
(included)h(in)g(stube)g(generation,)e(revIntf)i(is)g(the)310
1151 y(name)g(of)h(the)f(interface)f(containing)f(the)j(revelation)d
(*\))201 1198 y(END;)201 1272 y(\(*)j(Object)e(|)i(Ref)f(|)h(Opaque)e
(*\))201 1320 y(\(*)i(Note)f(that)g(a)g(type)g(declared)f(as)i(opaque)e
(is)i(represented)d(by)j(an)f(object)267 1368 y(of)g(type)g(Object)g
(if)g(it)g(is)h(fully)e(revealed)h(in)g(an)g(interface)267
1415 y(given)f(to)i(the)f(stub)g(generator)f(*\))201
1489 y(Object)h(=)g(Reference)f(OBJECT)245 1537 y(super)64
b(:)22 b(Reference;)41 b(\(*)22 b(Opaque)e(or)i(Object)e(*\))245
1584 y(fields)42 b(:)22 b(REF)f(ARRAY)g(OF)g(Field;)245
1632 y(methods)f(:)i(REF)f(ARRAY)g(OF)g(Method;)245 1680
y(\(*)g(Note)g(that)g(fields)g(and)g(methods)f(contain)h(only)g(the)g
(identifiers)310 1728 y(declared)f(for)i(this)f(type,)f(and)h(not)h
(those)e(of)i(supertypes)e(*\))201 1775 y(END;)201 1849
y(Ref)i(=)f(Reference)f(OBJECT)245 1897 y(target)g(:)i(T)201
1944 y(END;)201 2018 y(Opaque)f(=)g(Reference)f(OBJECT)245
2066 y(revealedSuperType)o(:)f(Reference;)201 2113 y(END;)201
2187 y(Array)i(=)h(T)f(OBJECT)245 2235 y(index:)f(Ordinal;)245
2282 y(element)g(:)i(T)201 2330 y(END;)201 2378 y(\(*)g(index)e(=)i
(NIL)f(for)g(open)g(array)g(types.)g(*\))201 2452 y(OpenArray)f(=)i
(Array)f(OBJECT)245 2499 y(refArray:)f(Ref;)p eop
%%Page: 15 15
15 14 bop 145 141 a Fi(2.8.)25 b(INTERF)m(ACE)10 b(TYPE)1277
b Fn(15)332 258 y Fe(openDimensions:)19 b(INTEGER;)h(\(*)h(Depth)g(of)g
(open)g(arrays,)g(including)f(this)h(one)g(*\))289 305
y(END;)289 377 y(Packed)f(=)i(T)f(OBJECT)332 425 y(size)g(:)h
(CARDINAL;)332 472 y(base)f(:)h(T;)289 520 y(END;)289
591 y(Record)e(=)i(T)f(OBJECT)332 639 y(fields)g(:)g(REF)g(ARRAY)g(OF)h
(Field;)289 687 y(END;)289 758 y(Set)f(=)g(T)h(OBJECT)332
806 y(range)f(:)g(Ordinal;)289 854 y(END;)289 925 y(Procedure)e(=)j(T)g
(OBJECT)332 973 y(sig)130 b(:)22 b(Signature;)289 1021
y(END;)289 1092 y(Field)e(=)i(REF)f(RECORD)332 1140 y(name)86
b(:)22 b(Atom.T;)332 1187 y(type)86 b(:)22 b(T;)332 1235
y(default)e(:)i(Value.T;)376 1283 y(\(*)f(default)f(=)i(NIL)f(if)h
(there)e(is)i(no)f(default.)441 1331 y(default)f(=)i(Value.Nil)e(if)h
(the)g(default)g(is)g(NIL.)g(*\))376 1378 y(\(*)g(It)g(is)h(assumed)e
(that)h(fields)g(of)g(type)g(PROCEDURE)f(do)h(not)h(have)441
1426 y(default)e(values.)43 b(*\))289 1474 y(END;)289
1545 y(Method)20 b(=)i(REF)f(RECORD)332 1593 y(name)86
b(:)22 b(Atom.T;)332 1641 y(sig)108 b(:)22 b(Signature;)e(\(*)h(Not)g
(including)f(the)h(Self)g(argument)g(*\))332 1689 y(default)f(:)i
(MethodDefault;)289 1736 y(END;)289 1808 y(MethodDefault)d(=)i(BRANDED)
g(OBJECT)f(END;)289 1879 y(MethodDefault1)e(=)k(MethodDefault)d(OBJECT)
i(qid:)g(Qid)43 b(END;)289 1927 y(\(*)21 b(represents)f(the)h(top)g
(level)g(procedure)f(named)g(qid)i(*\))289 1998 y(MethodDefault2)c(=)k
(MethodDefault)d(OBJECT)332 2046 y(obType:)h(Object;)332
2094 y(method:)g(Atom.T)289 2141 y(END;)289 2189 y(\(*)43
b(represents)19 b(obType.method)h(*\))289 2261 y(Signature)f(=)j
(RECORD)332 2308 y(formals)e(:)i(REF)f(ARRAY)g(OF)g(Formal;)332
2356 y(result)42 b(:)22 b(T;)332 2404 y(raises)42 b(:)22
b(REF)f(ARRAY)g(OF)g(Exception)332 2452 y(\(*)g(raises)g(=)h(NIL)f
(corresponds)e(to)j(RAISES)e(ANY;)397 2499 y(NUMBER\(raises^\)=0)f
(corresponds)g(to)j(RAISES{})42 b(*\))p eop
%%Page: 16 16
16 15 bop 58 141 a Fn(16)1198 b Fi(CHAPTER)11 b(2.)24
b(INTERF)m(ACES)201 258 y Fe(END;)201 330 y(Exception)c(=)i(OBJECT)245
377 y(qid:)f(Qid;)289 425 y(\(*)g(The)g(Qid's)g(name)g(exceptions)e(in)
j(the)f(global)g(scope)f(*\))245 473 y(arg:)h(T;)289
520 y(\(*)g(The)g(type)g(of)g(the)h(exceptions)d(argument,)h(if)i(any)f
(*\))201 568 y(END;)201 640 y(Formal)g(=)g(REF)h(RECORD)245
688 y(mode)86 b(:)22 b(Mode;)245 736 y(outOnly)e(:)i(BOOLEAN;)245
783 y(name)86 b(:)22 b(Atom.T;)245 831 y(type)86 b(:)22
b(T;)245 879 y(default)e(:)i(Value.T;)201 927 y(END;)201
998 y(Mode)f(=)h({)f(Value,)g(Var,)g(Readonly)f(};)201
1070 y(Qid)i(=)f(REF)g(RECORD)g(intf:)g(Atom.T;)485 1118
y(item:)f(Atom.T)332 1166 y(END;)158 1238 y(VAR)h(\(*)g(READONLY)f(*\))
201 1285 y(integer)151 b(:)22 b(Subrange;)201 1333 y(cardinal)129
b(:)22 b(Subrange;)201 1381 y(boolean)151 b(:)22 b(UserDefined;)201
1429 y(char)217 b(:)22 b(Char;)201 1476 y(real)217 b(:)22
b(Real;)201 1524 y(longreal)129 b(:)22 b(LongReal;)201
1572 y(extended)129 b(:)22 b(Extended;)201 1620 y(refany)173
b(:)22 b(Reference;)201 1667 y(address)151 b(:)22 b(Reference;)201
1715 y(root)217 b(:)22 b(Object;)201 1763 y(untracedRoot)41
b(:)22 b(Object;)201 1811 y(null)217 b(:)22 b(Reference;)201
1858 y(text)217 b(:)22 b(Opaque;)201 1906 y(mutex)195
b(:)22 b(Opaque;)158 1980 y(PROCEDURE)e(ToText\(t:)g(T;)h(byName:)f
(BOOLEAN)h(:=)g(TRUE\):)g(Text.T;)158 2042 y Fd(Return)16
b(a)g(textual)g(represen)o(tation)h(of)e(the)i(t)o(yp)q(e.)24
b(If)16 b Fc(byName)21 b(AND)g(t.name)f(#)i(NIL)p Fd(,)15
b(the)h(text)h(for)158 2092 y Fc(t.name)c Fd(is)h(returned.)22
b(Otherwise)16 b(the)f(returned)h(v)n(alue)e(is)g(comp)q(osed)h(from)d
(the)j(t)o(yp)q(e)g(of)f(T)h(and)f(its)158 2141 y(comp)q(onen)o(t)h(v)n
(alues.)22 b(Note)16 b(that)g(ev)o(en)g(if)f Fc(byName=TRUE)p
Fd(,)d(names)j(within)g(the)h(de\014nition)f(of)g Fc(T)g
Fd(will)158 2191 y(not)e(b)q(e)h(expanded.)k(An)13 b(op)q(qaue)h(t)o
(yp)q(e)f(can)h(only)e(b)q(e)i(represen)o(ted)i(b)o(y)d(name;)f(if)g
Fc(t)h Fd(is)g(an)g(opaque)g(t)o(yp)q(e)158 2241 y(and)g
Fc(byName=FALSE)p Fd(,)e(the)k(returned)g(text)g(is)f(meaningless)e
(\(it)i(con)o(tains)g(a)f(w)o(arning\).)158 2339 y Fe(PROCEDURE)20
b(MayBeRefAny\(t:)f(T\):)i(BOOLEAN;)158 2401 y Fd(Returns)14
b Fc(TRUE)f Fd(if)h Fc(t)f Fd(is)h(or)g(ma)o(y)e(b)q(e)i(rev)o(ealed)h
(to)e(b)q(e)i Fc(REFANY)158 2499 y Fe(PROCEDURE)20 b(NamedType\(t:)f
(T\):)i(BOOLEAN;)p eop
%%Page: 17 17
17 16 bop 145 141 a Fi(2.9.)25 b(INTERF)m(ACE)10 b(V)-5
b(ALUE)1245 b Fn(17)245 258 y Fd(Returns)15 b Fc(TRUE)e
Fd(if)g Fc(t)g Fd(has)h(a)g(name,)e(i.e.)18 b Fc(t.name#NIL)245
357 y Fe(END)j(Type.)145 521 y Fg(2.9)60 b(Interface)13
b(V)-5 b(alue)245 639 y Fe(INTERFACE)20 b(Value;)145
713 y Fn(A)10 b(V)-5 b(alue.T)11 b(is)e(a)h(representation)f(for)g(a)h
(Modula-3)f(value;)g(it)g(is)g(intended)g(to)g(be)g(used)h(in)f
(conjunction)f(with)g(the)i(typed)145 763 y(Abstract)g(Syntax)f(T)o
(ree)i(interface,)f(T)m(ypedAST)m(.)h(A)f(V)-5 b(alue.T)11
b(only)e(contains)g(enough)g(information)f(to)h(determine)h(the)145
813 y(value)g(if)g(you)g(already)g(know)g(the)g(value')n(s)g(type;)f
(therefore)h(V)-5 b(alue.T')n(s)11 b(should)e(generally)h(be)g(paired)g
(with)g(T)m(ype.T')n(s.)208 863 y(For)g(good)f(measue,)j(this)e
(interface)g(also)g(de\256nes)h(types)f(to)g(represent)h(procedures)f
(and)g(exceptions.)245 960 y Fe(TYPE)289 1008 y(T)21
b(<:)g(ROOT;)289 1055 y(\(*)g(Ordinal)f(|)i(Float)f(|)g(LongFloat)f(|)i
(Extended)e(|)h(Array)g(|)h(Set)f(|)h(Record)e(|)354
1103 y(Text)h(|)g(Null)g(*\))332 1176 y(Ordinal)f(=)i(T)g(OBJECT)e
(ord:)h(INTEGER)f(END;)332 1223 y(\(*)h(ORD\(the)g(value\))f(*\))332
1296 y(Float)h(=)g(T)h(OBJECT)f(val:)g(REAL)g(END;)332
1368 y(LongFloat)f(=)i(T)f(OBJECT)g(val:)g(LONGREAL)f(END;)332
1441 y(Extended)42 b(=)22 b(T)f(OBJECT)g(val:)g(EXTENDED)f(END;)332
1513 y(Array)h(=)g(T)h(OBJECT)f(elements:)f(REF)h(ARRAY)f(OF)i(T)f
(END;)332 1586 y(Set)g(=)h(T)f(OBJECT)g(elements:)f(REF)h(ARRAY)g(OF)g
(BOOLEAN)g(END;)332 1658 y(Record)g(=)g(T)h(OBJECT)e(elements:)g(REF)h
(ARRAY)g(OF)h(T)f(END;)332 1706 y(\(*)g(The)h(field)e(values)h(in)g
(the)h(order)e(the)h(fields)g(are)g(declared.)f(*\))332
1778 y(Txt)h(=)h(T)f(OBJECT)g(val:)g(TEXT)g(END;)332
1851 y(Null)g(=)h(T)f(OBJECT)g(END;)332 1899 y(\(*)g(The)h(value)e
(NIL.)h(*\))245 1973 y(END)g(Value.)145 2138 y Fg(2.10)60
b(Interface)13 b(V)-5 b(aluePr)o(oc)145 2255 y Fn(File:)13
b(V)-5 b(alueProc.i3)145 2330 y(Last)11 b(Modi\256ed)f(On)g(T)o(ue)g
(Oct)h(27)f(12:39:44)e(PST)i(1992)g(by)g(owicki)245 2427
y Fe(INTERFACE)20 b(ValueProc;)245 2499 y(IMPORT)g(Type,)h(Value;)p
eop
%%Page: 18 18
18 17 bop 58 141 a Fn(18)1198 b Fi(CHAPTER)11 b(2.)24
b(INTERF)m(ACES)158 258 y Fe(PROCEDURE)c(ToText\(v:)g(Value.T;)g(type:)
g(Type.T\):)h(TEXT;)158 320 y Fd(Return)c(a)g(textual)g(represen)o
(tation)h(of)f(the)g(v)n(alue)f(v)h(of)g(t)o(yp)q(e)g(T.)f(The)i(text)f
(will)f(b)q(e)h(suitable)g(for)158 369 y(inclusion)c(in)g(program)g
(source)i(in)e(a)h(con)o(text)g(where)h(T)f(is)g(de\014ned.)158
468 y Fe(END)21 b(ValueProc.)58 632 y Fg(2.1)m(1)59 b(Interface)14
b(FRefRefTbl)58 749 y Fn(Last)d(modi\256ed)f(on)g(Mon)g(May)g(17)g
(22:25:49)e(PDT)j(1993)e(by)h(mjordan)158 846 y Fe(INTERFACE)20
b(FRefRefTbl;)158 918 y(IMPORT)g(RefRefTbl;)158 990 y(TYPE)201
1038 y(T)i(=)g(RefRefTbl.T;)201 1088 y(Default)f(<:)g
(RefRefTbl.Default;)58 1162 y Fn(Assumes)11 b(that)f(the)g(collector)g
(is)g(prevented)g(from)g(moving)f(references.)158 1260
y Fe(END)21 b(FRefRefTbl.)58 1424 y Fg(2.12)59 b(Interface)14
b(StablegenErr)o(or)58 1541 y Fn(This)c(module)f(declares)i(the)e
(error)g(exception)g(used)h(by)f(the)h(stable)f(stub)g(generator)n(.)14
b(There)c(is)g(an)g(exception)f Fe(E)g Fn(which)58 1591
y(is)i(used)h(to)e(propagate)h(error)g(messages)j(to)c(the)h(top)g
(level)g(procedure)g(in)g Fe(Main.m3)p Fn(.)16 b Fe(Warning\(\))9
b Fn(and)i Fe(Failure\(\))58 1641 y Fn(are)h(used)f(to)f(print)g(out)g
(warnings)g(to)g(the)h(standard)g(error)g(stream.)17
b(They)11 b(do)f(not)h(halt)f(the)h(generation)f(of)h(stub)f(code.)58
1691 y(Further)g(there)g(is)g(a)h Fe(Fatal\(\))e Fn(procedure)h(which)g
(halts)g(the)g(stub)f(generator)i(in)e(case)j(of)e(an)h(unexpected)f
(error)n(.)158 1787 y Fe(INTERFACE)20 b(StablegenError;)158
1860 y(EXCEPTION)g(E\(TEXT\);)158 1934 y(PROCEDURE)g(Warning)g(\(msg:)h
(TEXT\);)158 1996 y Fd(W)m(rite)10 b Fc(msg)h Fd(to)g
Fc(Stdio.stderr)p Fd(,)d(preceeded)14 b(b)o(y)d("stablegen)g(\(w)o
(arning\):\\)f(and)h(follo)o(w)o(ed)f(b)o(y)h(a)g(newline)158
2094 y Fe(PROCEDURE)20 b(Failure)g(\(msg:)h(TEXT\);)158
2156 y Fd(W)m(rite)13 b Fc(msg)g Fd(to)h Fc(Stdio.stderr)p
Fd(,)d(preceeded)17 b(b)o(y)c("stablegen)h(error:\\)g(and)g(follo)o(w)o
(ed)e(b)o(y)i(a)g(newline)158 2255 y Fe(PROCEDURE)20
b(Fatal)g(\(msg:)h(TEXT\);)158 2317 y Fd(W)m(rite)13
b Fc(msg)g Fd(to)g Fc(Stdio.stderr)p Fd(,)e(preceeded)16
b(b)o(y)d("stablegen:)18 b(***fatal)12 b(error***\\)h(and)h(and)f(halt)
g(the)158 2367 y(program)f(\()p Fc(Process.Exit\(\))p
Fd(\))158 2466 y Fe(END)21 b(StablegenError.)p eop
%%Page: 19 19
19 18 bop 145 569 a Fh(Chapter)22 b(3)145 777 y Fl(Implementation)27
b(Modules)145 1017 y Fg(3.1)60 b(Module)15 b(Main)145
1135 y Fn(The)8 b(main)f(module)f(of)h(the)f(stable)h(stub)f(generator)
h(starts)g(by)f(using)g(a)h Fe(M3ToolFrame.Startu)o(p)t
Fn(which)g(starts)f Fe(DoRun)p Fn(,)145 1185 y(the)k(main)h(working)e
(procedure,)h(as)h(call)g(back)f(\(see)h(there\).)245
1282 y Fe(MODULE)20 b(Main;)245 1355 y(IMPORT)g(Process,)h
(RTCollector;)245 1402 y(IMPORT)f(Type,)h(TypeNames,)f(StablegenArgs,)f
(StablegenError,)g(GenCode;)245 1452 y(IMPORT)h(M3CFETool,)g
(M3ToolFrame,)g(M3Context;)145 1596 y Fb(3.1.1)51 b(Pr)o(ocedur)o(e)13
b(DoRun)145 1673 y Fe(DoRun)g Fn(reads)h(the)f(run)f(string)g
(parameter)j(to)d(gather)i(the)f(interface)g(where)h(the)f
Fe(T)g Fn(which)g(shall)g(be)h(made)g(stable)f(is)145
1723 y(de\256ned)g(\(together)e(with)g(tool)g(kit)h(options.)18
b(It)12 b(then)g(starts)g Fe(M3CFETool.CompileI)o(nCont)o(ext\()o(\))e
Fn(to)h(produce)i(an)145 1773 y(abstract)e(syntax)f(tree)g(of)g(that)g
(type.)208 1823 y(A)f(preprocess)h(run)e Fe(TypeNames.Preproce)o
(ss\(\))e Fn(will)i(assign)h(an)g(attribute)f(on)h(each)h(node)f(of)g
(the)g(AST)g(which)145 1873 y(is)k(a)g(type)f(speci\256cation.)21
b(A)13 b(\252type)g(speci\256cation\272)g(is)f(a)h(type)f(that)g(is)h
(not)f(just)f(an)i(identi\256er)n(.)20 b(The)14 b(attribute)d(is)h(the)
145 1922 y(name)g(of)e(that)f(type.)208 1972 y(Finally)g
Fe(AstToType.OneSt)o(ub\(\))e Fn(is)j(called)h(to)e(produce)h(the)g
(implementation)f(of)h(the)g(stable)h(subtype.)245 2070
y Fe(PROCEDURE)20 b(DoRun)h(\(<*UNUSED*>)e(w:)j(M3ToolFrame.Wor)o(ker;)
855 2117 y(c:)g(M3Context.T;)615 2165 y(<*UNUSED*>)e(compileResult:)f
(INTEGER\):)h(INTEGER)289 2213 y(RAISES)g({})h(=)289
2261 y(BEGIN)332 2308 y(TRY)376 2356 y(VAR)g(object:)f(Type.Qid;)463
2404 y(reveal,)g(impl,)h(rep:)g(TEXT;)376 2452 y(BEGIN)419
2499 y(StablegenArgs.Get\(o)o(bject)o(,)e(reveal,)h(impl,)h(rep\);)996
2604 y Fn(19)p eop
%%Page: 20 20
20 19 bop 58 141 a Fn(20)872 b Fi(CHAPTER)11 b(3.)24
b(IMPLEMENT)m(A)-5 b(TION)12 b(MODULES)332 258 y Fe(IF)21
b(M3CFETool.CompileInC)o(onte)o(xt\(c\))d(<)k(0)f(THEN)376
305 y(RAISE)f(StablegenError.E\("e)o(rrors)e(in)k(object)e
(declaration"\);)332 353 y(END;)332 401 y(RTCollector.Disabl)o(eMoti)o
(on\(\))o(;)f(\(*)i(because)g(of)1073 449 y("FRefRefTbl")1073
496 y(module)g(*\))332 544 y(TypeNames.Preproce)o(ss\(c\))o(;)332
592 y(GenCode.Do\(c,)e(object,)i(reveal,)f(impl,)h(rep\);)332
640 y(RTCollector.Enable)o(Motio)o(n\(\);)332 687 y(RETURN)g(0;)289
735 y(END)245 783 y(EXCEPT)289 831 y(StablegenError.)o(E\(msg)o(\)=>)e
(StablegenError.)o(Failu)o(re\(ms)o(g\);)332 878 y(RETURN)i(1;)245
926 y(END;)201 976 y(END)h(DoRun;)58 1125 y Fb(3.1.2)51
b(Startup)158 1254 y Fe(<*)21 b(FATAL)g(ANY)g(*>)158
1302 y(BEGIN)201 1349 y(Process.Exit\(ABS\(M3)o(ToolF)o(rame.)o(Star)o
(tup\()615 1397 y(NEW\(M3ToolFrame.Wor)o(ker,)d(work)j(:=)h(DoRun\),)
615 1445 y(compile)f(:=)g(FALSE\)\)\);)158 1495 y(END)g(Main.)58
1597 y Fg(3.2)60 b(Module)14 b(GenCode)58 1717 y Fn(This)c(module)g
(mainly)g(contains)g(main)g(procedures)h(to)e(generate)i(Modula-3)e
(code)i(and)f(checking)h(procedures.)120 1768 y Fe(OneStub\(\))e
Fn(produces)h(the)g(implementation)f(of)h(a)h(stable)f(subtype)g(of)g
(its)f(parameter)j(type.)120 1818 y Fe(CheckStableObj\(\))7
b Fn(checks)12 b(for)e(validy)f(for)g(stable)i(subtyping.)120
1869 y Fe(CheckBrands\(\))d Fn(checks)j(for)f(explicit)f(brands)h(and)g
(prints)f(warnings)h(if)g(where)g(not)g(present.)158
1969 y Fe(MODULE)20 b(GenCode;)158 2043 y(IMPORT)g(Atom,)h(AtomList,)f
(Thread,)g(Lex,)h(Wr,)g(Rd,)h(FileWr,)310 2091 y(TextRd,)f(Formatter,)e
(OSError;)158 2139 y(IMPORT)h(ImportList,)g(GenTypeCode,)f(AstToType,)h
(GenModuleCode,)310 2188 y(StablegenError,)f(Type;)58
2265 y Fn(Imports)10 b(needed)h(for)e(the)h(toolkit-stuf)o(f)d(in)j
Fe(OneStub\(\))158 2365 y(IMPORT)20 b(ASTWalk,)g(M3AST_AS,)g
(M3ASTScope,)g(M3CId,)g(M3CPragma;)158 2413 y(IMPORT)g(M3AST_AS_F,)g
(M3AST_SM_F,)f(M3AST_TM_F,)310 2463 y(M3AST_TL_F,)h(M3Context,)g
(M3CConcTypeSpec)o(,)f(M3CUnit;)p eop
%%Page: 21 21
21 20 bop 145 141 a Fi(3.2.)25 b(MODULE)11 b(GENCODE)1229
b Fn(21)145 258 y Fb(3.2.1)51 b(List)12 b(of)g(additional)f(Imports)145
337 y Fn(The)d(\(readonly\))f(variable)g Fe(implImports)e
Fn(contains)i(all)g(interface)h(names)g(necessary)h(for)e(the)g(code)h
(beeing)f(produced)145 387 y(by)j(the)g(generator)n(.)k(The)d(elements)
g(of)f(this)f(array)i(must)f(be)g(compatible)g(with)f
Fe(ImportList.T)f Fn(elements.)245 487 y Fe(VAR)289 535
y(implImports)19 b(:=)i(ARRAY)g([0)h(..)f(2])g(OF)615
583 y(Atom.T{Atom.FromTex)o(t\("St)o(ableE)o(rror")o(\),)768
631 y(Atom.FromText\("St)o(ableL)o(og"\),)768 680 y(Atom.FromText\("Rd)
o("\)};)145 830 y Fb(3.2.2)51 b(Pr)o(ocedur)o(e)13 b(Do)145
910 y Fn(Main)d(control)f(procedure)i(that)e(takes)i(one)f(typename)h
(and)f(produces)h(the)f(implementation)f(of)h(a)g(stable)h(subtype.)145
1024 y Fk(Parameters)45 b Fe(c)11 b Fn(is)f(the)h(complete)f
(compilation)g(context.)k Fe(qid)c Fn(is)h(the)f(name)i(of)e(the)h
(type)f(\(interface)h(name)g(and)g Fe(T)p Fn(\))145 1074
y(from)h(which)f(a)h(stable)g(subtype)e(shall)i(be)f(produced.)18
b Fe(implName)10 b Fn(and)i Fe(repName)e Fn(are)i(the)g(names)h(of)e
(the)g(generated)145 1124 y(module)f(and)h(the)f(instantiated)e
Fe(StableRep)h Fn(resp.)145 1238 y Fk(Algorithm)40 b
Fn(First)11 b(get)h(the)f(compilation)f(unit)g(AST)j(of)e
Fe(qid)g Fn(\()p Fe(M3Context.FindExa)o(ct\(\))p Fn(\))o(.)16
b(Then)c(we)g(look)e(for)145 1288 y(pragmas)g(starting)d(with)g(the)i
(keyword)e Fe(STABLE)p Fn(.)h(It)g(is)h(interpreted)e(by)h
Fe(ParsePragma\(\))e Fn(\(see)k(below\))d(which)i(gener)o(-)145
1338 y(ates)f(a)f(list)f(of)g(updatemethods)h(\(they)f(will)f(be)i
(checked)h(later)f(in)f Fe(BuildMethods\(\))p Fn(.)k(The)e(call)f(to)f
Fe(M3CConcTypeSpec.Se)o(tCurr)o(entR)o(eveal)o(\(\))145
1388 y Fn(set)12 b(the)f Fe(cu_reveal)f Fn(id)h(to)g(the)g(compilation)
f(unit)g(containing)g(the)i(most)f(speci\256c)h(revealation)f(of)h
Fe(qid)f Fn(\(it)f(must)i(be)145 1438 y(given)e(by)g(the)h(user)f(from)
h(the)f(command)h(line,)g(see)g Fe(StablegenArgs)p Fn(\).)h(Then)f(the)
f(de\256nition)f(of)h Fe(qid)g Fn(is)h(looked)e(up)145
1487 y(\()p Fe(M3ASTScope.Lookup\()o(\))p Fn(\).)i(It)f(is)f(checked)i
(to)f(be)g(an)g(identi\256er)f(of)h(a)g(type)g(de\256nition)e(\(in)h
(the)h(typecase)h(stmt\).)i(W)m(e)145 1537 y(use)h Fe(AstToType.Conver)
o(t\(\))c Fn(to)i(convert)h(the)g(type)f(speci\256cation)h(to)g(a)g
(more)h(handy)e Fe(Type.T)p Fn(.)h(The)g Fe(Type.T)f
Fn(is)145 1587 y(handled)e(in)g Fe(TypeDo\(\))e Fn(\(see)k(there\).)245
1688 y Fe(PROCEDURE)20 b(Do)h(\(c)523 b(:)21 b(M3Context.T;)550
1735 y(qid)479 b(:)21 b(Type.Qid;)550 1783 y(reveal,)f(implName,)g
(repName:)g(TEXT)196 b(\))289 1831 y(RAISES)20 b({StablegenError.E})e
(=)289 1879 y(VAR)j(cu:)g(M3AST_AS.Compilat)o(ion_U)o(nit;)289
1926 y(BEGIN)332 1974 y(IF)g(NOT)h(M3Context.FindEx)o(act\(c)o(,)d
(Atom.ToText\(qid.i)o(ntf\),)921 2022 y(M3CUnit.Type.In)o(terfa)o(ce,)g
(cu\))i(THEN)376 2070 y(RAISE)f(StablegenError.E\("Ca)o(n)f(not)i(find)
g(interface)f(")921 2117 y(&)h(Atom.ToText\(qid.in)o(tf\)\))332
2165 y(END;)332 2213 y(VAR)376 2261 y(pragIter)f(:=)h
(M3CPragma.NewIter\()o(cu.lx)o(_prag)o(mas\);)376 2308
y(prag)86 b(:)22 b(M3CPragma.T;)376 2356 y(umethods:)e(AtomList.T)41
b(:=)22 b(NIL;)332 2404 y(BEGIN)376 2452 y(WHILE)e
(M3CPragma.Next\(pragI)o(ter,)e(prag\))j(DO)419 2499
y(VAR)g(pragText:)f(TEXT;)p eop
%%Page: 22 22
22 21 bop 58 141 a Fn(22)872 b Fi(CHAPTER)11 b(3.)24
b(IMPLEMENT)m(A)-5 b(TION)12 b(MODULES)332 258 y Fe(BEGIN)376
305 y(IF)21 b(M3CPragma.Match\(pr)o(ag,)d("STABLE",)i(pragText\))g
(THEN)419 353 y(ParsePragma\(pragTex)o(t,)f(umethods\))376
401 y(END)i(\(*IF)g(match*\))332 449 y(END)289 496 y(END;)f
(\(*WHILE*\))289 544 y(IF)h(umethods)f(=)i(NIL)f(THEN)332
592 y(RAISE)376 640 y(StablegenError.E)o(\()419 687 y("can)g(not)g
(find)g(STABLE)g(UPDATE)f(METHODS)h(pragma"\);)289 735
y(END;)289 783 y(VAR)332 831 y(used_id:)f(M3AST_AS.USED_ID)f(:=)i
(NEW\()1008 878 y(M3AST_AS.USED_ID)o(\).ini)o(t\(\);)332
926 y(def_id)64 b(:)22 b(M3AST_AS.DEF_ID;)332 974 y(cu_reveal:)e
(M3AST_AS.Compila)o(tion_)o(Unit;)289 1021 y(BEGIN)332
1069 y(used_id.lx_symrep)e(:=)376 1117 y(M3CId.Enter\(Atom)o(.ToTe)o
(xt\(q)o(id.it)o(em\)\);)332 1165 y(IF)j(NOT)h(M3Context.FindEx)o
(act\()528 1212 y(c,)g(reveal,)e(M3CUnit.Type.Inte)o(rface)o(,)528
1260 y(cu_reveal\))g(THEN)376 1308 y(RAISE)g(StablegenError.E\()550
1356 y("Can)h(not)g(find)g(interface)f(")i(&)f(reveal\))332
1403 y(END;)332 1451 y(M3CConcTypeSpec.Se)o(tCurr)o(entR)o(eveal)o(\()
376 1499 y(cu_reveal,)e(ASTWalk.VisitMode.E)o(ntry\))o(;)332
1547 y(def_id)i(:=)g(M3ASTScope.Lookup)o(\()594 1594
y(cu.as_root.as_i)o(d.vSC)o(OPE,)d(used_id\);)332 1642
y(IF)j(def_id)g(=)h(NIL)f(THEN)376 1690 y(RAISE)f(StablegenError.E\(At)
o(om.To)o(Text\()o(qid.i)o(ntf\))e(&)k(".")920 1738 y(&)g
(Atom.ToText\(qid.it)o(em\))920 1785 y(&)g(")g(not)f(defined."\);)332
1833 y(END;)332 1881 y(TYPECASE)f(def_id)h(OF)376 1928
y(M3AST_AS.TYPED_I)o(D)e(\(typed_id\))h(=>)419 1976 y
(TypeDo\(AstToType.Co)o(nver)o(t\(typ)o(ed_id)o(.sm_t)o(ype_s)o(pec\),)
572 2024 y(qid,)h(implName,)f(repName,)g(umethods\))332
2072 y(ELSE)376 2119 y(RAISE)419 2167 y(StablegenError.E\()463
2215 y(Atom.ToText\(qid.i)o(tem\))e(&)k(")f(is)h(not)f(a)h(type)f(in")
506 2263 y(&)h(")g(interface)e(")h(&)h(Atom.ToText\(qid.)o(intf\))o
(\);)332 2310 y(END;)43 b(\(*TYPECASE*\))332 2358 y(M3CConcTypeSpec.Se)
o(tCurr)o(entR)o(eveal)o(\(cu_r)o(eveal)o(,)397 2406
y(ASTWalk.VisitMode.Ex)o(it\);)289 2454 y(END)p eop
%%Page: 23 23
23 22 bop 145 141 a Fi(3.2.)25 b(MODULE)11 b(GENCODE)1229
b Fn(23)332 258 y Fe(END)289 307 y(END)21 b(Do;)145 443
y Fk(T)m(ypeDo)145 520 y Fn(If)9 b(it)f(is)g(an)h(opaque)g(type)f(we)i
(proceed)f(to)f(the)h(revealation)f(of)g(that)g(type)h(\(which)f(must)g
(be)h(visible\).)k(The)c(check)h(proce-)145 570 y(dure)g
Fe(CheckStableObj\(\))c Fn(is)k(then)f(called.)14 b(If)c
Fe(qid)f Fn(is)g(valid)g(for)g(stable)h(subtyping,)e(we)i(check)h(for)e
(explicit)f(brands)145 620 y(\(since)j(object)e(used)i(outside)e(of)g
(the)h(program)g(that)g(generated)g(it)f(should)g(have)i(an)f(explicit)
f(brand\).)k(Finally)c(we)i(call)145 670 y Fe(GenStableImpl\(\))d
Fn(which)h(will)g(generate)i(the)f(Modula-3)g(code)g(for)g(the)g
(stable)g(object)g(implementation.)245 767 y Fe(PROCEDURE)20
b(TypeDo)g(\(type)283 b(:)21 b(Type.T;)637 815 y(qid)305
b(:)21 b(Type.Qid;)637 863 y(implName,)f(repName:)g(TEXT;)637
910 y(umethods)195 b(:)21 b(AtomList.T\))289 958 y(RAISES)f
({StablegenError.E})e(=)289 1006 y(BEGIN)332 1054 y(WHILE)j
(ISTYPE\(type,)e(Type.Opaque\))g(DO)376 1101 y(type)i(:=)g
(NARROW\(type,)e(Type.Opaque\).reveal)o(edSup)o(erTyp)o(e)332
1149 y(END;)332 1197 y(IF)i(CheckStableType\(type)o(\))e(THEN)376
1245 y(IF)i(NOT)g(CheckBrands\(type\))e(THEN)419 1292
y(StablegenError.Warn)o(ing\()463 1340 y("you)i(should)f(use)i
(explicitly)d(branded)i(type"\);)376 1388 y(END;)376
1436 y(GenStableImpl\(qi)o(d,)e(type,)i(implName,)e(repName,)i
(umethods\);)332 1483 y(ELSE)376 1531 y(RAISE)f(StablegenError.E\()419
1579 y(Atom.ToText\(qid.int)o(f\))f(&)i(".")g(&)h(Atom.ToText\(qid.it)o
(em\))463 1627 y(&)f(")h(can)f(not)g(be)h(made)f(stable)f(\(not)h(an)h
(object)e(type)h(or)h(has")463 1674 y(&)f(")h(procedure)e(parameters)g
(in)h(update)g(methods\)"\);)332 1722 y(END)289 1772
y(END)g(TypeDo;)145 1907 y Fk(ParsePragma)145 1985 y
Fn(Parse)12 b(the)e(pragma)307 2059 y Fe(<*STABLE)20
b(UPDATE)h(METHODS)f(meth1,)h(meth2,)f(...*>)145 2134
y Fn(The)9 b(pragma)g(may)g(appear)g(more)g(than)f(once.)14
b Fe(txt)8 b Fn(is)g(set)h(to)f(the)g(string)f(that)h(starts)g(with)f
Fe(UPDATE...)p Fn(.)12 b Fe(methods)7 b Fn(will)145 2184
y(contains)j(the)g(accumulated)h(list)e(of)h(methods.)k(They)d(are)g
(separated)g(by)f(blanks.)208 2234 y(The)g(pragma)g(has)h(a)f(second)g
(form)g(\(only)e(method)i(stated)f(is)h(the)g(keyword)f
Fe(ANY)p Fn(\))g(which)g(is)h(not)f(checked)i(in)e(here.)245
2331 y Fe(PROCEDURE)20 b(ParsePragma)f(\(txt:)i(TEXT;)g(VAR)g(methods:)
f(AtomList.T\))289 2379 y(RAISES)g({StablegenError.E})e(=)289
2427 y(<*FATAL)i(Rd.Failure,)f(Thread.Alerted*>)289 2499
y(PROCEDURE)g(Add)j(\(VAR)f(methods:)f(AtomList.T;)f(methname:)h
(TEXT\))p eop
%%Page: 24 24
24 23 bop 58 141 a Fn(24)872 b Fi(CHAPTER)11 b(3.)24
b(IMPLEMENT)m(A)-5 b(TION)12 b(MODULES)245 258 y Fe(RAISES)20
b({StablegenError.E})f(=)245 305 y(BEGIN)289 353 y(IF)i(methods)f(=)i
(NIL)f(THEN)332 401 y(methods)f(:=)i(AtomList.List1\(A)o(tom.F)o(romTe)
o(xt\(me)o(thnam)o(e\)\))289 449 y(ELSE)332 496 y(IF)f
(AtomList.Member\(meth)o(ods,)d(Atom.FromText\(methn)o(ame\)\))g(THEN)
376 544 y(RAISE)i(StablegenError.E\()550 592 y("duplicate)g(entry)g(")i
(&)g(methname)594 640 y(&)f(")h(in)f(STABLE)g(UPDATE)f(METHODS)h
(pragma"\);)332 687 y(END;)332 735 y(methods)f(:=)376
783 y(AtomList.Cons\(At)o(om.Fr)o(omTe)o(xt\(me)o(thnam)o(e\),)f
(methods\))289 831 y(END)245 878 y(END)i(Add;)201 957
y(CONST)g(IdChars)f(=)i(SET)f(OF)h(CHAR{'_',)d('A'..'Z',)h('a'..'z',)g
('0'..'9'};)201 1005 y(VAR)245 1053 y(rd)283 b(:=)21
b(TextRd.New\(txt\);)245 1100 y(methname:)f(TEXT;)201
1148 y(BEGIN)245 1196 y(TRY)289 1244 y(Lex.Skip\(rd\);)289
1291 y(Lex.Match\(rd,)f("UPDATE"\);)289 1339 y(Lex.Skip\(rd\);)289
1387 y(Lex.Match\(rd,)g("METHODS"\);)289 1434 y(Lex.Skip\(rd\);)289
1513 y(\(*)i(First)g(one)g(is)g(special:)f(Has)h(no)h(``,'')f(in)g
(front)g(and)354 1561 y("methods")f(may)h(be)g("NIL")g(*\))289
1609 y(IF)g(Rd.EOF\(rd\))f(THEN)332 1657 y(RAISE)h(StablegenError.E\()
506 1704 y("empty)g(STABLE)g(UPDATE)f(METHODS)g(pragma"\);)289
1752 y(ELSE)332 1800 y(methname)g(:=)i(Lex.Scan\(rd,)d(IdChars\);)332
1848 y(Add\(methods,)g(methname\);)289 1895 y(END;)h(\(*IF*\))289
1974 y(\(*)h(Consume)f(comma)h(and)g(read)g(method)g(names)f(*\))289
2022 y(Lex.Skip\(rd\);)289 2070 y(WHILE)g(NOT)h(Rd.EOF\(rd\))f(DO)332
2117 y(Lex.Match\(rd,)f(","\);)332 2165 y(Lex.Skip\(rd\);)332
2213 y(methname)h(:=)i(Lex.Scan\(rd,)d(IdChars\);)332
2261 y(Add\(methods,)g(methname\);)332 2308 y(Lex.Skip\(rd\);)289
2356 y(END;)245 2404 y(EXCEPT)289 2452 y(Lex.Error)g(=>)332
2499 y(RAISE)i(StablegenError.E\()p eop
%%Page: 25 25
25 24 bop 145 141 a Fi(3.2.)25 b(MODULE)11 b(GENCODE)1229
b Fn(25)594 258 y Fe("error)20 b(in)i(pragma:)e(STABLE)g(")i(&)g
(txt\);)332 305 y(END)289 355 y(END)f(ParsePragma;)145
501 y Fb(3.2.3)51 b(Pr)o(ocedur)o(e)13 b(CheckStableT)l(ype)145
579 y Fn(A)e(object)e(suitable)h(for)g(the)g(stable)g(subtype)g
(generator)g(must:)197 663 y(1.)21 b(Be)11 b(an)f(object)g(type)197
747 y(2.)21 b(\(NOT)11 b(CHECKED)f(YET\))h(Not)f(update)g(method)f(can)
i(have)g(a)g(procedure)f(type)g(as)h(parameter)145 831
y(If)f(both)f(holds)h(for)g(the)g(the)g(type)g(speci\256cation)g(in)g
(parameter)h Fe(o)p Fn(,)f(the)h(procedure)f(will)f(return)g
Fe(TRUE)p Fn(.)245 929 y Fe(PROCEDURE)20 b(CheckStableType)f(\(type:)h
(Type.T\):)g(BOOLEAN)h(=)289 977 y(BEGIN)332 1025 y(TYPECASE)f(type)h
(OF)376 1073 y(Type.Object=>)e(RETURN)h(TRUE;)376 1120
y(ELSE)h(RETURN)f(FALSE;)332 1168 y(END;)289 1218 y(END)h
(CheckStableType;)145 1364 y Fb(3.2.4)51 b(Pr)o(ocedur)o(e)13
b(CheckBrands)145 1442 y Fn(T)m(ake)g(a)f(type)f Fe(t)g
Fn(an)h(check)g(if)f(it)g(is)g(a)h(branded)g(type)f(with)f(an)i
(explicit)e(brand,)i(or)f(if)g(it)f(contains)h(\256elds)h(with)e
(branded)145 1492 y(types)f(with)f(explicit)f(brands.)13
b(Return)8 b Fe(TRUE)g Fn(if)h(all)f(brands)h(are)g(explicit.)k(If)8
b(not,)h(warning)f(messages)j(are)e(printed)f(and)145
1541 y Fe(FALSE)i Fn(is)g(returned.)245 1640 y Fe(PROCEDURE)20
b(CheckBrands)f(\(t:)j(Type.T\):)e(BOOLEAN)g(=)289 1688
y(VAR)h(ok)g(:=)g(TRUE;)289 1735 y(BEGIN)332 1783 y(IF)g(t)h(=)g(NIL)f
(THEN)g(RETURN)f(TRUE)h(END;)332 1831 y(IF)g(t.visited)f(THEN)h(RETURN)
g(t.brandsOK)f(END;)332 1879 y(t.visited)g(:=)h(TRUE;)332
1926 y(TYPECASE)f(t)i(OF)332 1974 y(|)g(Type.Reference)d(\(ref\))h(=>)
419 2022 y(IF)i(ref.branded)d(AND)i(ref.brand)f(=)i(NIL)f(THEN)463
2070 y(StablegenError.Wa)o(rning)o(\()550 2117 y("Branded)f(type)h
(with)g(no)g(explicit)g(brand)f(--)i(")550 2165 y(&)g(GenTypeCode.ToTe)
o(xt\(r)o(ef\)\);)463 2213 y(ok)f(:=)h(FALSE;)419 2261
y(END;)419 2308 y(TYPECASE)e(ref)i(OF)419 2356 y(|)g(Type.Ref)e(\(r\))h
(=>)h(t.brandsOK)d(:=)j(CheckBrands\(r.ta)o(rget\))c(AND)j(ok)419
2404 y(|)h(Type.Object)d(\(obj\))i(=>)506 2452 y(ok)h(:=)f
(CheckBrands\(obj.su)o(per\))d(AND)k(ok;)506 2499 y(FOR)g(i)f(:=)h(0)f
(TO)h(LAST\(obj.fields)o(^\))d(DO)p eop
%%Page: 26 26
26 25 bop 58 141 a Fn(26)872 b Fi(CHAPTER)11 b(3.)24
b(IMPLEMENT)m(A)-5 b(TION)12 b(MODULES)463 258 y Fe(ok)21
b(:=)h(CheckBrands\(obj)o(.fiel)o(ds[i])o(.type)o(\))d(AND)i(ok;)419
305 y(END;)419 353 y(FOR)g(i)h(:=)f(0)h(TO)f(LAST\(obj.methods^\))d(DO)
463 401 y(ok)j(:=)h(CheckSigBrands\()o(obj.m)o(ethod)o(s[i].)o(sig\))c
(AND)k(ok;)419 449 y(END;)419 496 y(t.brandsOK)e(:=)h(ok)332
544 y(|)h(Type.Opaque)d(\(opq\))i(=>)419 592 y(t.brandsOK)f(:=)h
(CheckBrands\(opq.rev)o(ealed)o(Super)o(Type\))d(AND)j(ok)332
640 y(ELSE)376 687 y(t.brandsOK)e(:=)j(ok)332 735 y(END;)245
783 y(|)g(Type.Array)d(\(arr\))i(=>)g(t.brandsOK)f(:=)h
(CheckBrands\(arr.elem)o(ent\))d(AND)j(ok)245 831 y(|)h(Type.Packed)d
(\(p\))i(=>)h(t.brandsOK)d(:=)j(CheckBrands\(p.ba)o(se\))d(AND)i(ok)245
878 y(|)h(Type.Record)d(\(rec\))i(=>)332 926 y(FOR)g(i)h(:=)f(0)h(TO)f
(LAST\(rec.fields^\))d(DO)376 974 y(ok)j(:=)g(CheckBrands\(rec.fie)o
(lds[i)o(].typ)o(e\))e(AND)i(ok;)332 1021 y(END;)332
1069 y(t.brandsOK)f(:=)h(ok;)245 1117 y(|)h(Type.Procedure)c(\(proc\))j
(=>)g(t.brandsOK)f(:=)h(CheckSigBrands\(proc)o(.sig\))o(;)245
1165 y(ELSE)289 1212 y(t.brandsOK)e(:=)j(TRUE)245 1260
y(END;)245 1308 y(RETURN)e(t.brandsOK;)201 1356 y(END)i(CheckBrands;)
158 1431 y(PROCEDURE)e(CheckSigBrands)f(\(sig:)h(Type.Signature\):)f
(BOOLEAN)h(=)201 1478 y(VAR)i(ok)f(:=)g(TRUE;)201 1526
y(BEGIN)245 1574 y(FOR)g(i)h(:=)f(0)h(TO)f(LAST\(sig.formals^)o(\))e
(DO)289 1622 y(ok)i(:=)g(CheckBrands\(sig.for)o(mals)o([i].t)o(ype\))d
(AND)k(ok)245 1669 y(END;)245 1717 y(RETURN)e(CheckBrands\(sig.resu)o
(lt\))e(AND)k(ok;)201 1767 y(END)g(CheckSigBrands;)58
1921 y Fb(3.2.5)51 b(Pr)o(ocedur)o(e)13 b(GenStableImpl)58
2001 y Fn(T)m(ake)d(a)f Fe(Type.T)f Fn(structure)g Fe(type)g
Fn(representing)h(an)g(object)f(type)g(and)h(generate)h(an)f
(implementation)e(of)i(a)g(stable)g(sub-)58 2051 y(type)h(of)g
Fe(type)f Fn(in)h(module)g Fe(implName)p Fn(.)120 2102
y(The)h(writer)e(to)h(put)f(the)g(implementation)g(Modula-3)g(code)h
(is)g(a)h Fe(Formatter.T)p Fn(.)d(The)i(method)g(list)f(of)g
Fe(type)h Fn(and)58 2152 y(its)j(supertypes)g(is)g(produced)g(by)g
Fe(BuildMethods\(\))e Fn(\(see)j(there\).)24 b Fe(ImportList.FromT)o
(ype\(\))10 b Fn(takes)k(the)f(type)58 2202 y(structure)8
b(and)h(the)g(a)g(list)e(of)i(its)f(methods)g(to)g(look)g(up)g(all)h
(necessary)h(imports)e(to)g(compile)g(the)h(type)f(and)h(the)g
(methods.)58 2251 y(W)m(e)g(add)f(the)g(global)f Fe(stableObjImports)p
Fn(,)f(the)i(list)f(of)h(interfaces)g(needed)h(by)f(generated)g(code,)i
(to)d(this)h(list.)k(Finally)58 2301 y(generate)f(the)f(logging)e
(overrides,)j(the)f(respool)f(procedure,)i(the)f(replay)g(stubs)g(and)g
(\256nish)g(up.)158 2404 y Fe(PROCEDURE)20 b(GenStableImpl)f(\(name)282
b(:)22 b(Type.Qid;)703 2452 y(type)282 b(:)22 b(Type.Object;)703
2499 y(implName,)d(repName:)i(TEXT;)p eop
%%Page: 27 27
27 26 bop 145 141 a Fi(3.2.)25 b(MODULE)11 b(GENCODE)1229
b Fn(27)790 258 y Fe(umethods)194 b(:)22 b(AtomList.T)63
b(\))289 305 y(RAISES)20 b({StablegenError.E})e(=)289
353 y(<*FATAL)i(OSError.E,)g(Wr.Failure*>)289 401 y(VAR)332
449 y(methods:)g(ImportList.MethodLi)o(st;)332 496 y(modWr)43
b(:)21 b(Formatter.T;)289 544 y(BEGIN)332 592 y(TRY)376
640 y(modWr)f(:=)i(Formatter.New\(Fil)o(eWr.)o(Open\()o(implN)o(ame)d
(&)i(".m3"\)\);)376 687 y(methods)f(:=)h(BuildMethods\(type,)d
(umethods\);)376 735 y(VAR)j(imports)f(:=)i(ImportList.From)o(Type\()o
(type,)c(methods\);)376 783 y(BEGIN)419 831 y(FOR)j(i)h(:=)f
(FIRST\(implImports\))d(TO)k(LAST\(implImports\))c(DO)463
878 y(ImportList.Add\(im)o(ports)o(,)h(implImports[i]\);)419
926 y(END;)419 974 y(ImportList.Add\(impo)o(rts,)f(name.intf\);)419
1021 y(ImportList.Add\(impo)o(rts,)g(Atom.FromText\(repNa)o(me\)\);)419
1069 y(GenModuleCode.Heade)o(r\()463 1117 y(modWr,)i(implName,)g
(methods,)g(imports\);)376 1165 y(END;)376 1212 y(GenModuleCode.Re)o
(veala)o(tion\()o(modW)o(r,)f(repName,)h(methods\);)376
1260 y(GenModuleCode.Su)o(rroga)o(tes\()419 1308 y(modWr,)h(name,)g
(repName,)f(methods\);)376 1356 y(GenModuleCode.Di)o(spatc)o(her\(m)o
(odWr)o(,)f(methods\);)376 1403 y(GenModuleCode.Re)o(playS)o(tubs\()o
(modW)o(r,)g(name,)i(methods\);)376 1451 y(GenModuleCode.Ch)o(eckpo)o
(int\(m)o(odWr)o(,)e(repName\);)376 1499 y(Formatter.PutTex)o(t\(mod)o
(Wr,)g("BEGIN\\n"\);)376 1547 y(Formatter.PutTex)o(t\(mod)o(Wr,)g("END)
h(")i(&)g(implName)e(&)h("."\);)376 1594 y(Formatter.NewLin)o(e\(mod)o
(Wr\);)332 1642 y(FINALLY)376 1690 y(Formatter.Close\()o(modWr)o(\);)
332 1738 y(END;)289 1787 y(END)g(GenStableImpl;)145 1929
y Fb(3.2.6)51 b(Pr)o(ocedur)o(e)13 b(BuildMethods)145
2006 y Fn(T)m(ake)f(a)g(type)e Fe(type)g Fn(and)h(build)e(a)j(list)d
(of)i(all)f(its)g(methods)h(by)f(scanning)h(the)f(methods)h(declared)g
(by)g Fe(t)g Fn(and)f(all)h(its)f(su-)145 2056 y(pertypes.)k(Copy)9
b(only)h(those)g(methods)g(in)f(the)h(result)g(list)f(that)h(are)h
(listed)e(in)h Fe(umethods)p Fn(.)208 2106 y Fe(Umethods)e
Fn(is)i(checked:)k(If)9 b(it)h(contains)f Fe(ANY)g Fn(it)g(must)h(be)g
(the)g(only)f(element.)14 b(All)9 b(methods)h(listed)f(in)g
Fe(umethods)145 2156 y Fn(must)h(be)h(declared)g(in)f
Fe(type)f Fn(otherwise.)208 2206 y(The)e(procedure)h(recursivly)e
(walks)h(through)f(all)h(supertypes)f(of)h Fe(type)p
Fn(.)13 b(If)7 b(the)g(variable)g Fe(count)f Fn(is)h(zero)h(or)f
(negativ)m(,)145 2255 y(the)12 b(methods)f(declared)h(for)f
Fe(type)g Fn(will)f(be)i(counted)f(\()p Fe(ANY)g Fn(was)h(used\),)g
(otherwise)f(the)g(number)g(of)h(methods)f(found)145
2305 y(in)g Fe(type)f Fn(that)h(are)g(contained)g(in)f
Fe(umethods)g Fn(must)h(be)g(the)g(same)h(as)g(the)f(length)f(of)h
Fe(umethods)e Fn(\(i.e.)j(no)f(undeclared)145 2355 y(methods)f(are)h
(in)f Fe(umethods)p Fn(\).)208 2405 y(Non)f(of)h(the)g(method)g(names)i
(listed)d(in)h Fe(reserved)f Fn(may)h(appear)h(in)f(the)g(as)h(name)g
(of)f(an)h(update)f(method.)245 2499 y Fe(VAR)21 b(reserved:=)f
(NEW\(AtomList.T,)f(head:=)h(Atom.FromText\("ini)o(t"\),)e(tail:=)p
eop
%%Page: 28 28
28 27 bop 58 141 a Fn(28)872 b Fi(CHAPTER)11 b(3.)24
b(IMPLEMENT)m(A)-5 b(TION)12 b(MODULES)485 258 y Fe(NEW\(AtomList.T,)18
b(head:=)j(Atom.FromText\("di)o(spose)o("\),)d(tail:=)485
305 y(NEW\(AtomList.T,)g(head:=)j(Atom.FromText\("fl)o(ushLo)o(g"\),)d
(tail:=)485 353 y(NEW\(AtomList.T,)g(head:=)j(Atom.FromText\("fr)o
(eeLog)o("\),)d(tail:=)485 401 y(NEW\(AtomList.T,)g(head:=)j
(Atom.FromText\("wr)o(iteCh)o(eckp)o(oint")o(\),)e(tail:=)485
449 y(NEW\(AtomList.T,)f(head:=)j(Atom.FromText\("re)o(adChe)o(ckpo)o
(int"\))o(,)e(tail:=)485 496 y(NEW\(AtomList.T,)f(head:=)j
(Atom.FromText\("re)o(playL)o(og"\))o(,)572 544 y(tail:=)f
(NIL\)\)\)\)\)\)\);)158 615 y(PROCEDURE)g(BuildMethods)f(\(type)86
b(:)22 b(Type.Object;)681 662 y(umethods:)e(AtomList.T)63
b(\):)201 710 y(ImportList.MethodLi)o(st)19 b(RAISES)h
({StablegenError.E})e(=)201 781 y(PROCEDURE)i(Search)h(\()87
b(type)f(:)22 b(Type.Reference;)594 828 y(VAR)f(count)64
b(:)22 b(INTEGER;)594 876 y(VAR)f(top)108 b(:)22 b(CARDINAL;)681
924 y(umethods:)e(AtomList.T)63 b(\):)245 972 y(ImportList.Method)o
(List)18 b(RAISES)j({StablegenError.E)o(})e(=)245 1019
y(VAR)i(methods:)f(ImportList.MethodL)o(ist;)245 1067
y(BEGIN)289 1115 y(IF)h(\(type)g(=)g(Type.root\))f(OR)h(\(type)g(=)h
(NIL\))f(THEN)g(\(*)g(base)g(of)1291 1163 y(recursion)f(*\))332
1210 y(RETURN)h(NEW\(ImportList.M)o(etho)o(dList)o(,)e(ABS\(count\)\))
289 1258 y(ELSE)158 1306 y(TYPECASE)h(type)h(OF)376 1354
y(Type.Object)e(\(ob\))i(=>)376 1401 y(IF)g(count)g(<=)g(0)h(THEN)419
1449 y(count:=)f(count)f(-)i(NUMBER\(ob.methods)o(^\))376
1497 y(END;)376 1544 y(methods)e(:=)h(Search\(ob.super,)e(count,)h
(top,)h(umethods\);)376 1592 y(FOR)g(i)g(:=)h(0)f(TO)h
(LAST\(ob.methods^)o(\))d(DO)419 1640 y(IF)j(umethods)e(=)h(NIL)463
1688 y(OR)g(AtomList.Member\()615 1735 y(umethods,)f
(ob.methods[i].name\))e(THEN)463 1783 y(IF)j(AtomList.Member\(re)o
(serve)o(d,)e(ob.methods[i].nam)o(e\))g(THEN)506 1831
y(RAISE)i(StablegenError.E\(A)o(tom.T)o(oText)o(\(ob.m)o(ethod)o(s[i])o
(.name)o(\))506 1879 y(&")h(is)f(a)h(reserved)e(method)g(name)h(in)h
(stable)e(objects.)g(")506 1926 y(&"Must)h(not)g(be)h(an)f(update)f
(method."\))463 1974 y(END;)463 2022 y(methods[top].name)e(:=)j
(ob.methods[i].name;)463 2070 y(methods[top].sig)d(:=)k
(ob.methods[i].si)o(g;)463 2117 y(INC\(top\))419 2165
y(END)376 2213 y(END;)376 2261 y(RETURN)e(methods)332
2308 y(|)i(Type.Opaque)d(\(op\))i(=>)376 2356 y(RETURN)f
(Search\(op.revealed)o(Super)o(Type,)e(count,)j(top,)g(umethods\))332
2404 y(|)h(Type.Reference)d(=>)i(<*ASSERT)f(FALSE*>)332
2452 y(END)289 2499 y(END)p eop
%%Page: 29 29
29 28 bop 145 141 a Fi(3.3.)25 b(MODULE)11 b(GENMODULECODE)1052
b Fn(29)332 258 y Fe(END)21 b(Search;)289 331 y(VAR)g(count:)f
(INTEGER;)289 378 y(BEGIN)332 426 y(IF)h(AtomList.Member\(umet)o(hods,)
d(Atom.FromText\("ANY)o("\)\))h(THEN)376 474 y(IF)i
(AtomList.Length\(um)o(ethod)o(s\))e(#)i(1)h(THEN)419
522 y(RAISE)463 569 y(StablegenError.E\()550 617 y("STABLE)e(UPDATE)h
(METHODS)f(ANY)h(used)g(with)g(other)g(methods"\))376
665 y(END;)376 712 y(umethods)f(:=)h(NIL;)261 b(\(*)21
b(take)g(all)g(*\))376 760 y(count:=)f(0;)479 b(\(*)21
b(and)h(count)e(them)h(*\))332 808 y(ELSE)376 856 y(count:=)f
(AtomList.Length\(um)o(etho)o(ds\);)332 903 y(END;)332
951 y(VAR)376 999 y(top)h(:)g(CARDINAL)g(:=)g(0;)376
1047 y(methList)f(:=)h(Search\(type,)f(count,)g(top,)h(umethods\);)332
1094 y(BEGIN)376 1142 y(IF)g(ABS\(count\))f(#)h(top)h(THEN)419
1190 y(RAISE)463 1238 y(StablegenError.E\()550 1285 y("method)e(listed)
h(in)g(STABLE)g(UPDATE)f(METHODS)h(pragma)f(not)h(declared"\);)376
1333 y(END;)376 1381 y(RETURN)f(methList)332 1429 y(END)289
1476 y(END)h(BuildMethods;)245 1549 y(BEGIN)245 1599
y(END)g(GenCode.)145 1765 y Fg(3.3)60 b(Module)15 b(GenModuleCode)145
1883 y Fn(Produce)c(Modula-3)e(code)i(for)e(the)h(stable)h(object')n(s)
e(implementation)245 1981 y Fe(MODULE)20 b(GenModuleCode;)245
2054 y(IMPORT)g(Atom,)h(GenTypeCode,)f(Fmt,)h(Formatter,)e
(StablegenError,)g(Text,)397 2102 y(ImportList,)h(Type,)h(Value,)f(Wr;)
245 2177 y(<*)h(FATAL)g(Wr.Failure*>)145 2322 y Fb(3.3.1)51
b(Name)13 b(pr)o(eambles)145 2400 y Fn(The)h(following)c(constants)j
(are)h(used)f(to)f(alter)h(the)g(user)g(identi\256er)f(where)h
(necessary)m(.)24 b Fe(PreLogMeths)11 b Fn(is)h(inserted)145
2449 y(before)i(the)f(name)i(of)e(the)h(updatemethod)f(to)g(get)g(the)h
(name)g(recording)f(version)g(of)g(the)h(method.)24 b(The)14
b(replaying)145 2499 y(procedure)d(has)f Fe(PreReplayMeth)e
Fn(as)j(\256rst)f(part)g(of)g(the)g(name.)p eop
%%Page: 30 30
30 29 bop 58 141 a Fn(30)872 b Fi(CHAPTER)11 b(3.)24
b(IMPLEMENT)m(A)-5 b(TION)12 b(MODULES)120 258 y Fn(T)m(o)g(avoid)f
(name)h(con\257ics)g(between)g(user)g(ar)o(guments)f(and)h(ar)o
(guments)f(produced)g(by)g(the)h(generator)n(,)g Fe(PreArgs)58
307 y Fn(is)e(inserted)g(befor)g(ar)o(gument)g(identi\256er)n(.)158
407 y Fe(CONST)201 455 y(PreLogMeths)85 b(=)22 b("Log_";)201
503 y(PreReplayMeths)d(=)j("Replay_";)201 552 y(SuffArgs)151
b(=)22 b("_arg";)58 700 y Fb(3.3.2)51 b(Utility)11 b(pr)o(ocedur)o(es)h
(and)g(abr)o(eviations)58 779 y Fn(All)e(procedures)h(that)f(output)f
(code)i(in)f(this)g(module)h(use)g(the)f Fe(Formatter)f
Fn(module.)16 b(The)11 b(following)d(abreviation)i(is)58
829 y(used)h(by)e(all)h(procedures)h(in)f(order)f(to)h(get)g(better)g
(readable)h(program)f(text:)285 905 y Fe(WITH)21 b(Put)87
b(=)21 b(Formatter.PutText,)394 955 y(Nl)109 b(=)21 b
(Formatter.NewLine,)394 1005 y(Tab)87 b(=)21 b(Formatter.Begin,)394
1056 y(EndTab)g(=)g(Formatter.End)129 b(DO)58 1132 y
Fn(Often)10 b(used)g Fe(Formatter)p Fn(-procedure)f(sequences)i(are)h
(combined)e(in)f(the)h(procdures)g Fe(PutLine)p Fn(.)158
1232 y Fe(PROCEDURE)20 b(PutLine)g(\(fmtWr:)g(Formatter.T;)g(text:)g
(TEXT\))h(=)201 1279 y(BEGIN)245 1327 y(Formatter.PutText)o(\(fmtW)o
(r,)e(text\);)245 1375 y(Formatter.NewLine)o(\(fmtW)o(r,)g(freshLine)h
(:=)h(FALSE\);)201 1425 y(END)h(PutLine;)58 1572 y Fb(3.3.3)51
b(Generate)11 b(pr)o(ocedur)o(e)i(calls)58 1651 y Fn(Several)f
(procedure)f(calls)g(are)h(generated)f(by)g(the)g(following)d
(procedures.)17 b Fe(SuperCall\(\))9 b Fn(generates)j(a)f(call)g(to)g
(the)58 1701 y(original)e(update)h(method.)j Fe(StableLogCall\(\))8
b Fn(generates)j(calls)f(to)g(procedures)g(of)g(the)g
Fe(StableLog)f Fn(module.)120 1751 y(The)h(parameters)g(of)f(type)g
Fe(Direction)e Fn(determin)i(wether)g(the)g(call)g(is)f(used)i(in)e
(the)h(logging)e(procedure)i(\()p Fe(Direc-)58 1801 y(tion.Log)p
Fn(\))g(or)h(in)f(the)h(replay)h(procedures)f(\()p Fe(Direction.Replay)
p Fn(\))o(.)158 1900 y Fe(TYPE)21 b(Direction)f(=)h({Replay,)f(Log};)
158 1974 y(PROCEDURE)g(SuperCall)g(\(f)108 b(:)22 b(Formatter.T;)615
2022 y(name)43 b(:)22 b(Type.Qid;)615 2070 y(method:)f
(ImportList.Metho)o(d;)615 2117 y(suffix:)g(TEXT;)615
2165 y(d)109 b(:)22 b(Direction)216 b(\))21 b(=)201 2213
y(BEGIN)245 2261 y(WITH)g(Put)g(=)h(Formatter.PutTex)o(t)d(DO)289
2308 y(Put\(f,)h(Atom.ToText\(name.i)o(ntf\))e(&)k(".T.")485
2356 y(&)f(Atom.ToText\(method)o(.name)o(\)\);)289 2404
y(Put\(f,)f("\(self"\);)289 2452 y(FOR)h(i)g(:=)h(0)f(TO)h
(LAST\(method.sig)o(.form)o(als^\))c(DO)332 2499 y(WITH)j(formals)f(=)i
(method.sig.formal)o(s[i])c(DO)p eop
%%Page: 31 31
31 30 bop 145 141 a Fi(3.3.)25 b(MODULE)11 b(GENMODULECODE)1052
b Fn(31)463 258 y Fe(Put\(f,)20 b(",)i("\);)463 305 y(Put\(f,)e
(Atom.ToText\(formals)o(.name)o(\))f(&)j(suffix\);)463
353 y(IF)f(d)h(=)f(Direction.Replay)572 401 y(AND)g(ISTYPE\(formals.ty)
o(pe,)e(Type.OpenArray\))f(THEN)506 449 y(Put\(f,)j("^"\))463
496 y(END;)419 544 y(END;)376 592 y(END;)376 640 y(Put\(f,)f("\)"\);)
332 687 y(END)h(\(*WITH*\))289 735 y(END)g(SuperCall;)245
804 y(PROCEDURE)f(StableLogCall)f(\(f)130 b(:)22 b(Formatter.T;)790
852 y(proc)64 b(:)22 b(TEXT;)790 900 y(varName:)e(TEXT;)790
947 y(d)130 b(:)22 b(Direction;)790 995 y(ranges)369
b(:=)21 b(""\))h(=)289 1043 y(BEGIN)332 1091 y(WITH)f(Put)g(=)h
(Formatter.PutText)c(DO)376 1138 y(IF)j(d)h(=)f(Direction.Replay)e
(THEN)419 1186 y(Put\(f,)i(varName)f(&)i(")f(:=)h(StableLog.In")d(&)i
(proc)g(&)h("\(log")615 1234 y(&)g(ranges)f(&)g("\);"\);)376
1282 y(ELSE)419 1329 y(Put\(f,)g("StableLog.Out")e(&)i(proc)g(&)h
("\(self.log,)d(")615 1377 y(&)j(varName)e(&)i(ranges)e(&)i("\);"\);)
376 1425 y(END)f(\(*IF*\))332 1472 y(END)g(\(*WITH*\))289
1522 y(END)g(StableLogCall;)145 1661 y Fb(3.3.4)51 b(Pr)o(ocedur)o(e)13
b(Header)145 1738 y Fn(W)n(rite)7 b Fe(MODULE)p Fn(...,)h(imports)e(\()
p Fe(ImportList.ToTe)o(xt\(\))p Fn(\))s(and)h(the)g(enumeration)f(type)
h Fe(TYPE)21 b(Methods)5 b Fn(used)i(to)f(gather)145
1788 y(method)k(codes)h(\()p Fe(EnumerateMethods\()o(\))d
Fn(below\).)245 1879 y Fe(PROCEDURE)20 b(Header)g(\(f)196
b(:)22 b(Formatter.T;)637 1926 y(implName)42 b(:)22 b(TEXT;)637
1974 y(methods)64 b(:)22 b(ImportList.Metho)o(dList)o(;)637
2022 y(importList:)e(ImportList.T)237 b(\))22 b(=)289
2070 y(BEGIN)332 2117 y(WITH)f(Put)87 b(=)21 b(Formatter.PutText,)441
2165 y(Nl)109 b(=)21 b(Formatter.NewLine,)441 2213 y(Tab)87
b(=)21 b(Formatter.Begin,)441 2261 y(EndTab)g(=)g(Formatter.End)128
b(DO)376 2308 y(PutLine\(f,)19 b("\(*)j(This)f(file)g(was)g(generated)f
(by)h(the)g(program)g(stablegen)e(*\)"\);)376 2356 y(Nl\(f,)h
(freshLine)g(:=)i(FALSE\);)376 2404 y(Put\(f,)e("MODULE)h(")g(&)h
(implName)e(&)h(";"\);)g(Nl\(f\);)376 2452 y(Nl\(f,)f(freshLine)g(:=)i
(FALSE\);)376 2499 y(Put\(f,)e("IMPORT)h("\);)p eop
%%Page: 32 32
32 31 bop 58 141 a Fn(32)872 b Fi(CHAPTER)11 b(3.)24
b(IMPLEMENT)m(A)-5 b(TION)12 b(MODULES)289 258 y Fe(Put\(f,)20
b(ImportList.ToText\()o(impo)o(rtLis)o(t\))f(&)i(";"\);)g(Nl\(f\);)289
305 y(Nl\(f,)f(freshLine)g(:=)i(FALSE\);)289 353 y(Put\(f,)e("TYPE)h
("\);)43 b(Nl\(f\);)289 401 y(EnumerateMethod)o(s\(f,)18
b(methods\);)289 449 y(Nl\(f,)i(freshLine)g(:=)i(FALSE\);)245
496 y(END)201 544 y(END)g(Header;)158 619 y(PROCEDURE)e
(EnumerateMethods)e(\(f)130 b(:)22 b(Formatter.T;)768
667 y(methods:)e(ImportList.MethodL)o(ist\))e(=)201 715
y(BEGIN)245 762 y(WITH)j(Put)86 b(=)22 b(Formatter.PutText)o(,)354
810 y(Nl)108 b(=)22 b(Formatter.NewLine)o(,)354 858 y(Tab)86
b(=)22 b(Formatter.Begin,)354 906 y(EndTab)e(=)i(Formatter.End)128
b(DO)289 953 y(Put\(f,)20 b(")43 b(Methods)21 b(=)g({"\);)g(Tab\(f\);)
289 1001 y(FOR)g(i)g(:=)h(LAST\(methods^\))d(TO)i(0)g(BY)h(-1)f(DO)332
1049 y(IF)g(i)h(<)g(LAST\(methods^\))d(THEN)h(Put\(f,)h(",)g("\);)h
(END;)332 1096 y(Formatter.Break\()376 1144 y(f,)f(type)g(:=)g
(Formatter.BreakType)o(.NonO)o(ptima)o(l\);)332 1192
y(Put\(f,)g(Atom.ToText\(meth)o(ods[)o(i].na)o(me\)\);)289
1240 y(END;)289 1287 y(Put\(f,)f("};"\);)h(Nl\(f\);)289
1335 y(EndTab\(f\);)245 1383 y(END)201 1433 y(END)h(EnumerateMethod)o
(s;)58 1586 y Fb(3.3.5)51 b(Pr)o(ocedur)o(e)13 b(Revealation)58
1666 y Fn(Generate)f(the)g Fe(REVEAL)e Fn(of)h(the)g(stable)g(subtype.)
17 b(The)12 b(opaque)f(supertype)g(revealed)h(is)f(from)h(the)f
(generic)g(interface)58 1716 y(which)f(has)h(to)e(be)i(instanciated)f
(from)g(outside)f(the)h(stable)g(generator)n(.)120 1767
y(The)i(necessary)g(information)d(passed)j(is:)i Fe(t)d
Fn(the)f(object)h(to)f(be)h(made)h(stable,)f Fe(f)g Fn(the)g(writer)f
(for)g(the)h(code)g(output,)58 1817 y Fe(methods)e Fn(the)h(list)f(of)h
(update)g(methods.)120 1868 y(The)15 b(code)f(produced)f(is)g(a)h
(object)g(type)f(which)g(is)g(a)h(subtype)f(of)h(the)f(generic)h
Fe(Stable.T)p Fn(.)e(Hidden)h(\256elds)h(are)58 1918
y Fe(nm)p Fn(,)e(the)f(name)i(of)e(the)g(stable)h(object,)f
Fe(log)g Fn(the)g(log)g(writer)n(,)h Fe(lm)f Fn(the)g(log)g(manager)h
(object,)g Fe(forceToDisk)d Fn(the)i(sync)58 1967 y(boolean.)j
(Overridden)9 b(methods)h(are)h(those)f(from)g(the)g(generic)h
(interface)g(and)f(those)g(from)g(the)g(user)h(object.)158
2070 y Fe(PROCEDURE)20 b(Revealation)f(\(f)131 b(:)21
b(Formatter.T;)659 2117 y(repName:)f(TEXT;)659 2165 y(methods:)g
(ImportList.MethodL)o(ist\))e(=)201 2213 y(BEGIN)245
2261 y(WITH)j(Put)86 b(=)22 b(Formatter.PutText)o(,)354
2308 y(Nl)108 b(=)22 b(Formatter.NewLine)o(,)354 2356
y(Tab)86 b(=)22 b(Formatter.Begin,)354 2404 y(EndTab)e(=)i
(Formatter.End)128 b(DO)289 2452 y(Put\(f,)20 b("REVEAL)g("\);)i
(Nl\(f\);)289 2499 y(Put\(f,)e(")43 b(T)22 b(=)g("\);)f(Tab\(f\);)f
(Tab\(f,)h(2\);)p eop
%%Page: 33 33
33 32 bop 145 141 a Fi(3.3.)25 b(MODULE)11 b(GENMODULECODE)1052
b Fn(33)376 258 y Fe(Put\(f,)20 b(repName\);)376 305
y(Put\(f,)g(".Public)g(BRANDED)h(OBJECT"\);)376 353 y(Nl\(f\);)376
401 y(Put\(f,)f("OVERRIDES"\);)564 b(Nl\(f\);)376 449
y(Put\(f,)20 b("replayLog:=)g(ReplayLog;"\);)40 b(Nl\(f\);)376
496 y(Nl\(f\);)376 571 y(FOR)21 b(i)g(:=)h(0)f(TO)h(LAST\(methods^\))d
(DO)419 619 y(Nl\(f,)i(freshLine)f(:=)h(FALSE\);)419
667 y(Put\(f,)g(Atom.ToText\(metho)o(ds[i)o(].nam)o(e\))e(&)i(")h(:=)f
("\);)419 715 y(Put\(f,)g(PreLogMeths)e(&)j(Atom.ToText\(metho)o(ds[i])
o(.name)o(\))d(&)j(";"\);)376 762 y(END;)376 810 y(EndTab\(f\);)376
858 y(Nl\(f,)e(freshLine)g(:=)i(FALSE\);)376 906 y(Put\(f,)e("END;"\);)
376 953 y(EndTab\(f\);)376 1001 y(Nl\(f,)g(freshLine)g(:=)i(FALSE\);)
376 1049 y(Nl\(f,)e(freshLine)g(:=)i(FALSE\);)332 1097
y(END;)289 1146 y(END)f(Revealation;)145 1300 y Fb(3.3.6)51
b(Pr)o(ocedur)o(e)13 b(Surr)o(ogates)145 1381 y Fn(Produce)e(methods)f
(that)g(log)f(their)h(parameters)h(and)g(then)f(start)g(the)g(methods)g
(of)g(the)g(\(unstable\))g(supertype.)j(Output)145 1430
y(is)h(written)e(to)h(the)h(Formatter)f Fe(f)p Fn(,)i(the)f(name)h(of)e
(the)h(supertype)f(is)g(taken)h(from)g(the)f Fe(type)g
Fn(\(which)g(is)h(the)f(unstable)145 1480 y(supertype\).)i(The)d(log)d
(writing)g(surrogate)i(methods)f(are)i(produced)e(for)g(all)h(methods)f
(listet)g(in)g Fe(methods)p Fn(.)k Fe(repName)145 1530
y Fn(is)c(the)g(name)i(of)e(the)g(instantiated)f(generic)h(part)g(of)g
(the)g(generated)h(code.)208 1581 y(A)h(main)g Fe(FOR)g
Fn(statement)g(loops)f(over)h(all)g Fe(methods)p Fn(.)19
b(The)13 b(code)f(generation)g(is)g(split)f(amoung)h(the)g(procedures)
145 1631 y Fe(GenTypeCode.ProcHea)o(der\(\))e Fn(\(producing)i
Fe(PROCEDURE)g Fn(header)i(and)g(variables\),)h Fe(SurrBody\(\))d
Fn(\(procuding)145 1681 y(the)e(statements\))h(and)f
Fe(SurrErrors\(\))e Fn(\(producing)h(error)h(handling)e(at)j(the)f
(end\).)245 1783 y Fe(PROCEDURE)20 b(Surrogates)g(\(f)130
b(:)22 b(Formatter.T;)724 1831 y(name)65 b(:)22 b(Type.Qid;)724
1879 y(repName:)f(TEXT;)724 1926 y(methods:)g(ImportList.Meth)o(odLis)o
(t\))289 1974 y(RAISES)f({StablegenError.E})e(=)289 2022
y(BEGIN)332 2070 y(WITH)j(Put)87 b(=)21 b(Formatter.PutText,)441
2117 y(Nl)109 b(=)21 b(Formatter.NewLine,)441 2165 y(Tab)87
b(=)21 b(Formatter.Begin,)441 2213 y(EndTab)g(=)g(Formatter.End)128
b(DO)376 2261 y(FOR)21 b(i)g(:=)h(0)f(TO)h(LAST\(methods^\))d(DO)419
2308 y(WITH)i(pname)g(=)h(PreLogMeths)746 2356 y(&)g(Atom.ToText\(meth)
o(ods[i)o(].nam)o(e\))d(DO)463 2404 y(Nl\(f,)i(freshLine)f(:=)h
(FALSE\);)463 2452 y(Tab\(f,)f(2\);)463 2499 y(GenTypeCode.ProcH)o
(eader)o(\(f,)e(pname,)j(methods[i].sig,)e("_arg"\);)p
eop
%%Page: 34 34
34 33 bop 58 141 a Fn(34)872 b Fi(CHAPTER)11 b(3.)24
b(IMPLEMENT)m(A)-5 b(TION)12 b(MODULES)376 258 y Fe(PutLine\(f,)19
b(")j(=)g("\);)376 330 y(SurrBody\(f,)d(name,)i(repName,)f
(methods[i]\);)376 378 y(SurrErrors\(f\);)376 426 y(Put\(f,)g("END"\);)
h(\(*)g(matches)f(IF)i(self.lm...)d(in)j(SurrBody)e(*\))376
473 y(EndTab\(f\);)f(Nl\(f\);)376 521 y(Put\(f,)h("END)h(")h(&)f(pname)
g(&)h(";"\);)e(\(*)i(matches)e(BEGIN)h(in)g(SurrBody)f(*\))376
569 y(EndTab\(f\);)376 617 y(Nl\(f,)g(freshLine)g(:=)i(FALSE\);)376
664 y(Formatter.Flush\()o(f\);)332 712 y(END;)457 b(\(*WITH*\))289
760 y(END)522 b(\(*FOR*\))245 807 y(END)566 b(\(*WITH*\))201
855 y(END)22 b(Surrogates;)158 928 y(PROCEDURE)e(SurrErrors)f(\(f:)j
(Formatter.T\))d(=)201 975 y(BEGIN)245 1023 y(WITH)i(Nl)108
b(=)22 b(Formatter.NewLine)o(,)354 1071 y(Put)86 b(=)22
b(Formatter.PutText)o(,)354 1119 y(EndTab)e(=)i(Formatter.End)128
b(DO)289 1166 y(PutLine\(f,)19 b("EXCEPT"\);)289 1214
y(PutLine\(f,)g(")44 b(StableError.E\(e)o(rr\))19 b(=>"\);)289
1262 y(PutLine\(f,)g(")87 b(<*NOWARN*>)20 b(StableError.Halt\()o("\);)
289 1310 y(PutLine\(f,)f(")305 b(\\"can)21 b(not)g(flush)g(log)g
(\(\\"&)g(StableError.ToTex)o(t\(err)o(\))e("\);)289
1357 y(PutLine\(f,)g(")305 b(&)22 b(\\"\))f(in)g(dir)g(\\")h(&)f
(self.nm\);"\);)289 1405 y(Put\(f,)f("END"\);)289 1453
y(EndTab\(f\);)289 1500 y(Nl\(f\);)245 1548 y(END)h(\(*WITH*\))201
1598 y(END)h(SurrErrors;)58 1741 y Fb(3.3.7)51 b(Pr)o(ocedur)o(e)13
b(SurrBody)58 1819 y Fn(This)c(procedure)h(generates)g(the)f
(statements)h(of)f(surrogate)g(methods)h(except)f(the)h(error)f
(handling)f Fe(EXCEPT)g Fn(part)h(of)g(it.)58 1869 y(Comments)g(mark)g
(the)f(three)h(parts)f(of)h(this)f(procedure.)13 b Fa(Pr)n(olog:)g
Fn(Output)7 b(the)h(call)h(to)f(eventually)g(reopen)g(the)h(log)f(and)
58 1919 y(the)j(method)g(number)g(recording)g(call.)17
b Fa(Parameter)12 b(saving:)j Fn(Output)10 b(recording)h(calls)g(for)g
(every)g(parameter)i(of)e(the)58 1968 y(method.)19 b
Fa(Super)n(call)12 b Fn(Output)f(the)h(call)g(to)f(the)h(original)f
(update)h(method.)19 b Fa(Epilog:)d Fn(Output)10 b(the)i(commit)h
(recording)58 2018 y(call)d(and)f(the)h(log)e(\257ushing)h(call.)k(The)
e(epilog)d(is)h(protected)g(by)g(a)h Fe(TRY)22 b(FINALLY)8
b Fn(statement)h(in)g(case)i(that)e(the)h(logged)58 2068
y(method)g(raises)h(an)f(exception.)158 2165 y Fe(PROCEDURE)20
b(SurrBody)g(\(f)130 b(:)22 b(Formatter.T;)594 2213 y(name)64
b(:)22 b(Type.Qid;)594 2261 y(repName:)e(TEXT;)594 2308
y(method)g(:)i(ImportList.Metho)o(d\))201 2356 y(RAISES)f
({StablegenError.E)o(})e(=)201 2404 y(BEGIN)245 2452
y(WITH)i(Put)86 b(=)22 b(Formatter.PutText)o(,)354 2499
y(Nl)108 b(=)22 b(Formatter.NewLine)o(,)p eop
%%Page: 35 35
35 34 bop 145 141 a Fi(3.3.)25 b(MODULE)11 b(GENMODULECODE)1052
b Fn(35)441 258 y Fe(Tab)87 b(=)21 b(Formatter.Begin,)441
305 y(EndTab)g(=)g(Formatter.End)128 b(DO)332 353 y(\(*)21
b(Prolog)g(*\))376 401 y(Tab\(f,)f(2\);)376 449 y(PutLine\(f,)f
("BEGIN"\);)376 496 y(Tab\(f,)h(2\);)332 569 y(\(*)h(Just)g(do)h(Super)
f(call)g(if)g(no)g(log)g(manager)g(*\))376 617 y(PutLine\(f,)e("IF)j
(self.lm)e(=)i(NIL)f(THEN"\);)376 690 y(IF)g(method.sig.result)d(#)k
(NIL)f(THEN)g(Put\(f,)g("RETURN)f("\);)h(END;)376 738
y(SuperCall\(f,)e(name,)i(method,)f(SuffArgs,)g(Direction.Log\);)376
786 y(EndTab\(f\);)f(Nl\(f\);)376 833 y(Tab\(f,)h(2\);)376
881 y(PutLine\(f,)f("ELSE"\);)i(\(*)g(IF)g(self.lm...)f(*\))376
954 y(Tab\(f,)g(2\);)376 1002 y(PutLine\(f,)f("TRY"\);)376
1050 y(Put)86 b(\(f,)21 b(repName\);)376 1097 y(PutLine\(f,)e
(".ReOpenLog\(self\);")o(\);)376 1145 y(Put)86 b(\(f,)21
b("StableLog.OutCall\()o(self.)o(log,)d(ORD\(Methods."\);)376
1193 y(PutLine\(f,)h(Atom.ToText\(method.)o(name\))f(&)k("\)\);"\);)332
1266 y(\(*)f(Generate)g(all)g(parameter)f(saving)g(calls)h(*\))376
1314 y(FOR)g(i)g(:=)h(0)f(TO)h(LAST\(method.sig.)o(forma)o(ls^\))c(DO)
419 1361 y(WITH)j(formals)g(=)g(method.sig.formals)o([i])e(DO)463
1409 y(MarshalTypedVal\()506 1457 y(f,)j(Atom.ToText\(forma)o(ls.n)o
(ame\))c(&)k(SuffArgs,)506 1505 y(formals.type,)e(Direction.Log,)e
(calling)j(:=)g(TRUE\);)463 1552 y(Nl\(f\);)419 1600
y(END;)376 1648 y(END;)332 1721 y(\(*)g(Do)h(Super)f(call)g(*\))376
1769 y(Tab\(f,)f(2\);)376 1816 y(PutLine\(f,)f("TRY"\);)376
1864 y(IF)i(method.sig.result)d(#)k(NIL)f(THEN)g(Put\(f,)g("RETURN)f
("\);)h(END;)376 1912 y(SuperCall\(f,)e(name,)i(method,)f(SuffArgs,)g
(Direction.Log\);)376 1960 y(EndTab\(f\);)f(Nl\(f\);)332
2033 y(\(*)i(Epilog)g(*\))376 2080 y(Tab\(f,)f(2\);)376
2128 y(PutLine\(f,)f("FINALLY"\);)376 2176 y(PutLine\(f,)g
("StableLog.OutCallE)o(ndMar)o(k\(sel)o(f.log)o(\);"\);)376
2224 y(Put\(f,)h("IF)h(self.forceToDisk)e(THEN)i(self.flushLog\(\))e
(END"\);)376 2271 y(EndTab\(f\);)g(Nl\(f\);)376 2319
y(Put\(f,)h("END"\);)376 2367 y(EndTab\(f\);)f(Nl\(f\);)332
2415 y(END)i(\(*DO*\))289 2464 y(END)g(SurrBody;)p eop
%%Page: 36 36
36 35 bop 58 141 a Fn(36)872 b Fi(CHAPTER)11 b(3.)24
b(IMPLEMENT)m(A)-5 b(TION)12 b(MODULES)58 258 y Fb(3.3.8)51
b(Pr)o(ocedur)o(e)13 b(Dispatcher)58 342 y Fn(This)8
b(procedure)f(generates)i(the)f(dispatcher)f Fe(ReplayLog)f
Fn(which)h(is)h(called)g(during)e(recovery)m(.)14 b(It)7
b(reads)h(the)g(log)f(\()p Fe(Sta-)58 392 y(bleLog.InCall)p
Fn(\))f(in)j(an)g(endless)h(loop)e(and)h(calls)g(all)g(replay)g
(procedures)g(\()p Fe(Replay_...)p Fn(\))i(accordingly)m(.)i(The)d
(loop)58 442 y(exits)g(only)f(when)h(an)h(exception)f(occurs)g(during)f
(respooling.)k(This)d(happens)g(at)h(the)f(end)g(of)g(the)g(log)g
(reader)n(.)158 554 y Fe(PROCEDURE)20 b(Dispatcher)f(\(f)131
b(:)21 b(Formatter.T;)637 602 y(methods:)f(ImportList.MethodLi)o(st\))
201 650 y(RAISES)h({StablegenError.E)o(})e(=)201 698
y(BEGIN)245 745 y(WITH)i(Put)86 b(=)22 b(Formatter.PutText)o(,)354
793 y(Nl)108 b(=)22 b(Formatter.NewLine)o(,)354 841 y(Tab)86
b(=)22 b(Formatter.Begin,)354 889 y(EndTab)e(=)i(Formatter.End)128
b(DO)289 936 y(Put\(f,)20 b("\\nPROCEDURE)f(ReplayLog\(o:)h(T;)h(log:)g
(Rd.T\))g(="\);)289 984 y(Put\(f,)f("\\n)43 b(BEGIN"\);)289
1032 y(Put\(f,)20 b("\\n)87 b(TRY"\);)289 1080 y(Put\(f,)20
b("\\n)130 b(LOOP"\);)289 1127 y(Tab\(f,)20 b(-1\);)289
1175 y(Put\(f,)332 1223 y("\\n)174 b(CASE)21 b(VAL\(StableLog.")376
1271 y(&)g("InCall\(log,)f(ORD\(LAST\(Method)o(s\)\)\),)e(Methods\))i
(OF"\);)289 1318 y(FOR)h(i)g(:=)h(FIRST\(methods^\))c(TO)k
(LAST\(methods^\))d(DO)332 1366 y(Nl\(f,)i(freshLine)f(:=)h(FALSE\);)
332 1414 y(Put\(f,)g("|)g(Methods.")f(&)i(Atom.ToText\(met)o(hods[)o
(i].na)o(me\))528 1462 y(&)g(")f(=>)h("\);)332 1509 y(Put\(f,)f
(PreReplayMeths)e(&)i(Atom.ToText\(method)o(s[i].)o(name\))528
1557 y(&)h("\(o,)f(log\);"\);)289 1605 y(END;)289 1652
y(EndTab\(f\);)289 1700 y(Put\(f,)f("\\n)174 b(END)21
b(\(*CASE*\)"\);)289 1748 y(Put\(f,)f("\\n)130 b(END)21
b(\(*LOOP*\)"\);)289 1796 y(Put\(f,)f("\\n)87 b(EXCEPT"\);)289
1843 y(Put\(f,)20 b("\\n)108 b(ELSE"\);)289 1891 y(Put\(f,)20
b("\\n)87 b(END;"\);)289 1939 y(Put\(f,)20 b("\\n)43
b(END)21 b(ReplayLog;\\n\\n"\);)245 1987 y(END)201 2036
y(END)h(Dispatcher;)58 2211 y Fb(3.3.9)51 b(Pr)o(ocedur)o(e)13
b(ReplayStubs)58 2296 y Fn(Generate)e(on)f Fe(f)g Fn(for)g(object)g
Fe(name)g Fn(for)f(each)j(method)e(in)f Fe(methods)g
Fn(a)i(replay)f(stub)g(procedure.)120 2350 y(The)f(main)f
Fe(FOR)p Fn(-loop)e(steps)i(through)e Fe(methods)p Fn(.)12
b(The)d(main)f(steps)g(performed)f(for)h(each)h(such)f(method)f(is)h
(marked)58 2400 y(by)i(comments)h(below:)h Fa(Generate)f(pr)n(ocedur)n
(e)h(header)e Fn(generates)h(the)f(header)h(of)f(the)g(stub)f
(\(parameters)i(are)g(always)58 2449 y(the)g(same:)k
Fe(self)10 b Fn(and)h Fe(log)p Fn(\).)k Fa(V)-5 b(ariable)10
b(Deklarations:)j Fn(For)e(each)h(parameter)f(of)g(the)f(update)h
(method)f(one)h(variable)58 2499 y(has)i(to)e(be)i(declared)f(\(with)f
(the)h(same)i(type)d(than)h(the)g(parameter\).)21 b Fa(Read)12
b(in)g(V)-5 b(alues:)17 b Fn(generate)c(calls)f(to)g(read)h(each)p
eop
%%Page: 37 37
37 36 bop 145 141 a Fi(3.3.)25 b(MODULE)11 b(GENMODULECODE)1052
b Fn(37)145 258 y(such)11 b(parameter)g(from)g(the)f(log.)j
Fa(Super)e(call:)i Fn(Now)d(the)g(update)g(method)h(can)g(be)f(called)h
(\(which)f(is)g(not)f(a)i(super)g(call)145 307 y(but)f(looks)f(exactly)
h(like)g(one\).)k(Finally)9 b(the)h Fe(END)g Fn(of)g(the)g(stub)f(is)h
(generated.)245 401 y Fe(PROCEDURE)20 b(ReplayStubs)f(\(f)131
b(:)21 b(Formatter.T;)746 449 y(name)65 b(:)21 b(Type.Qid;)746
496 y(methods:)f(ImportList.MethodLi)o(st\))289 544 y(RAISES)g
({StablegenError.E})e(=)289 592 y(VAR)j(varType:)f(Type.T;)289
640 y(BEGIN)332 687 y(WITH)h(Put)87 b(=)21 b(Formatter.PutText,)441
735 y(Nl)109 b(=)21 b(Formatter.NewLine,)441 783 y(Tab)87
b(=)21 b(Formatter.Begin,)441 831 y(EndTab)g(=)g(Formatter.End)128
b(DO)376 878 y(FOR)21 b(i)g(:=)h(0)f(TO)h(LAST\(methods^\))d(DO)376
926 y(\(*)i(Generate)f(procedure)g(header)h(*\))419 974
y(GenTypeCode.ProcHea)o(der\()463 1021 y(f,)463 1069
y(PreReplayMeths)e(&)i(Atom.ToText\(methods)o([i].n)o(ame\),)463
1117 y(replaySig\);)419 1165 y(Put\(f,)g("=\\n"\);)376
1235 y(\(*)g(Variable)f(Deklarations)g(for)h(parameter)f(of)h(method:)f
(*\))419 1283 y(WITH)h(sig)g(=)h(methods[i].sig)d(DO)463
1331 y(IF)i(NUMBER\(sig.formals^)o(\))e(>)i(0)h(THEN)506
1378 y(Tab\(f,)f(4\);)506 1426 y(Put\(f,)g(")43 b(VAR"\);)506
1474 y(FOR)22 b(j)f(:=)h(0)f(TO)h(LAST\(sig.formal)o(s^\))d(DO)550
1522 y(WITH)i(formals)f(=)i(sig.formals[j])d(DO)594 1569
y(TYPECASE)h(formals.type)f(OF)594 1617 y(|)i(Type.OpenArray)e(\(oa\))i
(=>)681 1665 y(varType)f(:=)i(oa.refArray)594 1713 y(ELSE)637
1760 y(varType)f(:=)g(formals.type;)594 1808 y(END;)594
1856 y(Nl\(f\);)594 1904 y(Put\()637 1951 y(f,)h(Atom.ToText\(for)o
(mals.)o(name\))c(&)k(SuffArgs)746 1999 y(&)g(":)f(")h(&)f
(GenTypeCode.ToText\()o(varTy)o(pe\))746 2047 y(&)h(";"\);)550
2095 y(END;)506 2142 y(END;)506 2190 y(EndTab\(f\);)463
2238 y(END;)376 2308 y(\(*)f(Read)g(in)g(values)g(of)g(parameters:)f
(*\))463 2356 y(Nl\(f\);)463 2404 y(Tab\(f,)g(4\);)463
2452 y(PutLine\(f,)g(")43 b(BEGIN"\);)463 2499 y(FOR)21
b(j)h(:=)f(0)h(TO)f(LAST\(sig.formals^)o(\))e(DO)p eop
%%Page: 38 38
38 37 bop 58 141 a Fn(38)872 b Fi(CHAPTER)11 b(3.)24
b(IMPLEMENT)m(A)-5 b(TION)12 b(MODULES)419 258 y Fe(WITH)21
b(formals)g(=)g(sig.formals[j])e(DO)463 305 y(MarshalTypedVal\()506
353 y(f,)j(Atom.ToText\(form)o(als.n)o(ame\))c(&)k(SuffArgs,)506
401 y(formals.type,)e(Direction.Repla)o(y,)f(calling)h(:=)i(TRUE\);)463
449 y(Nl\(f\))419 496 y(END)376 544 y(END;)376 592 y(PutLine\(f,)d("IF)
j(NOT)f(StableLog.CheckC)o(allEn)o(dMark)o(\(log\))d(THEN"\);)376
640 y(PutLine\(f,)h(")44 b(RAISE)21 b(StableLog.Error)o("\);)376
687 y(PutLine\(f,)e("END;"\);)332 735 y(END;)i(\(*WITH*\))289
808 y(\(*)g(Do)g(Supercall)f(*\))332 856 y(Tab\(f,)h(2\);)332
904 y(PutLine\(f,)f("TRY"\);)332 952 y(IF)h(methods[i].sig.resul)o(t)e
(#)i(NIL)h(THEN)f(Put\(f,)f("EVAL)h("\);)g(END;)332 999
y(SuperCall\(f,)e(name,)i(methods[i],)f(SuffArgs,)g(Direction.Repla)o
(y\);)332 1073 y(EndTab\(f\);)332 1120 y(Nl\(f\);)332
1168 y(PutLine\(f,)g("EXCEPT)g(ELSE"\);)332 1216 y(Put\(f,)h("END"\);)
332 1289 y(\(*)g(End)h(Procedure)e(*\))332 1337 y(EndTab\(f\);)332
1385 y(Nl\(f\);)332 1432 y(Put\(f,)h(")43 b(END)21 b(")h(&)f
(PreReplayMeths)528 1480 y(&)h(Atom.ToText\(meth)o(ods[i)o(].nam)o(e\))
d(&)i(";\\n\\n"\);)289 1553 y(END)g(\(*FOR*\))245 1601
y(END)g(\(*WITH*\))201 1651 y(END)h(ReplayStubs;)58 1797
y Fb(3.3.10)50 b(Pr)o(ocedur)o(e)13 b(Checkpoint)58 1875
y Fn(Generate)c(the)e(call)h(to)f(the)g(checkpointing)f(procedure)i
(which)f(is)h(located)f(in)g(the)h(generic)g(part)f(of)g(the)h
(implementation.)158 1974 y Fe(PROCEDURE)20 b(Checkpoint)f(\(f:)j
(Formatter.T;)d(repName:)h(TEXT\))h(=)201 2022 y(BEGIN)245
2070 y(WITH)g(Put)g(=)h(Formatter.PutTex)o(t,)354 2117
y(Nl)43 b(=)22 b(Formatter.NewLin)o(e)41 b(DO)289 2165
y(PutLine\(f,)19 b("PROCEDURE)h(Checkpoint\(o:)f(T\))i(RAISES)g
({StableError.E})e(="\);)289 2213 y(Nl\(f\);)289 2261
y(PutLine\(f,)g(")44 b(BEGIN"\);)289 2308 y(Nl\(f\);)289
2356 y(Put\(f,)20 b(")87 b("\);)289 2404 y(Put\(f,)20
b(repName\);)289 2452 y(PutLine\(f,)f(".Checkpoint\(o\)"\);)289
2499 y(PutLine\(f,)g(")44 b(END)21 b(Checkpoint;"\);)p
eop
%%Page: 39 39
39 38 bop 145 141 a Fi(3.3.)25 b(MODULE)11 b(GENMODULECODE)1052
b Fn(39)376 258 y Fe(Nl\(f,)20 b(freshLine)g(:=)i(FALSE\);)332
305 y(END)289 355 y(END)f(Checkpoint;)145 504 y Fb(3.3.1)m(1)51
b(Marshalling)12 b(Pr)o(ocedur)o(es)145 583 y Fn(These)h(procedures)e
(generate)h(calls)g(to)e(the)h Fe(StableLog)f Fn(module)h(to)f(write)h
(or)g(read)h(a)g(variable)f(to)f(or)h(from)g(the)g(log.)145
633 y Fe(MarshalTypedVal)d Fn(is)i(the)g(main)g(procedure)g(which)g
(takes)h(the)f(name)h Fe(varName)e Fn(and)i(type)e Fe(t)i
Fn(of)f(a)g(variable.)245 733 y Fe(PROCEDURE)20 b(MarshalTypedVal)f
(\(fmtWr)107 b(:)22 b(Formatter.T;)833 781 y(varName)64
b(:)22 b(TEXT;)833 828 y(t)196 b(:)22 b(Type.T;)833 876
y(d)196 b(:)22 b(Direction;)833 924 y(calling)64 b(:)22
b(BOOLEAN;)833 972 y(indexDepth)347 b(:=)21 b(0\))289
1019 y(RAISES)f({StablegenError.E})e(=)289 1067 y(BEGIN)332
1115 y(WITH)j(Put)87 b(=)21 b(Formatter.PutText,)441
1163 y(Nl)109 b(=)21 b(Formatter.NewLine,)441 1210 y(Tab)87
b(=)21 b(Formatter.Begin,)441 1258 y(EndTab)g(=)g(Formatter.End)128
b(DO)376 1306 y(TYPECASE)20 b(t)h(OF)376 1354 y(|)g(Type.Char)f(=>)i
(StableLogCall\(f)o(mtWr,)c("Char",)j(varName,)f(d\);)376
1401 y(|)h(Type.UserDefined)e(\(ud\))i(=>)463 1449 y(IF)g(t)h(=)f
(Type.boolean)f(THEN)506 1497 y(StableLogCall\(fmtWr,)e("Boolean",)i
(varName,)g(d\);)463 1544 y(ELSE)506 1592 y(Enumeration\(fmtWr,)f
(varName,)h(t,)h(d,)g(0,)h(LAST\(ud.elts^\)\);)463 1640
y(END)376 1688 y(|)f(Type.Subrange)e(\(sub\))i(=>)463
1735 y(IF)g(t)h(=)f(Type.integer)f(THEN)506 1783 y
(StableLogCall\(fmtWr,)e("Integer",)i(varName,)g(d\);)463
1831 y(ELSIF)h(t)g(=)h(Type.cardinal)d(THEN)506 1879
y(StableLogCall\(fmtWr,)f("Cardinal",)i(varName,)g(d\);)463
1926 y(ELSIF)h(d)g(=)h(Direction.Log)d(THEN)152 b(\(*)21
b(no)g(value)g(range)g(check)1291 1974 y(when)g(writing)f(*\))506
2022 y(StableLogCall\(fmtWr,)e("Integer",)i(varName,)g(d\);)463
2070 y(ELSE)506 2117 y(SubRange\()550 2165 y(fmtWr,)h(varName,)f(t,)h
(d,)g(NARROW\(sub.min,)e(Value.Ordinal\).ord)o(,)550
2213 y(NARROW\(sub.max,)g(Value.Ordinal\).o)o(rd\);)463
2261 y(END;)376 2308 y(|)i(Type.Real)f(=>)i(StableLogCall\(f)o(mtWr,)c
("Real",)j(varName,)f(d\);)376 2356 y(|)h(Type.LongReal)e(=>)463
2404 y(StableLogCall\(fmt)o(Wr,)g("Longreal",)g(varName,)h(d\);)376
2452 y(|)h(Type.Extended)e(=>)463 2499 y(StableLogCall\(fmt)o(Wr,)g
("Extended",)g(varName,)h(d\);)p eop
%%Page: 40 40
40 39 bop 58 141 a Fn(40)872 b Fi(CHAPTER)11 b(3.)24
b(IMPLEMENT)m(A)-5 b(TION)12 b(MODULES)289 258 y Fe(|)21
b(Type.Reference)e(\(r\))i(=>)376 305 y(IF)g(Type.MayBeRefAny\(r)o(\))e
(OR)i(NOT)g(Type.NamedType\(r\))e(THEN)419 353 y(StableLogCall\(fmtWr)o
(,)g("Ref",)h(varName,)h(d\);)376 401 y(ELSE)419 449
y(StableLogCall\(fmtWr)o(,)e("Ref",)h(varName,)h(d\);)376
496 y(END;)289 544 y(|)g(Type.Array)f(\(a\))h(=>)376
592 y(IF)g(a.index)f(=)i(NIL)f(THEN)419 640 y(MarshalOpenArray\(fm)o
(tWr,)d(varName,)i(t,)i(d,)f(calling,)f(indexDepth\);)376
687 y(ELSE)419 735 y(Tab\(fmtWr,)g(2\);)419 783 y(PutLine\(fmtWr,)f
("FOR)i(i")g(&)h(Fmt.Int\(indexDepth)o(\))d(&)j(")f(:=)g(FIRST\(")790
831 y(&)g(GenTypeCode.ToText\()o(a.ind)o(ex\))e(&)i("\))g(TO)h(LAST\(")
790 878 y(&)f(GenTypeCode.ToText\()o(a.ind)o(ex\))e(&)i("\))g(DO"\);)
419 926 y(MarshalTypedVal\()463 974 y(fmtWr,)f(varName)h(&)g("[i")g(&)h
(Fmt.Int\(indexDept)o(h\))d(&)i("]",)g(a.element,)463
1021 y(d,)g(calling,)f(indexDepth)g(+)i(1\);)419 1069
y(EndTab\(fmtWr\);)d(Nl\(fmtWr\);)419 1117 y(Put\(fmtWr,)h("END;"\);)
376 1165 y(END;)289 1212 y(|)h(Type.Packed)f(\(p\))h(=>)376
1260 y(MarshalTypedVal\()o(fmtWr)o(,)e(varName,)h(p.base,)g(d,)i
(calling,)e(indexDepth\);)289 1308 y(|)h(Type.Record)f(\(rec\))g(=>)376
1356 y(FOR)h(i)g(:=)h(0)f(TO)h(LAST\(rec.fields^)o(\))d(DO)419
1403 y(MarshalTypedVal\()463 1451 y(fmtWr,)h(varName)h(&)g(".")g(&)h
(Atom.ToText\(rec.fi)o(elds[)o(i].n)o(ame\),)463 1499
y(rec.fields[i].typ)o(e,)d(d,)i(calling,)f(indexDepth\);)419
1547 y(IF)i(i)f(<)h(LAST\(rec.fields^)o(\))d(THEN)i(Nl\(fmtWr\))f(END)
376 1594 y(END;)289 1642 y(|)h(Type.Set)f(\(s\))h(=>)376
1690 y(IF)g(d)h(=)f(Direction.Replay)e(THEN)419 1738
y(PutLine\(fmtWr,)g(varName)h(&)i(":=")f(&)h(GenTypeCode.ToTe)o(xt\(s)o
(\))d(&)j("{};"\);)419 1785 y(Tab\(fmtWr,)e(2\);)419
1833 y(PutLine\(fmtWr,)f("FOR)i(i")g(&)h(Fmt.Int\(indexDepth)o(\))d(&)j
(")f(:=)g(FIRST\(")790 1881 y(&)g(GenTypeCode.ToText\()o(s.ran)o(ge\))e
(&)i("\))g(TO)h(LAST\(")790 1928 y(&)f(GenTypeCode.ToText\()o(s.ran)o
(ge\))e(&)i("\))g(DO"\);)419 1976 y(Tab\(fmtWr,)f(2\);)419
2024 y(PutLine\(fmtWr,)f("IF)i(StableLog.InBoolean)o(\(log\))d
(THEN"\);)419 2072 y(Put\(fmtWr,)i(varName)g(&)i(")f(:=)h(")f(&)h
(varName)e(&)i(")g(+)f(")790 2119 y(&)g(GenTypeCode.ToText\()o(s\))e(&)
i("{i")790 2167 y(&)g(Fmt.Int\(indexDepth\))d(&)k("};"\);)419
2215 y(EndTab\(fmtWr\);)d(Nl\(fmtWr\);)419 2263 y(Put\(fmtWr,)h
("END"\))376 2310 y(ELSE)419 2358 y(Tab\(fmtWr,)g(2\);)419
2406 y(PutLine\(fmtWr,)f("FOR)i(i")g(&)h(Fmt.Int\(indexDepth)o(\))d(&)j
(")f(:=)g(FIRST\(")790 2454 y(&)g(GenTypeCode.ToText\()o(s.ran)o(ge\))e
(&)i("\))g(TO)h(LAST\(")p eop
%%Page: 41 41
41 40 bop 145 141 a Fi(3.3.)25 b(MODULE)11 b(GENMODULECODE)1052
b Fn(41)877 258 y Fe(&)22 b(GenTypeCode.ToT)o(ext\(s)o(.rang)o(e\))d(&)
i("\))h(DO"\);)506 305 y(Put\(fmtWr,)e("StableLog.OutBool)o(ean\(s)o
(elf.l)o(og,)f(i")i(&)h(Fmt.Int\(indexDe)o(pth\))877
353 y(&)g(")f(IN)g(")h(&)g(varName)e(&)i("\);"\);)463
401 y(END;)463 449 y(EndTab\(fmtWr\);)d(Nl\(fmtWr\);)463
496 y(Put\(fmtWr,)h("END;"\);)376 544 y(|)h(Type.Procedure)e(=>)463
592 y(RAISE)i(StablegenError.E)o(\("Ca)o(n't)e(have)i(a)g(procedure)f
(as)i(argument)e(or)h(result)g(")899 640 y(&)g("of)g(a)h(stable)f
(object)f(method."\);)376 687 y(ELSE)419 735 y(StablegenError.Fata)o
(l\("ru)o(ntim)o(e)f(error)i(in)g(GenModuleCode"\);)376
783 y(END)g(\(*TYPECASE*\))332 831 y(END)43 b(\(*WITH*\))289
878 y(END)21 b(MarshalTypedVal;)245 949 y(PROCEDURE)f(SubRange)g
(\(fmtWr)64 b(:)22 b(Formatter.T;)681 997 y(varName)e(:)i(TEXT;)681
1044 y(t)152 b(:)22 b(Type.Subrange;)681 1092 y(d)152
b(:)22 b(Direction;)681 1140 y(min,)f(max:)g(INTEGER)173
b(\))21 b(=)289 1187 y(BEGIN)332 1235 y(WITH)g(Nl)g(=)h
(Formatter.NewLine)c(DO)376 1283 y(IF)j(t.base)g(=)g(Type.integer)f(OR)
h(t.base)f(=)i(t)g(THEN)419 1331 y(\(*)g(To)f(prevent)f(the)i(overflow)
e(in)h(integer)f(literals)h(when)485 1378 y(attempting)e(to)j(write)f
(FIRST\(INTERGER\))d(as)k(a)f(literal)485 1426 y(\(remember)f(that)h
(you)g(will)g(have)g(to)g(write)g(-\(LAST\(INTEGER\)+)o(1\)\))485
1497 y(In)g(order)g(to)g(be)h(able)f(to)g(compile)f(code)h(that)g
(explicitly)f(declares)485 1544 y(32)h(bit)g(integers)f(on)i(both)f
(ALPHAs)f(and)h(MIPs)g(I)h(do)f(not)h(use)485 1592 y(FIRST\(INTEGER\))d
(but)i(the)g(literal)f(value)h(of)g(FIRST\(INTEGER\))e(on)485
1640 y(32)i(bit)g(machines.)f(This)h(will)g(not)g(harm)g(on)h(the)f(64)
g(bit)g(machine)485 1688 y(and)g(will)g(work)g(on)g(the)g(32)h(bit)f
(machine.)f(If)h(someone)g(compiles)485 1735 y(a)g(subrange)f(spanning)
h(over)f(more)h(than)g(32)h(bits)f(on)g(an)h(64)f(bit)485
1783 y(machine,)f(this)h(will)g(not)g(be)g(detected)f(and)i(lead)f(to)g
(an)g(error)485 1831 y(when)g(compiling)f(for)h(a)g(32)h(bit)f
(machine.)419 1879 y(*\))419 1926 y(IF)h(min)f(=)g(-16_7FFFFFFF-1)e
(THEN)463 1974 y(StableLogCall\()550 2022 y(fmtWr,)i("Integer",)e
(varName,)h(d,)550 2070 y(",)h(-16_7FFFFFFF-1,)e(")j(&)f
(Fmt.Int\(max\)\);)419 2117 y(ELSE)463 2165 y(StableLogCall\()550
2213 y(fmtWr,)g("Integer",)e(varName,)h(d,)550 2261 y(",)h(")h(&)g
(Fmt.Int\(min\))d(&)i(",)h(")f(&)h(Fmt.Int\(max\)\);)419
2308 y(END)376 2356 y(ELSE)419 2404 y(TYPECASE)e(t.base)h(OF)419
2452 y(|)h(Type.Enumeration)c(=>)506 2499 y(Enumeration\(fmtWr,)h
(varName,)h(t.base,)g(d,)h(min,)g(max\);)p eop
%%Page: 42 42
42 41 bop 58 141 a Fn(42)872 b Fi(CHAPTER)11 b(3.)24
b(IMPLEMENT)m(A)-5 b(TION)12 b(MODULES)332 258 y Fe(|)22
b(Type.Subrange)d(=>)419 305 y(SubRange\(fmtWr,)g(varName,)h(t.base,)g
(d,)i(min,)f(max\);)332 353 y(ELSE)376 401 y(StablegenError.F)o(atal\()
o("run)o(time)d(error)j(in)h(GenModuleCode"\))o(;)332
449 y(END)f(\(*TYPECASE*\))289 496 y(END)g(\(*IF*\))245
544 y(END)g(\(*WITH*\))201 592 y(END)h(SubRange;)158
662 y(PROCEDURE)e(Enumeration)f(\(fmtWr)64 b(:)22 b(Formatter.T;)659
710 y(varName)e(:)i(TEXT;)659 758 y(t)152 b(:)22 b(Type.Enumeration;)
659 806 y(d)152 b(:)22 b(Direction;)659 853 y(min,)f(max:)g(INTEGER)238
b(\))22 b(=)201 901 y(BEGIN)245 949 y(WITH)f(Put)g(=)h
(Formatter.PutTex)o(t)d(DO)289 997 y(IF)i(d)g(=)h(Direction.Replay)d
(THEN)332 1044 y(Put\(fmtWr,)419 1092 y(varName)i(&)g(")h(:=)f
(VAL\(StableLog.InIn)o(teger)o(\(log,)d(")463 1140 y(&)j
(Fmt.Int\(min\))f(&)h(",")g(&)h(Fmt.Int\(max\))d(&)j("\),)f(")463
1187 y(&)g(GenTypeCode.ToText\()o(t\))e(&)i("\);"\);)289
1235 y(ELSE)332 1283 y(Put\(fmtWr,)f("StableLog.OutIn)o(teger)o(\(self)
o(.log,)e(ORD\(")615 1331 y(&)k(varName)e(&)i("\)\);"\);)289
1378 y(END)f(\(*IF*\))245 1426 y(END)g(\(*WITH*\))201
1474 y(END)h(Enumeration;)158 1544 y(PROCEDURE)e(MarshalOpenArray)e
(\(f)218 b(:)21 b(Formatter.T;)768 1592 y(varName)86
b(:)21 b(TEXT;)768 1640 y(a)218 b(:)21 b(Type.OpenArray;)768
1688 y(d)218 b(:)21 b(Direction;)768 1735 y(calling)86
b(:)21 b(BOOLEAN;)768 1783 y(indexDepth)f(:)h(INTEGER\))201
1831 y(RAISES)g({StablegenError.E)o(})e(=)201 1879 y(VAR)245
1926 y(nDimensions)521 b(:=)21 b(a.openDimensions;)245
1974 y(aName,)f(baseName,)g(boundList:)g(Text.T;)245
2022 y(component)369 b(:)21 b(Type.T;)201 2070 y(BEGIN)245
2117 y(WITH)g(Put)86 b(=)22 b(Formatter.PutText)o(,)354
2165 y(Nl)108 b(=)22 b(Formatter.NewLine)o(,)354 2213
y(Tab)86 b(=)22 b(Formatter.Begin,)354 2261 y(EndTab)e(=)i
(Formatter.End)128 b(DO)289 2308 y(IF)21 b(calling)f(THEN)261
b(\(*)21 b(Must)g(marshal/unmarshal)942 2356 y(array)g(bounds)g(*\))332
2404 y(IF)g(d)h(=)g(Direction.Log)d(THEN)376 2452 y(StableLogCall\()419
2499 y(f,)j("Integer",)d("NUMBER\(")h(&)i(varName)e(&)i("\)",)f(d\);)p
eop
%%Page: 43 43
43 42 bop 145 141 a Fi(3.3.)25 b(MODULE)11 b(GENMODULECODE)1052
b Fn(43)463 258 y Fe(Nl\(f\);)463 305 y(aName)21 b(:=)g(varName)f(&)i
("[0";)463 353 y(FOR)f(i)h(:=)f(2)h(TO)f(nDimensions)e(DO)506
401 y(StableLogCall\()550 449 y(f,)i("Integer",)f("NUMBER\(")g(&)i
(aName)e(&)i("]\)",)f(d\);)506 496 y(Nl\(f\);)506 544
y(aName)g(:=)h(aName)e(&)i(",)f(0";)463 592 y(END;)463
640 y(baseName)f(:=)h(varName;)419 687 y(ELSE)463 735
y(Put\(f,)f("WITH)h(n1)h(=)f(StableLog.InIntege)o(r\(log)o(\)"\);)463
783 y(boundList)f(:=)h("n1";)463 831 y(FOR)g(i)h(:=)f(2)h(TO)f
(nDimensions)e(DO)506 878 y(PutLine\(f,)h(","\);)506
926 y(Put\(f,)h(")87 b(n")21 b(&)h(Fmt.Int\(i\))703 974
y(&)f(")h(=)f(StableLog.InInteger)o(\(log\))o("\);)506
1021 y(boundList)f(:=)i(boundList)e(&)h(",)h(n")f(&)h(Fmt.Int\(i\);)463
1069 y(END;)463 1117 y(PutLine\(f,)e(")h(DO"\);)463 1165
y(PutLine\(f,)f(")43 b(")22 b(&)f(varName)f(&)i(")g(:=)f(NEW\(")746
1212 y(&)h(GenTypeCode.ToTe)o(xt\(a.)o(refAr)o(ray\))746
1260 y(&)g(",)f(")h(&)f(boundList)f(&)i("\);"\);)463
1308 y(PutLine\(f,)e("END;"\);)463 1356 y(baseName)g(:=)h(varName)g(&)g
("^";)419 1403 y(END;)376 1451 y(ELSE)419 1499 y(IF)h(d)f(=)h
(Direction.Log)d(THEN)463 1547 y(baseName)h(:=)h(varName)g(&)g("^";)419
1594 y(ELSE)463 1642 y(baseName)f(:=)h(varName;)419 1690
y(END;)376 1738 y(END;)376 1831 y(\(*)g(Suppress)f(actual)h(data)g(for)
g(<*OUTPUT*>)f(params)g(on)441 1879 y(call)h(*\))376
1926 y(Tab\(f,)f(2\);)376 1974 y(PutLine\(f,)f("FOR)i(n1)h(:=)f(0)h(TO)
f(LAST\(")g(&)g(baseName)f(&)i("\))f(DO"\);)376 2022
y(aName)f(:=)i(varName)e(&)i("[n1";)376 2070 y(component)e(:=)h
(a.element;)376 2117 y(FOR)g(i)g(:=)h(2)f(TO)h(nDimensions)d(DO)419
2165 y(Tab\(f,)i(2\);)419 2213 y(PutLine\(f,)f("FOR)h(n")g(&)h
(Fmt.Int\(i\))e(&)h(")h(:=)f(0)h(TO)f(LAST\(")703 2261
y(&)g(aName)g(&)h("]\))f(DO"\);)419 2308 y(aName)g(:=)g(aName)g(&)h(",)
43 b(n")21 b(&)h(Fmt.Int\(i\);)419 2356 y(component)e(:=)463
2404 y(NARROW\(component,)e(Type.OpenArray\).el)o(ement)o(;)376
2452 y(END;)376 2499 y(MarshalTypedVal\()p eop
%%Page: 44 44
44 43 bop 58 141 a Fn(44)872 b Fi(CHAPTER)11 b(3.)24
b(IMPLEMENT)m(A)-5 b(TION)12 b(MODULES)332 258 y Fe(f,)21
b(aName)g(&)h("]",)f(component,)e(d,)j(calling,)e(indexDepth\);)289
305 y(FOR)h(i)g(:=)h(1)f(TO)h(nDimensions)d(DO)332 353
y(EndTab\(f\);)h(Nl\(f\);)332 401 y(Put\(f,)h("END;"\);)129
b(\(*)21 b(End)g(FOR)g(Loop)g(*\))289 449 y(END;)245
496 y(END)201 546 y(END)h(MarshalOpenArra)o(y;)58 687
y Fb(3.3.12)50 b(De\256ne)13 b(the)e(signatur)o(e)h(of)g(r)o(eplay)g
(stubs)58 765 y Fn(Since)h(all)g(replay)g(stubs)f(have)h(the)g(same)h
(signature,)g(we)f(provide)f(a)h(read)h(only)e(global)f(variable)i
Fe(replaySig)e Fn(that)58 815 y(stores)f(this)g(signature.)158
908 y Fe(VAR)201 956 y(replaySig:)20 b(Type.Signature;)201
1004 y(replayFormals)f(:=)j(NEW\(REF)e(ARRAY)h(OF)g(Type.Formal,)f
(1\);)201 1052 y(replayExcpt)63 b(:=)22 b(NEW\(REF)e(ARRAY)h(OF)g
(Type.Exception,)e(1\);)158 1099 y(BEGIN)201 1147 y(replayFormals[0])g
(:=)245 1195 y(NEW\()289 1243 y(Type.Formal,)g(mode)i(:=)g
(Type.Mode.Value,)289 1290 y(name)f(:=)i(Atom.FromText\("lo)o(g"\),)c
(default)j(:=)g(NIL,)289 1338 y(type)f(:=)i(NEW\(Type.Object,)550
1386 y(name)f(:=)g(NEW\(Type.Qid,)812 1434 y(intf)f(:=)i
(Atom.FromText\("Rd)o("\),)812 1481 y(item)e(:=)i(Atom.FromText\("T")o
(\)\)\)\);)201 1529 y(replayExcpt[0])d(:=)245 1577 y
(NEW\(Type.Exceptio)o(n,)332 1624 y(qid)i(:=)376 1672
y(NEW\(Type.Qid,)e(intf)i(:=)g(Atom.FromText\("Sta)o(bleLo)o(g"\),)463
1720 y(item)g(:=)g(Atom.FromText\("Err)o(or"\)\))o(,)e(arg)i(:=)h
(NIL\);)201 1768 y(replaySig.formals:=)c(replayFormals;)201
1815 y(replaySig.result:=)g(NIL;)201 1863 y(replaySig.raises:=)g
(replayExcpt;)158 1913 y(END)j(GenModuleCode.)58 2075
y Fg(3.4)60 b(Module)14 b(GenT)l(ypeCode)58 2191 y Fn(The)d(module)f
(provides)f(code)i(producing)e(procedures)h(for)g(the)g(stub)g
(generator)n(.)158 2285 y Fe(MODULE)20 b(GenTypeCode;)158
2356 y(IMPORT)g(Atom,)h(Fmt,)g(Wr,)g(Formatter,)f(Text,)h(Type,)310
2403 y(Value,)g(ValueProc;)158 2476 y(<*FATAL)f(Wr.Failure*>)p
eop
%%Page: 45 45
45 44 bop 145 141 a Fi(3.4.)25 b(MODULE)11 b(GENTYPECODE)1126
b Fn(45)145 258 y Fb(3.4.1)51 b(Pr)o(oduce)12 b(type)g(speci\256cation)
f(text)145 339 y Fn(The)g(procedures)f Fe(ToText\(\))p
Fn(,)e Fe(FieldsToText\(\))f Fn(and)j Fe(MethodsToText\(\))c
Fn(recursivly)j(scan)i Fe(Type.T)d Fn(structures)145
389 y(to)i(produce)g(equivalent)f Fe(TEXT)h Fn(that)g(contains)f(the)h
(type)g(speci\256cation)g(in)g(Modula-3)f(code.)245 494
y Fe(PROCEDURE)20 b(ToText)g(\(t:)i(Type.T;)e(byName:)g(BOOLEAN)h(:=)g
(TRUE\):)g(Text.T)f(=)289 542 y(VAR)h(text:)f(Text.T;)289
590 y(BEGIN)332 637 y(IF)h(t)h(=)g(NIL)f(THEN)g(RETURN)f("")i(END;)332
685 y(IF)f(t.name)g(#)h(NIL)f(AND)g(byName)g(THEN)f(RETURN)h
(QidToText\(t.name\);)d(END;)332 733 y(TYPECASE)i(t)i(OF)332
781 y(|)g(Type.Char)e(=>)h(RETURN)g("CHAR")332 828 y(|)h
(Type.UserDefined)c(\(ud\))j(=>)419 876 y(IF)h(NUMBER\(ud.elts^\))c(=)k
(0)f(THEN)463 924 y(text)g(:=)g("";)419 972 y(ELSE)463
1019 y(text)g(:=)g(Atom.ToText\(ud.elt)o(s[0]\))o(;)463
1067 y(FOR)g(i)h(:=)f(1)h(TO)f(LAST\(ud.elts^\))e(DO)506
1115 y(text)i(:=)h(text)f(&)g(",)h(")f(&)h(Atom.ToText\(ud.el)o(ts[i])o
(\);)463 1163 y(END;)419 1210 y(END;)419 1258 y(RETURN)f("{")g(&)h
(text)f(&)g("}";)332 1306 y(|)h(Type.Enumeration)c(\(enum\))j(=>)419
1354 y(IF)h(enum)f(=)g(Type.boolean)f(THEN)g(RETURN)h("BOOLEAN";)f
(END;)419 1401 y(<*ASSERT)g(FALSE*>)332 1449 y(|)i(Type.Subrange)d
(\(sub\))i(=>)419 1497 y(VAR)463 1544 y(min,)g(max:)g(INTEGER;)463
1592 y(ud)130 b(:)22 b(Type.UserDefined)o(;)419 1640
y(BEGIN)463 1688 y(IF)f(sub)g(=)h(Type.integer)d(THEN)i(RETURN)g
("INTEGER")f(END;)463 1735 y(min)h(:=)g(NARROW\(sub.min,)e
(Value.Ordinal\).ord)o(;)463 1783 y(max)i(:=)g(NARROW\(sub.max,)e
(Value.Ordinal\).ord)o(;)463 1831 y(IF)i(sub.base)f(=)i(Type.integer)d
(OR)j(sub.base)e(=)h(Type.cardinal)e(THEN)506 1879 y(RETURN)i("[")g(&)h
(Fmt.Int\(min\))d(&)j("..")f(&)g(Fmt.Int\(max\))f(&)h("]")463
1926 y(END;)463 1974 y(IF)g(sub.base)f(=)i(Type.char)e(THEN)506
2022 y(RETURN)h("[VAL\(")f(&)i(Fmt.Int\(min\))d(&)j(",)f(CHAR\))g(..)g
(VAL\(")703 2070 y(&)g(Fmt.Int\(max\))e(&)j(",)f(CHAR\)]")463
2117 y(END;)463 2165 y(ud)g(:=)h(NARROW\(sub.base,)c
(Type.UserDefined\);)463 2213 y(RETURN)506 2261 y("[")k(&)f
(ToText\(sub.base\))e(&)i(".")g(&)h(Atom.ToText\(ud.elt)o(s[mi)o(n]\))d
(&)i("..")550 2308 y(&)h(ToText\(sub.base\))c(&)k(".")f(&)g
(Atom.ToText\(ud.elts[)o(max])o(\))e(&)j("]";)419 2356
y(END;)332 2404 y(|)g(Type.Real)e(=>)h(RETURN)g("REAL";)332
2452 y(|)h(Type.LongReal)d(=>)i(RETURN)g("LONGREAL";)332
2499 y(|)h(Type.Extended)d(=>)i(RETURN)g("EXTENDED";)p
eop
%%Page: 46 46
46 45 bop 58 141 a Fn(46)872 b Fi(CHAPTER)11 b(3.)24
b(IMPLEMENT)m(A)-5 b(TION)12 b(MODULES)245 258 y Fe(|)22
b(Type.Reference)c(\(ref\))j(=>)332 305 y(TYPECASE)f(ref)h(OF)332
353 y(|)h(Type.Opaque)d(\(o\))i(=>)419 401 y(\(*)h(Type)f(can)g(only)g
(be)g(displayed)f(by)h(name)g(*\))419 449 y(RETURN)g("***Error***)e
(Opaque)i(type)g(only)g(printed)f(by)h(name:)g(")615
496 y(&)h("supertype)e(")h(&)h(ToText\(o.revealed)o(Super)o(Type)o(\);)
376 544 y(\(*)f(RETURN)g(Atom.ToText\(t.n)o(ame.i)o(ntf\))d(&)k(".")f
(&)441 592 y(Atom.ToText\(t.name)o(.ite)o(m\)*\))332
640 y(|)h(Type.Object,)d(Type.Ref)h(=>)419 687 y(IF)i(ref.brand)e(#)h
(NIL)g(THEN)463 735 y(text)g(:=)g("BRANDED)f(\\"")h(&)h
(Atom.ToText\(ref.br)o(and\))c(&)k("\\")f(";)419 783
y(ELSE)463 831 y(text)g(:=)g("")419 878 y(END;)419 926
y(TYPECASE)f(ref)i(OF)419 974 y(|)g(Type.Object)d(\(o\))j(=>)506
1021 y(RETURN)f(ToText\(o.super\))e(&)i(")h(")f(&)h(text)f(&)h
("OBJECT\\n")703 1069 y(&)f(FieldsToText\(o.fie)o(lds\))d(&)k
("\\nMETHODS\\n")703 1117 y(&)f(MethodsToText\(o.me)o(thods)o(\))e(&)j
("\\nEND";)419 1165 y(|)g(Type.Ref)e(\(r\))h(=>)506 1212
y(IF)h(NOT)f(r.traced)f(THEN)h(text)g(:=)g("UNTRACED)f(")i(&)g(text)e
(END;)506 1260 y(RETURN)h(text)g(&)h("REF)e(")i(&)g(ToText\(r.target,)c
(TRUE\);)419 1308 y(ELSE)463 1356 y(<*ASSERT)i(FALSE*>)419
1403 y(END;)332 1451 y(ELSE)376 1499 y(<*ASSERT)g(FALSE*>)332
1547 y(END;)245 1594 y(|)i(Type.Array)d(\(arr\))i(=>)332
1642 y(IF)g(arr.index)f(=)i(NIL)f(THEN)376 1690 y(text)g(:=)g("";)332
1738 y(ELSE)376 1785 y(text)g(:=)g(ToText\(arr.index\))o(;)332
1833 y(END;)332 1881 y(RETURN)g("ARRAY)f(")i(&)f(text)g(&)h(")f(OF)h(")
f(&)h(ToText\(arr.element)o(\);)245 1928 y(|)g(Type.Packed)d(\(p\))i
(=>)332 1976 y(RETURN)g("BITS)f(")i(&)g(Fmt.Int\(p.size\))c(&)k("FORF)f
(")g(&)h(ToText\(p.base\);)245 2024 y(|)g(Type.Record)d(\(rec\))i(=>)
332 2072 y(RETURN)g("RECORD)f(")i(&)f(FieldsToText\(rec.f)o(ields)o(\))
e(&)j(")f(END";)245 2119 y(|)h(Type.Set)e(\(set\))g(=>)i(RETURN)e("SET)
h(OF)h(")f(&)h(ToText\(set.range\))o(;)245 2167 y(|)g(Type.Procedure)c
(=>)k(RETURN)e("PROCEDURE")g(\(*)h(&)h(SigToText\(proc.s)o(ig\);*)o(\))
245 2215 y(ELSE)289 2263 y(<*ASSERT)e(FALSE*>)245 2310
y(END;)201 2358 y(END)i(ToText;)158 2452 y(PROCEDURE)e(FieldsToText)f
(\(f:)i(REF)g(ARRAY)g(OF)g(Type.Field\):)f(TEXT)h(=)201
2499 y(VAR)p eop
%%Page: 47 47
47 46 bop 145 141 a Fi(3.4.)25 b(MODULE)11 b(GENTYPECODE)1126
b Fn(47)332 258 y Fe(notFirst)20 b(:=)i(FALSE;)332 305
y(text)108 b(:=)22 b("";)289 353 y(BEGIN)332 401 y(FOR)f(i)h(:=)f(0)h
(TO)f(LAST\(f^\))f(DO)376 449 y(IF)h(notFirst)f(THEN)h(text)g(:=)h
(text)e(&)i(";)f(";)h(END;)376 496 y(notFirst)e(:=)h(TRUE;)376
544 y(text)g(:=)g(text)g(&)h(Atom.ToText\(f[i)o(].nam)o(e\))d(&)i(":)h
(")f(&)h(ToText\(f[i].type\))o(;)376 592 y(IF)f(f[i].default)e(#)j(NIL)
f(THEN)419 640 y(text)g(:=)h(text)f(&)g(":=)g(")h(&)g(ValueProc.ToTex)o
(t\(f[i)o(].def)o(ault,)c(f[i].type\);)376 687 y(END;)332
735 y(END;)332 783 y(RETURN)j(text;)289 831 y(END)g(FieldsToText;)245
906 y(PROCEDURE)f(MethodsToText)f(\(m:)i(REF)g(ARRAY)g(OF)g
(Type.Method\):)f(TEXT)h(=)289 954 y(VAR)332 1002 y(notFirst)f(:=)i
(FALSE;)332 1049 y(text)108 b(:=)22 b("";)289 1097 y(BEGIN)332
1145 y(FOR)f(i)h(:=)f(0)h(TO)f(LAST\(m^\))f(DO)376 1193
y(IF)h(notFirst)f(THEN)h(text)g(:=)h(text)e(&)i(";\\n";)f(END;)376
1240 y(notFirst)f(:=)h(TRUE;)376 1288 y(text)g(:=)g(text)g(&)h
(Atom.ToText\(m[i)o(].nam)o(e\))d(\(*&)i(SigToText\(m[i].si)o(g\);*\))o
(;)376 1336 y(IF)g(m[i].default)e(#)j(NIL)f(THEN)419
1383 y(text)g(:=)h(text)f(&)g(":=)g(";)419 1431 y(\(*)h(TYPECASE)e
(m[i].default)f(OF)i(MethodDefault1)e(\(md1\))i(=>)h(text)e(:=)i(text)f
(&)485 1479 y(QidToText\(md1.qi)o(d\);)e(|)i(MethodDefault2)e(\(md2\))i
(=>)g(text)g(:=)g(text)g(&)485 1527 y(ToText\(md2.obTyp)o(e\))e(&)i
(".")g(&)h(Atom.ToText\(md2.me)o(thod\))o(;)d(END;)i(*\))376
1574 y(END;)332 1622 y(END;)332 1670 y(RETURN)g(text;)289
1720 y(END)g(MethodsToText;)145 1876 y Fb(3.4.2)51 b(Pr)o(ocedur)o(e)13
b(Pr)o(ocHeader)145 1956 y Fn(Produce)g(a)f(procedure)h(header)g
(suitable)e(for)h(method)g(procedures.)20 b(The)13 b(\256rst)f
(parameter)h(is)f(always)h(set)f(to)g Fe(self:)145 2006
y(T)p Fn(.)f(The)208 2057 y(Put)d(output)g(to)h Fe(f)p
Fn(,)g(name)i(procedure)e Fe(procName)p Fn(,)f(use)i
Fe(sig)f Fn(for)g(parameter)n(,)i(result)e(type)g(and)g(raises)h
(declarations.)145 2107 y(Use)h Fe(argPragmas)e Fn(for)g(pragmas)i
(connected)g(to)f(ar)o(guments)g(of)g(the)g(procedure.)k
Fe(Formals\(\))9 b Fn(is)h(called)g(to)g(produce)145
2157 y(deklarations)g(for)f(each)j(formal)e(parameter)h(in)f
Fe(sig)p Fn(.)245 2261 y Fe(PROCEDURE)20 b(ProcHeader)g(\(f)195
b(:)22 b(Formatter.T;)724 2308 y(procName)42 b(:)22 b(TEXT;)724
2356 y(sig)152 b(:)22 b(Type.Signature;)724 2404 y(suffix)522
b(:=)22 b("";)724 2452 y(argPragmas:)e(REF)h(ARRAY)g(OF)g(TEXT)g(:=)h
(NIL)f(\))g(=)289 2499 y(BEGIN)p eop
%%Page: 48 48
48 47 bop 58 141 a Fn(48)872 b Fi(CHAPTER)11 b(3.)24
b(IMPLEMENT)m(A)-5 b(TION)12 b(MODULES)245 258 y Fe(Formatter.Begin\(f)
o(,)19 b(4\);)245 305 y(Formatter.Begin\(f)o(,)g(4\);)245
353 y(Formatter.PutText)o(\(f,)g("PROCEDURE)g(")j(&)f(procName)g(&)g
("\("\);)245 401 y(Formatter.UnitedB)o(reak\()o(f\);)245
449 y(Formatter.PutText)o(\(f,)e("self:)h(T"\);)245 496
y(Formals\(f,)g(sig.formals,)f(argPragmas,)g(suffix\);)245
544 y(Formatter.PutText)o(\(f,)g("\)"\);)245 592 y(Formatter.End\(f\);)
245 640 y(IF)i(sig.result)f(#)i(NIL)f(THEN)289 687 y(Formatter.Break)o
(\(f\);)289 735 y(Formatter.PutTe)o(xt\(f,)d(":)k(")f(&)h
(ToText\(sig.resul)o(t\)\))245 783 y(END;)245 831 y(IF)f(sig.raises)f
(=)i(NIL)f(THEN)289 878 y(Formatter.Break)o(\(f\);)289
926 y(Formatter.PutTe)o(xt\(f,)d(")k(RAISES)e(ANY"\))245
974 y(ELSE)289 1021 y(Formatter.Break)o(\(f\);)289 1069
y(Formatter.PutTe)o(xt\(f,)e(")k(RAISES)e({"\);)289 1117
y(IF)h(NUMBER\(sig.raises)o(^\))e(>)i(0)h(THEN)332 1165
y(Formatter.PutText\()o(f,)d(QidToText\(sig.ra)o(ises[)o(0].qi)o
(d\)\);)332 1212 y(FOR)i(i)h(:=)f(1)h(TO)f(LAST\(sig.raises^\))d(DO)376
1260 y(Formatter.PutTex)o(t\(f,)g(",)k("\);)376 1308
y(Formatter.Break\()o(f\);)376 1356 y(Formatter.PutTex)o(t\(f,)c
(QidToText\(sig.raise)o(s[i].)o(qid\)\))332 1403 y(END)j(\(*FOR*\))289
1451 y(END;)f(\(*IF*\))289 1499 y(Formatter.PutTe)o(xt\(f,)e("}"\))245
1547 y(END;)j(\(*IF*\))245 1594 y(Formatter.End\(f\);)201
1642 y(END)h(ProcHeader;)158 1735 y(PROCEDURE)e(Formals)g(\(fmtr)130
b(:)21 b(Formatter.T;)572 1783 y(f)196 b(:)21 b(REF)g(ARRAY)g(OF)h
(Type.Formal;)572 1831 y(argPragmas:)d(REF)i(ARRAY)g(OF)h(TEXT;)572
1879 y(suffix)718 b(:=)21 b(""\))g(=)201 1926 y(VAR)245
1974 y(notFirst)f(:=)h(FALSE;)245 2022 y(modeName)f(:=)h(ARRAY)g
(Type.Mode)f(OF)h(TEXT{"",)g("VAR)g(",)g("READONLY)f("};)201
2070 y(BEGIN)245 2117 y(FOR)h(i)h(:=)f(0)h(TO)f(LAST\(f^\))f(DO)289
2165 y(Formatter.PutTe)o(xt\(fm)o(tr,)f(";)i("\);)289
2213 y(Formatter.Unite)o(dBrea)o(k\(fmt)o(r\);)289 2261
y(notFirst)f(:=)h(TRUE;)289 2308 y(IF)g(argPragmas)f(#)h(NIL)g(THEN)g
(Formatter.PutText\(f)o(mtr,)d(argPragmas[i]\);)h(END;)289
2356 y(Formatter.PutTe)o(xt\(fm)o(tr,)g(modeName[f[i].m)o(ode])f(&)k
(Atom.ToText\(f[i].)o(name\))855 2404 y(&)g(suffix)e(&)i(":)f(")h(&)f
(ToText\(f[i].type\)\);)289 2452 y(\(*)g(IF)g(f[i].default)f(#)h(NIL)g
(THEN)g(text)g(:=)h(text)f(&)g(":=)g(")h(&)354 2499 y
(ValueProc.ToText\()o(f[i].)o(defa)o(ult,)c(f[i].type\);)i(END;)h(*\))p
eop
%%Page: 49 49
49 48 bop 145 141 a Fi(3.5.)25 b(MODULE)11 b(TYPENAMES)1179
b Fn(49)332 258 y Fe(END;)289 307 y(END)21 b(Formals;)145
450 y Fb(3.4.3)51 b(Pr)o(ocedur)o(e)13 b(QidT)-5 b(oT)g(ext)145
528 y Fn(Utility)8 b(procedure)i(used)h(to)f(convert)f(a)i
Fe(Type.Qid)e Fn(to)h(a)g Fe(TEXT)p Fn(.)245 625 y Fe(PROCEDURE)20
b(QidToText)g(\(qid:)h(Type.Qid\):)e(TEXT)i(=)289 672
y(BEGIN)332 720 y(IF)g(qid.intf)g(=)g(Atom.FromText\(""\))d(THEN)376
768 y(RETURN)i(Atom.ToText\(qid.ite)o(m\))332 816 y(ELSE)376
863 y(RETURN)g(Atom.ToText\(qid.int)o(f\))f(&)i(".")g(&)h
(Atom.ToText\(qid.it)o(em\))332 911 y(END;)289 959 y(END)f(QidToText;)
245 1031 y(BEGIN)245 1081 y(END)g(GenTypeCode.)145 1245
y Fg(3.5)60 b(Module)15 b(T)l(ypeNames)145 1362 y Fn(W)m(alk)c(through)
d(a)j Fe(M3Context.T)e Fn(and)h(add)h(a)g(property)e(to)h(each)i(node)f
(that)e(represents)i(a)g(type)g(speci\256cation)f(that)g(is)145
1412 y(not)g(a)h(named)g(type.)i(The)e(property)e(added)i(is)f(the)g
(name)h(of)f(the)g(type)g(speci\256ed)h(\(precicly)f(one)g(name)i(of)d
(the)i(type\).)208 1462 y(This)6 b(name)i(is)f(later)f(used)h(by)g(the)
g(generated)g(code.)13 b(The)8 b(procedure)f Fe(Preprocess)e
Fn(starts)h(a)h Fe(M3Context.Apply\(\))145 1511 y Fn(which)k(calls)h
Fe(VisitUnit\(\))d Fn(for)i(each)i(compilation)d(unit)g(of)h(the)g
(context.)17 b Fe(VisitUnit\(\))9 b Fn(then)i(start)g(a)h
Fe(ASTWalk)145 1561 y Fn(which)e(calls)h Fe(VisitNode\(\))d
Fn(for)h(each)j(node)e(of)g(the)g(AST)h(of)f(that)f(unit.)208
1611 y Fe(VisitNode\(\))f Fn(looks)i(for)g(nodes)g(that)g(are)i
(typespeci\256cations)e(and)g(adds)h(the)g(name)g(of)f(the)h(type)f(to)
g(the)g(node')n(s)145 1661 y(property)f(list.)k(This)d(is)h(later)f
(used)g(in)g Fe(AstToType)e Fn(\(see)k Fe(AstToType.AddTo)o(Table)o
(\(\))p Fn(\).)245 1758 y Fe(MODULE)20 b(TypeNames;)245
1830 y(IMPORT)g(AST,)h(M3AST_AS,)f(M3AST_AS_F,)g(M3AST_TL_F,)f
(ASTWalk,)397 1877 y(M3Context,)h(M3CUnit,)g(PropertyV;)245
1950 y(TYPE)289 1997 y(ContextClosure)e(=)k(M3Context.Closure)c(OBJECT)
659 2045 y(OVERRIDES)703 2093 y(callback)i(:=)h(VisitUnit;)659
2141 y(END;)245 2213 y(PROCEDURE)f(Preprocess)g(\(c:)h(M3Context.T\))e
(=)289 2261 y(<*)i(FATAL)g(ANY)g(*>)289 2308 y(BEGIN)332
2356 y(M3Context.Apply\()376 2404 y(c,)g(NEW\(ContextClosure)o(\),)376
2452 y(findStandard)e(:=)i(FALSE\);)108 b(\(*)21 b(ignore)g('standard')
f(unit)h(*\))289 2499 y(END)g(Preprocess;)p eop
%%Page: 50 50
50 49 bop 58 141 a Fn(50)872 b Fi(CHAPTER)11 b(3.)24
b(IMPLEMENT)m(A)-5 b(TION)12 b(MODULES)158 258 y Fe(PROCEDURE)20
b(VisitUnit)g(\(<*UNUSED*>)f(cl)43 b(:)22 b(ContextClosure;)855
305 y(ut)43 b(:)22 b(M3CUnit.Type;)615 353 y(<*UNUSED*>)e(name:)h
(TEXT;)615 401 y(cu:)h(M3AST_AS.Compil)o(ation)o(_Unit)o(\))201
449 y(RAISES)f({})g(=)201 496 y(<*)h(FATAL)e(ANY)i(*>)201
544 y(BEGIN)245 592 y(\(*)f(if)h(it)f(is)g(a)h(generic)e
(instantiation,)f(get)i(to)h(actual)310 640 y(instantiated)e(tree)h
(*\))245 687 y(cu)g(:=)h(M3CUnit.ToGenIns)o(\(cu,)c(ut\);)245
735 y(ASTWalk.VisitNode)o(s\()289 783 y(cu,)j(NEW\(ASTWalk.Clos)o(ure,)
d(callback)i(:=)i(Node\)\);)201 831 y(END)g(VisitUnit;)158
905 y(PROCEDURE)e(Node)h(\(<*UNUSED*>)e(cl:)i(ASTWalk.Closure;)746
953 y(n)h(:)f(AST.NODE;)746 1000 y(vm:)g(ASTWalk.VisitMode\))d(=)201
1048 y(BEGIN)245 1096 y(IF)j(vm)h(=)f(ASTWalk.VisitMode.E)o(ntry)d
(THEN)289 1144 y(TYPECASE)i(n)h(OF)289 1191 y(|)g(M3AST_AS.TYPE_DECL)d
(\(type_decl\))i(=>)376 1239 y(TYPECASE)g(type_decl.as_typ)o(e)f(OF)376
1287 y(|)i(M3AST_AS.TYPE_SPEC)d(\(ts\))j(=>)463 1334
y(PropertyV.Put\()506 1382 y(ts.tl_pset,)f(type_decl.as_id.l)o(x_sym)o
(rep\);)376 1430 y(ELSE)376 1478 y(END;)289 1525 y(ELSE)289
1573 y(END;)245 1621 y(END;)201 1669 y(END)i(Node;)158
1743 y(BEGIN)158 1793 y(END)f(TypeNames.)58 1965 y Fg(3.6)60
b(Module)14 b(AstT)-5 b(oT)l(ype)58 2085 y Fn(Module)9
b(contains)g(procedures)h(for)f(converting)g(AST)h(types)f(into)g
Fe(Type.T)p Fn(')n(s.)j(The)e(main)g(procedure)g(is)f
Fe(Convert\(\))158 2186 y(MODULE)20 b(AstToType;)158
2261 y(IMPORT)g(Atom,)h(PropertyV,)f(RefRefTbl,)f(FRefRefTbl;)158
2308 y(IMPORT)h(M3CId,)h(Type,)g(Value;)158 2356 y(IMPORT)f(M3AST_AS,)g
(M3AST_AS_F,)g(M3AST_SM,)g(M3AST_SM_F,)310 2404 y(M3AST_TM_F,)g
(M3ASTNext,)g(M3AST_TL_F,)f(M3AST_LX,)310 2452 y(M3CConcTypeSpec,)g
(M3CStdTypes;)158 2499 y(IMPORT)h(SeqM3AST_AS_Enum_id)o(,)f
(SeqM3AST_AS_Field)o(s,)p eop
%%Page: 51 51
51 50 bop 145 141 a Fi(3.6.)25 b(MODULE)11 b(ASTT)o(OTYPE)1192
b Fn(51)397 258 y Fe(SeqM3AST_AS_Field_id)o(,)19 b(SeqM3AST_AS_Metho)o
(d,)397 305 y(SeqM3AST_AS_Qual_use)o(d_id,)f(M3CTypesMisc;)245
355 y(IMPORT)i(M3CBackEnd,)g(M3CBackEnd_C;)145 497 y
Fb(3.6.1)51 b(Pr)o(ocedur)o(e)13 b(Convert)145 574 y
Fn(Allocate)c(the)g(cache-table)h(with)e(already)h(parsed)g(types)g
(speci\256cations,)h(initialize)d(it)h(and)h(call)g Fe
(ProcessM3Type\(\))p Fn(.)245 669 y Fe(PROCEDURE)20 b(Convert\(m3type:)
f(M3AST_AS.M3TYPE)o(\):)g(Type.T)h(=)289 717 y(VAR)332
765 y(astMap:=)g(NEW\(FRefRefTbl.Defa)o(ult\))o(.init)o(\(\);)289
812 y(BEGIN)332 860 y(InitAstTable\(astMa)o(p\);)332
908 y(RETURN)h(ProcessM3Type\(as)o(tMap,)d(m3type\);)289
956 y(END)j(Convert;)245 1027 y(PROCEDURE)f(InitAstTable)f(\(astTable:)
h(RefRefTbl.T\))f(=)289 1075 y(BEGIN)332 1122 y(EVAL)i
(astTable.put\(M3CSt)o(dType)o(s.In)o(teger)o(\(\),)e(Type.integer\);)
332 1170 y(EVAL)i(astTable.put\(M3CSt)o(dType)o(s.Re)o(al\(\),)d
(Type.real\);)332 1218 y(EVAL)j(astTable.put\(M3CSt)o(dType)o(s.Lo)o
(ngRea)o(l\(\),)d(Type.longreal\);)332 1266 y(EVAL)j
(astTable.put\(M3CSt)o(dType)o(s.Ex)o(tende)o(d\(\),)d
(Type.extended\);)332 1313 y(EVAL)j(astTable.put\(M3CSt)o(dType)o(s.Nu)
o(ll\(\),)d(Type.null\);)332 1361 y(EVAL)j(astTable.put\(M3CSt)o(dType)
o(s.Re)o(fAny\()o(\),)e(Type.refany\);)332 1409 y(EVAL)i
(astTable.put\(M3CSt)o(dType)o(s.Ad)o(dress)o(\(\),)e(Type.address\);)
332 1457 y(EVAL)i(astTable.put\(M3CSt)o(dType)o(s.Ro)o(ot\(\),)d
(Type.root\);)332 1504 y(EVAL)j(astTable.put\(M3CSt)o(dType)o(s.Un)o
(trace)o(d_Roo)o(t\(\),)d(Type.untracedRoot\);)332 1552
y(EVAL)j(astTable.put\(M3CSt)o(dType)o(s.Ch)o(ar\(\),)d(Type.char\);)
332 1600 y(EVAL)j(astTable.put\(M3CSt)o(dType)o(s.Te)o(xt\(\),)d
(Type.text\);)332 1648 y(EVAL)j(astTable.put\(M3CSt)o(dType)o(s.Ca)o
(rdina)o(l\(\),)d(Type.cardinal\);)332 1695 y(EVAL)j
(astTable.put\(M3CSt)o(dType)o(s.Bo)o(olean)o(\(\),)e(Type.boolean\);)
332 1743 y(EVAL)i(astTable.put\(M3CSt)o(dType)o(s.Mu)o(tex\(\))o(,)e
(Type.mutex\);)289 1793 y(END)i(InitAstTable;)145 1934
y Fb(3.6.2)51 b(Conversion)12 b(fr)o(om)g(M3AST)h(type)e(to)h(T)l
(ype.T)145 2012 y Fn(The)g(procedures)g Fe(ProcessM3Type\(\))d
Fn(and)i Fe(ProcessTypeSpec\(\))d Fn(recursivly)j(descend)h(a)g(M3AST)l
(-type)g(speci-)145 2062 y(\256cation)f(node)h(and)f(generate)i(a)f
Fe(Type.T)e Fn(out)h(of)g(it.)17 b(The)12 b(procedures)g
Fe(ProcessObject\(\))p Fn(,)d Fe(ProcessFields\(\))p
Fn(,)145 2112 y Fe(ProcessExp\(\))e Fn(and)i Fe(ProcessMethods\()o(\))d
Fn(are)k(auxilary)e(procedures)h(for)f(that)g(purpose.)13
b(All)8 b(of)h(these)g(have)g(a)h(pa-)145 2162 y(rameter)h
Fe(astTable)c Fn(which)i(is)h(used)f(to)g(save)h(all)f(already)h
(parsed)g(types.)j Fe(AddToTable\(\))7 b Fn(is)i(called)h(to)f(add)g
(another)145 2211 y(entry)g(to)h(that)f(table.)14 b(This)9
b(procedure)h(also)g(looks)f(up)g(the)h(property)e(list)h(of)g(the)h
(node)f(to)h(gather)f(a)i(name)f(for)g(the)f(type)145
2261 y(\(see)i Fe(TypeNames.Preprocess)o(\(\))p Fn(\).)245
2356 y Fe(PROCEDURE)20 b(ProcessM3Type)f(\(astMap:)h(RefRefTbl.T;)790
2404 y(m3type:)g(M3AST_AS.M3TYPE\):)e(Type.T)j(=)289
2452 y(VAR)g(ts:)g(M3AST_AS.TYPE_SPE)o(C;)289 2499 y(BEGIN)p
eop
%%Page: 52 52
52 51 bop 58 141 a Fn(52)872 b Fi(CHAPTER)11 b(3.)24
b(IMPLEMENT)m(A)-5 b(TION)12 b(MODULES)245 258 y Fe(M3CTypesMisc.GetT)o
(YPE_S)o(PECFr)o(omM3)o(TYPE\()o(m3typ)o(e,)19 b(ts\);)245
305 y(RETURN)h(ProcessTypeSpec\(astM)o(ap,)e(ts\);)201
353 y(END)k(ProcessM3Type;)158 447 y(PROCEDURE)e(ProcessTypeSpec)e
(\(astMap:)i(RefRefTbl.T;)746 494 y(ts)87 b(:)21 b
(M3AST_AS.TYPE_SPEC\):)d(Type.T)j(=)201 542 y(VAR)245
590 y(r:)g(REFANY;)245 637 y(t:)g(Type.T;)201 685 y(BEGIN)245
733 y(IF)g(astMap.get\(ts,)e(r\))j(THEN)289 781 y(RETURN)e(NARROW\(r,)g
(Type.T\);)245 828 y(ELSE)289 876 y(TYPECASE)g(ts)h(OF)289
924 y(|)g(M3AST_AS.Real_type)d(=>)k(t)f(:=)g(Type.real;)289
972 y(|)g(M3AST_AS.LongReal_)o(type)d(=>)k(t)f(:=)h(Type.longreal;)289
1019 y(|)f(M3AST_AS.Extended_)o(type)d(=>)k(t)f(:=)h(Type.extended;)289
1067 y(|)f(M3AST_AS.Integer_t)o(ype)e(=>)i(t)g(:=)h(Type.integer;)289
1115 y(|)f(M3AST_AS.Null_type)d(=>)k(t)f(:=)g(Type.null;)289
1163 y(|)g(M3AST_AS.RefAny_ty)o(pe)e(=>)i(t)h(:=)f(Type.refany;)289
1210 y(|)g(M3AST_AS.Address_t)o(ype)e(=>)i(t)g(:=)h(Type.address;)289
1258 y(|)f(M3AST_AS.Root_type)d(\(rt\))j(=>)376 1306
y(TYPECASE)f(rt.as_trace_mode)e(OF)376 1354 y(|)j(NULL)g(=>)h(t)f(:=)h
(Type.root)376 1401 y(ELSE)419 1449 y(t)g(:=)f(Type.untracedRoot)376
1497 y(END;)289 1544 y(|)g(M3AST_AS.Packed_ty)o(pe)e(\(pt\))i(=>)376
1592 y(t)g(:=)h(NEW\(Type.Packed,)572 1640 y(size)f(:=)g
(NARROW\(pt.as_exp.s)o(m_exp)o(_valu)o(e,)899 1688 y(M3CBackEnd_C.Int)o
(eger_)o(value)o(\).sm)o(_valu)o(e,)572 1735 y(base)g(:=)g
(ProcessM3Type\(astM)o(ap,)e(pt.as_type\)\);)289 1783
y(|)i(M3AST_AS.Array_typ)o(e)e(\(at\))i(=>)376 1831 y(VAR)419
1879 y(ASTindexType:)e(M3AST_SM.TYPE_SPEC_)o(UNSET)o(;)419
1926 y(eltTypeSpec)h(:)h(M3AST_SM.TYPE_SPEC_)o(UNSET)o(;)419
1974 y(openArray)64 b(:)21 b(BOOLEAN;)376 2022 y(BEGIN)419
2070 y(EVAL)g(M3ASTNext.Array\(at)o(,)e(eltTypeSpec,)g(openArray,)h
(ASTindexType\);)419 2117 y(IF)i(openArray)e(THEN)463
2165 y(t)h(:=)h(NEW\(Type.OpenArr)o(ay,)d(index)h(:=)i(NIL,)659
2213 y(element)e(:=)i(ProcessTypeSpec\()o(astMa)o(p,)d
(eltTypeSpec\)\);)463 2261 y(WITH)i(openA)86 b(=)22 b(NARROW\(t,)d
(Type.OpenArray\),)572 2308 y(refArray)h(=)i(NEW\(Type.Ref,)d(traced)h
(:=)i(TRUE,)e(target)h(:=)g(t\))h(DO)506 2356 y(openA.refArray)d(:=)j
(refArray;)506 2404 y(TYPECASE)f(openA.element)e(OF)506
2452 y(|)j(Type.OpenArray)d(\(element\))h(=>)594 2499
y(openA.openDimen)o(sions)e(:=)k(element.openDime)o(nsio)o(ns)d(+)i(1;)
p eop
%%Page: 53 53
53 52 bop 145 141 a Fi(3.6.)25 b(MODULE)11 b(ASTT)o(OTYPE)1192
b Fn(53)594 258 y Fe(ELSE)637 305 y(openA.openDimensio)o(ns)19
b(:=)i(1;)594 353 y(END;)550 401 y(END;)506 449 y(ELSE)550
496 y(t)h(:=)f(NEW\(Type.Array,)746 544 y(index)g(:=)g
(ProcessM3Type\(astMa)o(p,)e(ASTindexType\),)746 592
y(element)i(:=)g(ProcessTypeSpec\(a)o(stMap)o(,)e(eltTypeSpec\)\);)506
640 y(END;)463 687 y(END;)376 735 y(|)i(M3AST_AS.Enumeratio)o(n_typ)o
(e)e(\(enum\))h(=>)463 783 y(VAR)506 831 y(enumt)h(:=)h(NEW\()746
878 y(Type.UserDefined,)c(elts)j(:=)h(NEW\(REF)e(ARRAY)h(OF)g(Atom.T,)
1400 926 y(enum.sm_num_eleme)o(nts\)\))o(;)506 974 y(iter)g(:=)h
(SeqM3AST_AS_Enum)o(_id.N)o(ewIte)o(r\(enu)o(m.as_)o(id_s\))o(;)506
1021 y(elem:)f(M3AST_AS.Enum_id;)463 1069 y(BEGIN)506
1117 y(FOR)h(i)f(:=)h(1)f(TO)h(enum.sm_num_ele)o(ments)c(DO)550
1165 y(EVAL)j(SeqM3AST_AS_Enum_)o(id.Ne)o(xt\(it)o(er,)e(elem\);)550
1212 y(enumt.elts[i)g(-)j(1])f(:=)594 1260 y(Atom.FromText\(M3)o(CId.)o
(ToTex)o(t\(ele)o(m.lx_)o(symre)o(p\)\);)506 1308 y(END;)506
1356 y(t)h(:=)f(enumt;)463 1403 y(END;)376 1451 y(|)g
(M3AST_AS.Set_type)e(\(set\))h(=>)463 1499 y(t)h(:=)h(NEW\(Type.Set,)d
(range)i(:=)g(ProcessM3Type\(astM)o(ap,)e(set.as_type\)\);)376
1547 y(|)i(M3AST_AS.Subrange_t)o(ype)e(\(sub\))h(=>)463
1594 y(VAR)506 1642 y(e1,)i(e2)43 b(:)21 b(M3AST_AS.EXP;)506
1690 y(i1,)h(i2)43 b(:)21 b(INTEGER;)506 1738 y(baseType:)f(Type.T;)463
1785 y(BEGIN)506 1833 y(baseType)h(:=)g(ProcessTypeSpec\(a)o(stMap)o(,)
e(sub.sm_base_type_)o(spec\))o(;)506 1881 y(e1)j(:=)f
(NARROW\(sub.as_rang)o(e,)e(M3AST_AS.Range\).a)o(s_exp)o(1;)506
1928 y(e2)j(:=)f(NARROW\(sub.as_rang)o(e,)e(M3AST_AS.Range\).a)o(s_exp)
o(2;)506 1976 y(EVAL)i(M3CBackEnd.Ord\(e1.s)o(m_exp)o(_valu)o(e,)e
(i1\);)506 2024 y(EVAL)i(M3CBackEnd.Ord\(e2.s)o(m_exp)o(_valu)o(e,)e
(i2\);)506 2072 y(t)j(:=)f(NEW\(Type.Subrange,)d(base)j(:=)h(baseType,)
703 2119 y(min)f(:=)g(NEW\(Value.Ordinal,)d(ord)j(:=)h(i1\),)703
2167 y(max)f(:=)g(NEW\(Value.Ordinal,)d(ord)j(:=)h(i2\)\);)463
2215 y(END)376 2263 y(|)f(M3AST_AS.Record_typ)o(e)e(\(rec\))i(=>)463
2310 y(t)g(:=)506 2358 y(NEW\(Type.Record,)e(fields)h(:=)i
(ProcessFields\(ast)o(Map,)c(rec.as_fields_s\)\);)376
2406 y(|)j(M3AST_AS.BRANDED_TY)o(PE)e(\(bt\))i(=>)463
2454 y(VAR)p eop
%%Page: 54 54
54 53 bop 58 141 a Fn(54)872 b Fi(CHAPTER)11 b(3.)24
b(IMPLEMENT)m(A)-5 b(TION)12 b(MODULES)419 258 y Fe(brandName:)20
b(Atom.T)42 b(:=)22 b(NIL;)419 305 y(branded)260 b(:=)22
b(FALSE;)419 353 y(trace)86 b(:)22 b(BOOLEAN;)376 401
y(BEGIN)419 449 y(IF)g(bt.as_brand)d(#)j(NIL)f(THEN)463
496 y(IF)g(bt.as_brand.as_exp)d(#)k(NIL)f(THEN)506 544
y(brandName)f(:=)550 592 y(Atom.FromText\(NAR)o(ROW\(b)o(t.as_)o(brand)
o(.as_e)o(xp.sm)o(_exp)o(_valu)o(e,)1008 640 y(M3CBackEnd_C.Tex)o
(t_val)o(ue\).)o(sm_va)o(lue\);)463 687 y(END;)463 735
y(branded)g(:=)i(TRUE)419 783 y(END;)419 831 y(TYPECASE)e(bt)i(OF)419
878 y(|)g(M3AST_AS.Ref_type)c(\(ref\))j(=>)506 926 y(TYPECASE)g
(ref.as_trace_mo)o(de)e(OF)506 974 y(|)j(NULL)f(=>)g(trace)g(:=)g
(TRUE;)506 1021 y(ELSE)550 1069 y(trace)g(:=)g(FALSE;)506
1117 y(END;)506 1165 y(t)h(:=)f(NEW\(Type.Ref,)e(traced)i(:=)g(trace,)g
(branded)f(:=)i(branded,)703 1212 y(brand)e(:=)i(brandName\);)506
1260 y(AddToTable\(astMap,)c(ts,)k(t\);)506 1308 y(NARROW\(t,)e
(Type.Ref\).target)f(:=)550 1356 y(ProcessM3Type\(ast)o(Map,)f
(ref.as_type\);)419 1403 y(|)k(M3AST_AS.Object_t)o(ype)c(\(ob\))j(=>)
506 1451 y(t)h(:=)f(ProcessObject\(astMa)o(p,)e(ob,)i(branded,)f
(brandName,)g(trace\);)419 1499 y(ELSE)463 1547 y(<*ASSERT)g(FALSE*>)
419 1594 y(END;)376 1642 y(END;)289 1690 y(|)h(M3AST_AS.Opaque_ty)o(pe)
e(\(o\))i(=>)376 1738 y(IF)g(o.sm_concrete_type)o(_spe)o(c)e(=)j(NIL)f
(THEN)419 1785 y(WITH)g(revSuperTs)f(=)i(M3CConcTypeSpec)o(.Curr)o
(entRe)o(veal\()o(o\),)528 1833 y(revSuperType)e(=)h
(NARROW\(ProcessType)o(Spec\()o(astMa)o(p,)e(revSuperTs\),)1008
1881 y(Type.Reference\))f(DO)463 1928 y(t)j(:=)h(NEW\(Type.Opaque,)c
(revealedSuperType)h(:=)i(revSuperType\);)419 1976 y(END;)376
2024 y(ELSE)419 2072 y(WITH)g(revTs)g(=)h(o.sm_concrete_t)o(ype_s)o
(pec)d(DO)463 2119 y(t)i(:=)h(ProcessTypeSpec\()o(astMa)o(p,)d
(revTs\);)463 2167 y(WITH)i(tt)g(=)h(NARROW\(t,)e(Type.Object\))f(DO)
506 2215 y(tt.revIntf)h(:=)550 2263 y(Atom.FromText\(M3C)o(Id.To)o
(Text\()o(revTs)o(.tmp_)o(unit_)o(id.l)o(x_sym)o(rep\)\))o(;)463
2310 y(END;)419 2358 y(END;)376 2406 y(END;)289 2454
y(|)h(M3AST_AS.Procedure)o(_type)d(\(proc\))j(=>)p eop
%%Page: 55 55
55 54 bop 145 141 a Fi(3.6.)25 b(MODULE)11 b(ASTT)o(OTYPE)1192
b Fn(55)463 258 y Fe(VAR)506 305 y(formals)21 b(:)g(REF)h(ARRAY)e(OF)i
(Type.Formal;)506 353 y(nFormals:)e(INTEGER)391 b(:=)22
b(0;)506 401 y(iter)f(:=)h(M3ASTNext.NewIte)o(rForm)o(al\(pr)o(oc.as)o
(_form)o(al_pa)o(ram_)o(s\);)506 449 y(formalParam:)e(M3AST_AS.Formal_)
o(param)o(;)506 496 y(formalId)64 b(:)22 b(M3AST_AS.FORMAL_)o(ID;)506
544 y(signature)42 b(:)22 b(Type.Signature;)463 592 y(BEGIN)506
640 y(WHILE)f(M3ASTNext.Formal\(i)o(ter,)d(formalParam,)i(formalId\))g
(DO)550 687 y(INC\(nFormals\))506 735 y(END;)506 783
y(formals)h(:=)g(NEW\(REF)g(ARRAY)f(OF)i(Type.Formal,)d(nFormals\);)506
831 y(iter)i(:=)h(M3ASTNext.NewIte)o(rForm)o(al\(pr)o(oc.as)o(_form)o
(al_pa)o(ram_)o(s\);)506 878 y(FOR)g(i)f(:=)h(0)f(TO)h(nFormals)e(-)h
(1)h(DO)550 926 y(EVAL)f(M3ASTNext.Formal\()o(iter,)d(formalParam,)i
(formalId\);)550 974 y(formals[i])g(:=)h(NEW\(Type.Formal\);)550
1021 y(formals[i].name)e(:=)594 1069 y(Atom.FromText\(M3)o(CId.)o
(ToTex)o(t\(for)o(malId)o(.lx_s)o(ymrep)o(\)\);)550 1117
y(formals[i].type)g(:=)594 1165 y(ProcessM3Type\(as)o(tMap)o(,)g
(formalId.sm_type_s)o(pec\);)550 1212 y(TYPECASE)h(formalId)g(OF)594
1260 y(M3AST_AS.F_Value)o(_id)e(=>)k(formals[i].mode)d(:=)i
(Type.Mode.Value;)550 1308 y(|)h(M3AST_AS.F_Var_i)o(d)d(=>)i
(formals[i].mode)e(:=)i(Type.Mode.Var;)550 1356 y(|)h(M3AST_AS.F_Reado)
o(nly_)o(id)d(=>)637 1403 y(formals[i].mode)g(:=)i(Type.Mode.Readonly;)
550 1451 y(ELSE)594 1499 y(<*ASSERT)f(FALSE*>)550 1547
y(END;)550 1594 y(formals[i].outOnly)e(:=)j(FALSE;)550
1642 y(\(*)g(Change)g(to)g(depend)g(on)g(<*OUTPUT*>)f(*\))506
1690 y(END;)506 1738 y(signature.formals)f(:=)i(formals;)506
1785 y(IF)h(proc.as_result_ty)o(pe)d(#)i(NIL)g(THEN)550
1833 y(signature.result)e(:=)i(ProcessM3Type\(ast)o(Map,)d
(proc.as_result_type)o(\);)506 1881 y(END;)506 1928 y(IF)k
(proc.as_raises)d(=)i(NIL)g(THEN)550 1976 y(signature.raises)e(:=)i
(NEW\(REF)f(ARRAY)h(OF)g(Type.Exception,)e(0\))506 2024
y(ELSE)550 2072 y(TYPECASE)h(proc.as_raises)f(OF)594
2119 y(M3AST_AS.Raisees)o(_som)o(e)g(\(r\))i(=>)637 2167
y(VAR)681 2215 y(iter)g(:=)g(SeqM3AST_AS_Qual_u)o(sed_i)o(d.New)o
(Iter\()899 2263 y(r.as_raisees_s\);)681 2310 y(nRaises)f(:=)i
(SeqM3AST_AS_Qua)o(l_use)o(d_id.)o(Lengt)o(h\()964 2358
y(r.as_raisees_s\);)681 2406 y(raisee)e(:)i(M3AST_AS.Qual_use)o(d_id;)
681 2454 y(arg)86 b(:)22 b(M3AST_AS.Exc_id;)p eop
%%Page: 56 56
56 55 bop 58 141 a Fn(56)872 b Fi(CHAPTER)11 b(3.)24
b(IMPLEMENT)m(A)-5 b(TION)12 b(MODULES)594 258 y Fe(argType:)20
b(Type.T;)550 305 y(BEGIN)594 353 y(signature.raise)o(s)f(:=)637
401 y(NEW\(REF)i(ARRAY)f(OF)i(Type.Exception,)c(nRaises\);)594
449 y(FOR)j(i)g(:=)h(0)f(TO)h(nRaises)e(-)i(1)f(DO)637
496 y(EVAL)g(SeqM3AST_AS_Qual_u)o(sed_i)o(d.Nex)o(t\(ite)o(r,)e
(raisee\);)637 544 y(signature.raises[i)o(])g(:=)i
(NEW\(Type.Exception\))o(;)637 592 y(signature.raises[i)o(].qid)d(:=)k
(NEW\(Type.Qid\);)637 640 y(WITH)f(qid)g(=)h(signature.raises[)o(i].qi)
o(d)d(DO)681 687 y(qid.intf)h(:=)724 735 y(Atom.FromText\()768
783 y(M3CId.ToText\()812 831 y(raisee.as_id.sm)o(_def.)o(tmp_u)o(nit_i)
o(d.lx)o(_symr)o(ep\)\);)681 878 y(qid.item)g(:=)724
926 y(Atom.FromText\()768 974 y(M3CId.ToText\(rais)o(ee.as)o(_id.l)o
(x_sym)o(rep\))o(\);)637 1021 y(END;)637 1069 y(IF)i(raisee.as_id.sm)o
(_def)c(=)k(NIL)f(THEN)681 1117 y(signature.raises)o([i].a)o(rg)e(:=)i
(NIL)637 1165 y(ELSE)681 1212 y(arg)g(:=)724 1260 y
(NARROW\(raisee.as_id)o(.sm_d)o(ef,)e(M3AST_AS.Exc_id)o(\);)681
1308 y(IF)i(arg.tmp_type)e(=)j(NIL)f(THEN)724 1356 y
(signature.raises[i])o(.arg)d(:=)k(NIL;)681 1403 y(ELSE)724
1451 y(argType)f(:=)g(ProcessM3Type\(astM)o(ap,)e(arg.tmp_type\);)724
1499 y(signature.raises[i])o(.arg)f(:=)k(argType;)681
1547 y(END;)637 1594 y(END;)594 1642 y(END;)550 1690
y(END;)463 1738 y(|)f(M3AST_AS.Raisees_an)o(y)e(=>)463
1785 y(ELSE)506 1833 y(signature.raises)g(:=)i(NEW\(REF)g(ARRAY)f(OF)i
(Type.Exception,)c(0\))463 1881 y(END;)419 1928 y(END;)419
1976 y(t)k(:=)f(NEW\(Type.Procedure)o(,)e(sig)i(:=)h(signature\);)376
2024 y(END;)289 2072 y(ELSE)289 2119 y(END;)245 2167
y(END;)245 2215 y(AddToTable\(astMap)o(,)d(ts,)i(t\);)245
2263 y(RETURN)f(t;)201 2310 y(END)i(ProcessTypeSpec)o(;)158
2404 y(PROCEDURE)e(ProcessObject)f(\(astMap)h(:)i(RefRefTbl.T;)703
2452 y(o)130 b(:)22 b(M3AST_AS.Object_)o(type;)703 2499
y(branded:)e(BOOLEAN;)p eop
%%Page: 57 57
57 56 bop 145 141 a Fi(3.6.)25 b(MODULE)11 b(ASTT)o(OTYPE)1192
b Fn(57)790 258 y Fe(brand)42 b(:)22 b(Atom.T;)790 305
y(traced)e(:)i(BOOLEAN)325 b(\):)22 b(Type.T)e(=)289
353 y(VAR)h(t)g(:=)h(NEW\(Type.Object\))o(;)289 401 y(BEGIN)332
449 y(AddToTable\(astMap,)c(o,)k(t\);)332 496 y(t.branded)e(:=)h
(branded;)332 544 y(t.brand)f(:=)i(brand;)332 592 y(t.traced)e(:=)i
(traced;)332 640 y(IF)f(o.as_ancestor)f(#)h(NIL)g(THEN)376
687 y(t.super)f(:=)h(ProcessM3Type\(astMa)o(p,)e(o.as_ancestor\);)332
735 y(END;)332 783 y(t.fields)h(:=)i(ProcessFields\(as)o(tMap)o(,)d
(o.as_fields_s\);)332 831 y(t.methods)h(:=)h(ProcessMethods\(astM)o
(ap,)e(o.as_method_s\);)332 878 y(RETURN)i(t;)289 926
y(END)g(ProcessObject;)245 1019 y(PROCEDURE)f(ProcessFields)f
(\(astMap:)h(RefRefTbl.T;)f(f:)j(SeqM3AST_AS_Fiel)o(ds.T\))o(:)289
1067 y(REF)f(ARRAY)f(OF)i(Type.Field)e(=)289 1115 y(VAR)332
1163 y(nFields)42 b(:)22 b(INTEGER)412 b(:=)22 b(0;)332
1210 y(fields)64 b(:)22 b(REF)f(ARRAY)g(OF)g(Type.Field;)332
1258 y(iter)718 b(:=)22 b(M3ASTNext.NewIter)o(Fiel)o(d\(f\);)332
1306 y(iterItems)608 b(:=)22 b(SeqM3AST_AS_Field)o(s.Ne)o(wIter)o
(\(f\);)332 1354 y(iterIds)42 b(:)22 b(SeqM3AST_AS_Field)o(_id.)o
(Iter;)332 1401 y(astFields:)e(M3AST_AS.Fields;)332 1449
y(fieldId)42 b(:)22 b(M3AST_AS.Field_id)o(;)332 1497
y(j)174 b(:)22 b(INTEGER)412 b(:=)22 b(0;)289 1544 y(BEGIN)332
1592 y(WHILE)f(M3ASTNext.Field\(i)o(ter,)d(fieldId\))i(DO)i
(INC\(nFields\))d(END;)332 1640 y(fields)i(:=)g(NEW\(REF)f(ARRAY)h(OF)h
(Type.Field,)d(nFields\);)332 1688 y(WHILE)i(SeqM3AST_AS_Field)o(s.Nex)
o(t\(it)o(erIte)o(ms,)e(astFields\))g(DO)376 1735 y(iterIds)h(:=)h
(SeqM3AST_AS_Field_i)o(d.New)o(Iter\()o(astFi)o(elds.)o(as_id)o(_s\);)
376 1783 y(WHILE)f(SeqM3AST_AS_Field_id)o(.Nex)o(t\(ite)o(rIds,)e
(fieldId\))i(DO)419 1831 y(fields[j])g(:=)i(NEW\(Type.Field\))o(;)419
1879 y(fields[j].name)d(:=)j(Atom.FromText\(M)o(3CId.)o(ToTex)o(t\(fie)
o(ldId.)o(lx_s)o(ymrep)o(\)\);)419 1926 y(IF)g(astFields.as_typ)o(e)d
(=)j(NIL)f(THEN)463 1974 y(fields[j].type)e(:=)i(ProcessTypeSpec\(as)o
(tMap,)d(fieldId.sm_type_sp)o(ec\))419 2022 y(ELSE)463
2070 y(fields[j].type)h(:=)i(ProcessM3Type\(astM)o(ap,)e
(astFields.as_ty)o(pe\);)419 2117 y(END;)419 2165 y(IF)j
(\(*fieldId.vINIT_)o(ID.sm)o(_ini)o(t_exp)o(*\))d(astFields.as_defa)o
(ult)f(#)k(NIL)f(THEN)463 2213 y(fields[j].default)d(:=)k
(ProcessExp\(astF)o(ields)o(.as_d)o(efaul)o(t\);)419
2261 y(END;)419 2308 y(INC\(j\);)376 2356 y(END;)332
2404 y(END;)332 2452 y(RETURN)f(fields;)289 2499 y(END)g
(ProcessFields;)p eop
%%Page: 58 58
58 57 bop 58 141 a Fn(58)872 b Fi(CHAPTER)11 b(3.)24
b(IMPLEMENT)m(A)-5 b(TION)12 b(MODULES)158 258 y Fe(PROCEDURE)20
b(ProcessMethods)f(\(astMap:)h(RefRefTbl.T;)f(m:)i(SeqM3AST_AS_Method.)
o(T\):)201 305 y(REF)h(ARRAY)e(OF)i(Type.Method)d(=)201
353 y(VAR)245 401 y(nMethods)608 b(:=)22 b(SeqM3AST_AS_Metho)o(d.Le)o
(ngth\()o(m\);)245 449 y(methods)42 b(:)22 b(REF)f(ARRAY)g(OF)g
(Type.Method;)245 496 y(iter)696 b(:=)22 b(SeqM3AST_AS_Metho)o(d.Ne)o
(wIter)o(\(m\);)245 544 y(astMethod:)e(M3AST_AS.Method;)201
592 y(BEGIN)245 640 y(methods)g(:=)i(NEW\(REF)e(ARRAY)h(OF)g
(Type.Method,)e(nMethods\);)245 687 y(FOR)i(i)h(:=)f(0)h(TO)f(nMethods)
f(-)i(1)f(DO)289 735 y(EVAL)f(SeqM3AST_AS_Method.N)o(ext\()o(iter,)e
(astMethod\);)289 783 y(methods[i])h(:=)j(NEW\(Type.Method)o(\);)289
831 y(methods[i].name)c(:=)332 878 y(Atom.FromText\(M3CI)o(d.ToT)o
(ext\()o(astMe)o(thod.)o(as_id)o(.lx_s)o(ymrep)o(\)\);)289
926 y(methods[i].sig)g(:=)332 974 y(NARROW\(ProcessType)o(Spec\()o
(astM)o(ap,)h(astMethod.as_typ)o(e\),)485 1021 y(Type.Procedure\).)o
(sig;)245 1069 y(END;)245 1117 y(RETURN)h(methods;)201
1165 y(END)i(ProcessMethods;)158 1235 y(PROCEDURE)e(ProcessExp\(exp:)e
(M3AST_AS.EXP\):)h(Value.T)i(=)201 1283 y(BEGIN)245 1331
y(TYPECASE)f(exp.sm_exp_value)f(OF)289 1378 y(|)43 b(M3CBackEnd_C.Inte)
o(ger_v)o(alue)18 b(\(int\))j(=>)397 1426 y(RETURN)g
(NEW\(Value.Ordinal)o(,)e(ord)i(:=)h(int.sm_value\))289
1474 y(|)43 b(M3CBackEnd_C.Text)o(_valu)o(e)19 b(\(txt\))i(=>)397
1522 y(RETURN)g(NEW\(Value.Txt,)e(val)i(:=)g(txt.sm_value\))289
1569 y(|)43 b(M3CBackEnd_C.Real)o(_valu)o(e)19 b(\(real\))h(=>)397
1617 y(RETURN)h(NEW\(Value.Float,)d(val)k(:=)f(real.sm_value\);)289
1665 y(|)43 b(M3CBackEnd_C.Long)o(Real_)o(valu)o(e)19
b(\(lreal\))h(=>)397 1713 y(RETURN)h(NEW\(Value.LongFlo)o(at,)e(val)i
(:=)g(lreal.sm_value\);)289 1760 y(|)43 b(M3CBackEnd_C.Exte)o(nded_)o
(valu)o(e)19 b(\(ereal\))h(=>)397 1808 y(RETURN)h(NEW\(Value.Extende)o
(d,)e(val)i(:=)g(ereal.sm_value\);)289 1856 y(\(*)289
1904 y(|)43 b(M3CBackEnd_C.Set_)o(const)o(ruct)o(or_va)o(lue)19
b(=>)289 1951 y(|)43 b(M3CBackEnd_C.Arra)o(y_or_)o(reco)o(rd_co)o
(nstru)o(ctor_)o(value)18 b(=>)289 1999 y(|)43 b(M3CBackEnd_C.Proc)o
(_valu)o(e)19 b(=>)289 2047 y(*\))289 2095 y(ELSE)332
2142 y(<*ASSERT)h(FALSE*>)245 2190 y(END;)201 2238 y(END)i(ProcessExp;)
158 2308 y(PROCEDURE)e(AddToTable)f(\(astMap:)i(RefRefTbl.T;)637
2356 y(ts)87 b(:)22 b(M3AST_AS.TYPE_S)o(PEC;)637 2404
y(t)109 b(:)22 b(Type.T)303 b(\))22 b(=)201 2452 y(BEGIN)245
2499 y(EVAL)f(astMap.put\(ts,)e(t\);)p eop
%%Page: 59 59
59 58 bop 145 141 a Fi(3.7.)25 b(MODULE)11 b(IMPOR)n(TLIST)1185
b Fn(59)332 258 y Fe(IF)21 b(t.name)g(=)h(NIL)f(THEN)376
305 y(WITH)g(symrep)f(=)i(NARROW\(PropertyV)o(.Get\()877
353 y(ts.tl_pset,)877 401 y(TYPECODE\(M3AST_LX)o(.Symb)o(ol_re)o
(p\)\),)833 449 y(M3AST_LX.Symbol_rep)o(\))d(DO)419 496
y(IF)j(symrep)e(#)i(NIL)f(THEN)463 544 y(t.name)f(:=)i
(NEW\(Type.Qid\);)463 592 y(t.name.intf)d(:=)506 640
y(Atom.FromText\()550 687 y(M3CId.ToText\(ts.tm)o(p_un)o(it_id)o(.lx_s)
o(ymrep)o(\)\);)463 735 y(t.name.item)g(:=)506 783 y
(Atom.FromText\(M3CId.)o(ToTe)o(xt\(sy)o(mrep\))o(\);)419
831 y(END;)376 878 y(END;)332 926 y(END;)289 974 y(END)i(AddToTable;)
245 1048 y(BEGIN)245 1098 y(END)g(AstToType.)145 1268
y Fg(3.7)60 b(Module)15 b(ImportList)145 1388 y Fn(The)c(module)f
(contains)g(procedures)g(to)g(gain)g(necessary)i(imports)d(to)h
(compile)g(a)g(type.)245 1489 y Fe(MODULE)20 b(ImportList;)245
1565 y(IMPORT)g(Atom,)h(AtomRefTbl,)f(Type;)145 1714
y Fb(3.7.1)51 b(Pr)o(oducing)12 b(import)g(lists)145
1793 y Fn(The)h(proceuderes)f Fe(Import...)k Fn(maintain)11
b(a)i(list)d(modules)i(necessary)h(to)e(represent)h(a)g(type.)18
b(This)12 b(list)e(is)i(a)g Fe(Atom-)145 1843 y(RefTbl.T)6
b Fn(which)i(is)f(only)g(used)h(in)f(a)h(set)g(like)f(fashion.)12
b(There)d(are)f(no)g(entries)f(in)g(the)h(table)f(\()p
Fe(NIL)g Fn(is)h(inserted)f(together)145 1893 y(with)i(the)i
(interface\).)208 1943 y(The)f(main)h(module)f(called)g(from)g(outside)
g(is)g Fe(FromType\(\))p Fn(.)245 2043 y Fe(REVEAL)20
b(T)i(=)g(AtomRefTbl.Defau)o(lt)d(BRANDED)h(OBJECT)h(END;)245
2117 y(PROCEDURE)f(FromType)g(\(type:)h(Type.Object;)e(methods:)h
(MethodList\):)f(T)j(=)289 2165 y(VAR)332 2213 y(obj)130
b(:)22 b(Type.Reference)d(:=)i(type;)332 2261 y(importTbl:)f(T)305
b(:=)21 b(NEW\(T\).init\(\);)289 2308 y(BEGIN)332 2356
y(IF)g(type.name)f(#)i(NIL)f(AND)g(type.name.intf)e(#)j(nullAtm)e(THEN)
376 2404 y(EVAL)h(importTbl.put\(ty)o(pe.na)o(me.i)o(ntf,)d(NIL\);)332
2452 y(END;)332 2499 y(ImportRevelations\()o(type,)g(importTbl\);)p
eop
%%Page: 60 60
60 59 bop 58 141 a Fn(60)872 b Fi(CHAPTER)11 b(3.)24
b(IMPLEMENT)m(A)-5 b(TION)12 b(MODULES)245 258 y Fe(FOR)21
b(i)h(:=)f(0)h(TO)f(LAST\(methods^\))e(DO)289 305 y(WITH)h(sig)i(=)f
(methods[i].sig)e(DO)332 353 y(ImportFromSig\(sig,)f(importTbl\);)332
401 y(ImportRefsFromSig\()o(sig,)g(importTbl\);)332 449
y(\(*)j(Hmm.)43 b(StableData.m3)19 b(will)i(not)g(actually)g(handle)f
(the)h(exceptions.)332 496 y(FOR)g(j)h(:=)f(0)h(TO)f
(LAST\(sig.raises^\))d(DO)376 544 y(ImportFromType\(s)o(ig.ra)o(ises)o
([j].a)o(rg,)h(importTbl\);)332 592 y(END;)332 640 y(*\))289
687 y(END)522 b(\(*WITH*\))245 735 y(END;)544 b(\(*FOR*\))245
783 y(WHILE)21 b(obj)g(#)g(NIL)h(AND)f(ISTYPE\(obj,)e(Type.Object\))h
(DO)289 831 y(IF)h(obj.revIntf)e(#)j(NIL)f(THEN)g(EVAL)g
(importTbl.put\(obj.)o(revIn)o(tf,)d(NIL\);)j(END;)289
878 y(obj)g(:=)g(NARROW\(obj,)f(Type.Object\).su)o(per;)245
926 y(END;)245 974 y(RETURN)g(importTbl;)201 1021 y(END)i(FromType;)158
1092 y(PROCEDURE)e(ImportRevelation)o(s)f(\(t:)i(Type.Reference;)e
(importTbl:)h(T\))h(=)201 1140 y(\(*)h(Add)f(to)g(the)g(table)g
("importTbl")f(the)h(names)g(of)g(interfaces)f(that)h(provide)267
1187 y(revelations)e(of)j("t")f(or)g(one)g(of)h(its)f(supertypes.)e
(*\))201 1235 y(BEGIN)245 1283 y(IF)i(t.revIntf)f(#)i(NIL)f(THEN)g
(EVAL)g(importTbl.put\(t.r)o(evInt)o(f,)e(NIL\);)h(END;)245
1331 y(TYPECASE)g(t)i(OF)245 1378 y(|)g(Type.Object)d(\(obj\))i(=>)332
1426 y(VAR)g(o)h(:=)f(obj;)332 1474 y(BEGIN)376 1522
y(WHILE)f(TRUE)h(DO)419 1569 y(TYPECASE)f(o.super)h(OF)419
1617 y(|)h(Type.Opaque)d(=>)j(EXIT)419 1665 y(|)g(Type.Object)d(=>)506
1713 y(IF)j(o.revIntf)e(#)h(NIL)g(THEN)550 1760 y(EVAL)g
(importTbl.put\(o.r)o(evInt)o(f,)e(NIL\);)506 1808 y(END;)506
1856 y(o)j(:=)f(o.super;)419 1904 y(ELSE)463 1951 y(<*ASSERT)f(FALSE*>)
419 1999 y(END;)376 2047 y(END;)332 2095 y(END;)245 2142
y(ELSE)245 2190 y(END;)201 2238 y(END)i(ImportRevelatio)o(ns;)158
2308 y(PROCEDURE)e(ImportFromType)f(\(t:)i(Type.T;)f(importTbl:)g(T;)h
(byName:)g(BOOLEAN)f(:=)h(TRUE\))g(=)201 2356 y(BEGIN)245
2404 y(IF)g(t)h(=)f(NIL)h(THEN)f(RETURN)f(END;)245 2452
y(IF)h(t.name)g(#)g(NIL)h(AND)f(t.name.intf)e(#)j(nullAtm)e(THEN)289
2499 y(EVAL)g(importTbl.put\(t.name)o(.int)o(f,)f(NIL\);)p
eop
%%Page: 61 61
61 60 bop 145 141 a Fi(3.7.)25 b(MODULE)11 b(IMPOR)n(TLIST)1185
b Fn(61)332 258 y Fe(END;)332 305 y(TYPECASE)20 b(t)i(OF)332
353 y(|)g(Type.Reference)d(\(ref\))h(=>)i(ImportRevelation)o(s\(ref)o
(,)d(importTbl\);)332 401 y(ELSE)332 449 y(END;)332 496
y(IF)i(byName)g(AND)g(t.name)g(#)g(NIL)h(THEN)e(RETURN;)h(END;)332
544 y(TYPECASE)f(t)i(OF)332 592 y(|)g(Type.Enumeration)o(,)d
(Type.UserDefined,)f(Type.Real,)i(Type.LongReal,)419
640 y(Type.Extended)f(=>)332 687 y(|)j(Type.Subrange)d(\(sr\))i(=>)g
(ImportFromType\(sr.)o(base,)d(importTbl\);)332 735 y(|)k(Type.Object)d
(\(ob\))i(=>)419 783 y(ImportFromFields\(ob)o(.fiel)o(ds,)d
(importTbl\);)419 831 y(FOR)j(i)h(:=)f(0)h(TO)f(LAST\(ob.methods^\))e
(DO)463 878 y(ImportFromSig\(ob.)o(metho)o(ds[i)o(].sig)o(,)g
(importTbl\);)419 926 y(END;)419 974 y(IF)j(ob.revIntf)d(#)j(NIL)f
(THEN)g(EVAL)g(importTbl.put\(ob.r)o(evInt)o(f,)e(NIL\);)h(END;)332
1021 y(|)i(Type.Ref)e(\(r\))h(=>)g(ImportFromType\(r.ta)o(rget,)d
(importTbl\);)332 1069 y(|)k(Type.Opaque)d(\(op\))i(=>)h
(ImportFromType\()o(op.re)o(veale)o(dSupe)o(rType)o(,)d(importTbl\);)
332 1117 y(|)j(Type.Array)d(\(a\))j(=>)419 1165 y(ImportFromType\(a.in)
o(dex,)c(importTbl\);)419 1212 y(ImportFromType\(a.el)o(ement)o(,)h
(importTbl\);)332 1260 y(|)j(Type.Packed)d(\(p\))i(=>)h
(ImportFromType\(p)o(.base)o(,)d(importTbl\);)332 1308
y(|)j(Type.Record)d(\(rec\))i(=>)g(ImportFromFields\(re)o(c.fie)o(lds,)
d(importTbl\);)332 1356 y(|)k(Type.Set)e(\(s\))h(=>)g
(ImportFromType\(s.ra)o(nge,)d(importTbl\);)332 1403
y(|)k(Type.Procedure)d(\(p\))i(=>)g(ImportFromSig\(p.si)o(g,)e
(importTbl\);)332 1451 y(ELSE)376 1499 y(<*ASSERT)h(FALSE*>)332
1547 y(END;)289 1594 y(END)h(ImportFromType;)245 1665
y(PROCEDURE)f(ImportFromFields)e(\(fields:)i(REF)i(ARRAY)e(OF)i
(Type.Field;)d(importTbl:)h(T\))h(=)289 1713 y(BEGIN)332
1760 y(IF)g(fields)g(=)h(NIL)f(THEN)g(RETURN)f(END;)332
1808 y(FOR)h(i)h(:=)f(0)h(TO)f(LAST\(fields^\))e(DO)376
1856 y(ImportFromType\(f)o(ields)o([i].t)o(ype,)f(importTbl\);)332
1904 y(END;)289 1951 y(END)j(ImportFromFields)o(;)245
2022 y(PROCEDURE)f(ImportFromSig)f(\(sig:)i(Type.Signature;)d
(importTbl:)i(T\))i(=)289 2070 y(BEGIN)332 2117 y(FOR)f(i)h(:=)f(0)h
(TO)f(LAST\(sig.formals^\))d(DO)376 2165 y(ImportFromType\(s)o(ig.fo)o
(rmals)o([i].)o(type,)g(importTbl\);)332 2213 y(END;)332
2261 y(ImportFromType\(sig)o(.resu)o(lt,)h(importTbl\);)332
2308 y(IF)i(sig.raises)f(#)i(NIL)f(THEN)376 2356 y(FOR)g(i)g(:=)h(0)f
(TO)h(LAST\(sig.raises^)o(\))d(DO)419 2404 y(EVAL)i
(importTbl.put\(sig.r)o(aise)o(s[i].)o(qid.i)o(ntf,)d(NIL\);)376
2452 y(END;)332 2499 y(END;)p eop
%%Page: 62 62
62 61 bop 58 141 a Fn(62)872 b Fi(CHAPTER)11 b(3.)24
b(IMPLEMENT)m(A)-5 b(TION)12 b(MODULES)201 258 y Fe(END)22
b(ImportFromSig;)158 332 y(PROCEDURE)e(ImportRefsFromSi)o(g)f(\(sig:)i
(Type.Signature;)d(importTbl:)i(T\))h(=)201 380 y(BEGIN)245
427 y(FOR)g(i)h(:=)f(0)h(TO)f(LAST\(sig.formals^)o(\))e(DO)289
475 y(ImportRefsFromT)o(ype\(s)o(ig.fo)o(rmal)o(s[i].)o(type,)f
(importTbl\);)245 523 y(END;)245 571 y(ImportRefsFromTyp)o(e\(sig)o
(.resu)o(lt,)g(importTbl\);)201 618 y(END)k(ImportRefsFromS)o(ig;)158
693 y(PROCEDURE)e(ImportRefsFromTy)o(pe)f(\(t:)i(Type.T;)f(importTbl:)g
(T\))h(=)201 740 y(BEGIN)245 788 y(IF)g(t)h(=)f(NIL)h(THEN)f(RETURN)f
(END;)245 836 y(TYPECASE)g(t)i(OF)245 883 y(|)g(Type.Enumeratio)o(n,)d
(Type.UserDefined)o(,)g(Type.Real,)h(Type.LongReal,)332
931 y(Type.Extended,)f(Type.Subrange,)g(Type.Set,)h(Type.Procedure)f
(=>)245 979 y(|)j(Type.Reference)c(=>)332 1027 y(IF)j(NOT)h
(Type.MayBeRefAny)o(\(t\))c(AND)k(Type.NamedType\(t)o(\))d(THEN)376
1074 y(ImportFromType\(t)o(,)g(importTbl\))332 1122 y(END;)245
1170 y(|)j(Type.Array)d(\(a\))i(=>)332 1218 y(ImportFromType\(a.i)o
(ndex,)d(importTbl\);)332 1265 y(ImportRefsFromType)o(\(a.el)o(emen)o
(t,)h(importTbl\);)245 1313 y(|)j(Type.Packed)d(\(p\))i(=>)h
(ImportRefsFromT)o(ype\(p)o(.base)o(,)d(importTbl\);)245
1361 y(|)j(Type.Record)d(\(rec\))i(=>)332 1409 y(IF)g(rec.fields)f(=)i
(NIL)f(THEN)g(RETURN)f(END;)332 1456 y(FOR)h(i)h(:=)f(0)h(TO)f
(LAST\(rec.fields^\))d(DO)376 1504 y(ImportRefsFromTy)o(pe\(re)o(c.fi)o
(elds[)o(i].ty)o(pe,)h(importTbl\);)332 1552 y(END;)245
1600 y(ELSE)289 1647 y(<*ASSERT)h(FALSE*>)245 1695 y(END;)201
1745 y(END)i(ImportRefsFromT)o(ype;)58 1895 y Fb(3.7.2)51
b(Pr)o(ocedur)o(e)13 b(Add)58 1974 y Fn(Add)d(an)h(element)f
Fe(intf)g Fn(to)g(a)g(import)f(list.)158 2075 y Fe(PROCEDURE)20
b(Add)h(\(importList:)e(T;)j(intf:)e(Atom.T\))h(=)201
2123 y(BEGIN)245 2170 y(EVAL)g(importList.put\(in)o(tf,)e(NIL\))201
2220 y(END)j(Add;)58 2370 y Fb(3.7.3)51 b(Pr)o(ocedur)o(e)13
b(T)-5 b(oT)g(ext)58 2449 y Fn(Generate)10 b(a)g(comma)h(separated)f
(list)e(of)h(interface)g(names)i(out)d(of)h Fe(imports)p
Fn(.)k(The)c(output)f(is)h(suitable)g(for)f(an)i Fe(IMPORT)58
2499 y Fn(statement.)p eop
%%Page: 63 63
63 62 bop 145 141 a Fi(3.8.)25 b(MODULE)11 b(ST)m(ABLEGENARGS)1078
b Fn(63)208 258 y(Iterate)10 b(over)g(the)g(table)g Fe(imports)f
Fn(and)i(append)f(to)f Fe(result)p Fn(.)245 354 y Fe(PROCEDURE)20
b(ToText)g(\(imports:)g(T\):)i(TEXT)e(=)289 402 y(VAR)332
450 y(intf)43 b(:)21 b(Atom.T;)332 498 y(dummy)g(:)g(REFANY;)332
545 y(iter)239 b(:=)21 b(imports.iterate\(\);)332 593
y(result)195 b(:=)21 b("";)289 641 y(BEGIN)332 689 y(IF)g
(iter.next\(intf,)e(dummy\))i(THEN)376 736 y(result)f(:=)i
(Atom.ToText\(intf)o(\);)376 784 y(WHILE)e(iter.next\(intf,)f(dummy\))i
(DO)419 832 y(result)g(:=)g(result)g(&)g(",)h(")f(&)h
(Atom.ToText\(intf\))o(;)376 880 y(END;)332 927 y(END;)332
975 y(RETURN)f(result;)289 1023 y(END)g(ToText;)245 1095
y(VAR)g(nullAtm)f(:=)i(Atom.FromText\(""\))o(;)245 1167
y(BEGIN)245 1217 y(END)f(ImportList.)145 1381 y Fg(3.8)60
b(Module)15 b(StablegenArgs)145 1498 y Fn(The)g(module)e(sets)h(up)f
(the)g(tool')n(s)f(parameters)j(\(see)g(initialization\))10
b(and)k(reads)g(the)g(parameters)g(in)f(the)h(procedure)145
1548 y Fe(Get\(\))245 1645 y(MODULE)20 b(StablegenArgs;)245
1717 y(IMPORT)g(M3Args,)h(Type,)g(Atom,)f(StablegenError;)245
1790 y(CONST)289 1837 y(Version)129 b(=)21 b("Aug-94";)289
1885 y(ArgImplfile)41 b(=)21 b("ImplementationModu)o(le";)289
1933 y(ArgRepModule)41 b(=)21 b("RepModule";)289 1983
y(ArgDataT)107 b(=)21 b("Object";)145 2125 y Fb(3.8.1)51
b(Pr)o(ocedur)o(e)13 b(Get)145 2203 y Fn(First)8 b(check)g(for)g(help)g
(option.)j(If)d(present)g(just)f(display)g(help)h(and)g(return.)k(Then)
d(load)e(the)h(parameters)h(\(which)f(checks)145 2253
y(for)j(correctness)g(especially)g(whether)g(the)f(required)h
Fe(Object)e Fn(parameter)j(is)f(present\).)k(Then)d(read)f(the)g(name)h
(of)e(the)145 2303 y(object')n(s)h(interface.)16 b(Then)11
b(read)h(the)f(implementation)e(and)i(rep)h(module)e(name.)17
b(Build)10 b(up)g(the)h(default)g(name)h(if)e(the)145
2353 y(parameter)h(is)f(not)f(present.)14 b(Finally)8
b(read)i(the)g Fe(-i)f Fn(parameter)i(to)e(get)h(the)g(name)g(of)g(the)
g(most)f(speci\256c)i(revealation)e(of)145 2402 y Fe(object)g
Fn(\261)i(it)e(must)h(be)h(in)e(the)h(\256rst)g(interface)h(listed)e
(by)h(the)g Fe(-i)g Fn(parameter)n(.)245 2499 y Fe(PROCEDURE)20
b(Get\(VAR)g(object:)h(Type.Qid;)e(VAR)j(reveal,)e(impl,)h(rep:)g
(TEXT\))p eop
%%Page: 64 64
64 63 bop 58 141 a Fn(64)872 b Fi(CHAPTER)11 b(3.)24
b(IMPLEMENT)m(A)-5 b(TION)12 b(MODULES)201 258 y Fe(RAISES)21
b({StablegenError.E)o(})e(=)201 305 y(BEGIN)245 353 y(IF)i
(M3Args.CheckHelp\(di)o(splay)o(:=)e(FALSE\))h(THEN)289
401 y(M3Args.Help\(too)o(l\);)289 449 y(RAISE)g(StablegenError.E\("n)o
(othi)o(ng)f(was)i(parsed"\);)245 496 y(END;)g(\(*IF*\))245
544 y(IF)g(M3Args.Find\(tool\))e(THEN)289 592 y(VAR)i(intf:=)f
(M3Args.GetString\(t)o(ool,)e(ArgDataT\);)289 640 y(BEGIN)332
687 y(object:=)i(NEW\(Type.Qid,)f(intf:=)i(Atom.FromText\(int)o(f\),)
615 735 y(item:=)g(Atom.FromText\("T")o(\)\);)332 783
y(impl:=)g(M3Args.GetString)o(\(too)o(l,)e(ArgImplfile\);)332
831 y(IF)i(impl)g(=)h(NIL)f(THEN)g(impl:=)g("Stable"&intf)e(END;)332
878 y(rep:=)i(M3Args.GetString\()o(tool)o(,)e(ArgRepModule\);)332
926 y(IF)i(rep)h(=)f(NIL)g(THEN)g(rep:=)g(impl&"Rep")f(END;)289
974 y(END)245 1021 y(ELSE)289 1069 y(RAISE)g(StablegenError.E\("i)o
(nval)o(id)f(parameter"\);)245 1117 y(END;)i(\(*IF*\))245
1165 y(VAR)g(ints:=)g(M3Args.GetString)o(List)o(\(tool)o(,)e
("Interfaces"\);)245 1212 y(BEGIN)289 1260 y(IF)i(ints)g(=)g(NIL)h
(THEN)332 1308 y(RAISE)f(StablegenError.E\()o("nee)o(d)e(-Interfaces)h
(\(-i\))h(parameter"\);)289 1356 y(END;)289 1403 y(reveal:=)f(ints[0];)
245 1451 y(END)201 1501 y(END)i(Get;)58 1636 y Fb(3.8.2)51
b(Initialisation)58 1714 y Fn(Start)10 b(by)g(registration)e(of)i
(parameters)i(speci\256c)f(to)f(the)g(stable)g(stub)f(generator)n(.)158
1800 y Fe(VAR)201 1848 y(tool)21 b(:=)h(M3Args.New\("stub)o(s",)615
1896 y("Generate)e(stubs)h(for)g(network)g(objects",)615
1944 y(Version,)g(master)f(:=)h(TRUE\);)158 1991 y(BEGIN)201
2039 y(M3Args.RegisterStri)o(ng\(to)o(ol,)e(ArgDataT,)681
2087 y("name)i(of)g(object)f(interface",)681 2134 y(opt:=)h
(M3Args.Opt.Requ)o(ired\))o(;)201 2182 y(M3Args.RegisterStri)o(ng\(to)o
(ol,)e(ArgImplfile,)681 2230 y("name)i(of)g(module)f(containing)g(")681
2278 y(&)h("implementation)e(of)i(stable)g(subtype"\);)201
2325 y(M3Args.RegisterStri)o(ng\(to)o(ol,)e(ArgRepModule,)681
2373 y("name)i(of)g(module)f(containing)g(")681 2421
y(&)h("the)g(instatiation)f(of)h(the)g(StableRep)f(module."\);)158
2471 y(END)h(StablegenArgs.)p eop
%%Page: 65 65
65 64 bop 145 141 a Fi(3.9.)25 b(MODULE)11 b(TYPE)1324
b Fn(65)145 258 y Fg(3.9)60 b(Module)15 b(T)l(ype)245
379 y Fe(MODULE)20 b(Type;)245 455 y(IMPORT)g(Atom,)h(Fmt,)g(Text,)g
(Value,)g(ValueProc;)245 532 y(TYPE)289 580 y(Foo)g(=)g(OBJECT)463
627 y(name)86 b(:)22 b(Qid;)463 675 y(visited)195 b(:=)21
b(FALSE;)463 723 y(brandsOK)173 b(:=)21 b(TRUE;)419 771
y(END;)245 847 y(REVEAL)f(T)i(=)g(Foo)f(BRANDED)f(OBJECT)h(END;)245
924 y(PROCEDURE)f(ToText)g(\(t:)i(T;)f(byName:)f(BOOLEAN)h(:=)g
(TRUE\):)g(Text.T)f(=)289 972 y(VAR)h(text:)f(Text.T;)289
1019 y(BEGIN)332 1067 y(IF)h(t)h(=)g(NIL)f(THEN)g(RETURN)f("")i(END;)
332 1115 y(IF)f(t.name)g(#)h(NIL)f(AND)g(byName)g(THEN)f(RETURN)h
(QidToText\(t.name\);)d(END;)332 1163 y(TYPECASE)i(t)i(OF)332
1210 y(|)g(Char)f(=>)g(RETURN)g("CHAR")332 1258 y(|)h(UserDefined)d
(\(ud\))i(=>)419 1306 y(IF)h(NUMBER\(ud.elts^\))c(=)k(0)f(THEN)463
1354 y(text)g(:=)g("";)419 1401 y(ELSE)463 1449 y(text)g(:=)g
(Atom.ToText\(ud.elt)o(s[0]\))o(;)463 1497 y(FOR)g(i)h(:=)f(1)h(TO)f
(LAST\(ud.elts^\))e(DO)506 1544 y(text)i(:=)h(text)f(&)g(",)h(")f(&)h
(Atom.ToText\(ud.el)o(ts[i])o(\);)463 1592 y(END;)419
1640 y(END;)419 1688 y(RETURN)f("{")g(&)h(text)f(&)g("}";)332
1735 y(|)h(Enumeration)d(\(enum\))i(=>)419 1783 y(IF)h(enum)f(=)g
(boolean)g(THEN)g(RETURN)f("BOOLEAN";)g(END;)419 1831
y(<*ASSERT)g(FALSE*>)332 1879 y(|)i(Subrange)e(\(sub\))h(=>)419
1926 y(VAR)463 1974 y(min,)g(max:)g(INTEGER;)463 2022
y(ud)130 b(:)22 b(UserDefined;)419 2070 y(BEGIN)463 2117
y(IF)f(sub)g(=)h(integer)e(THEN)h(RETURN)g("INTEGER")f(END;)463
2165 y(min)h(:=)g(NARROW\(sub.min,)e(Value.Ordinal\).ord)o(;)463
2213 y(max)i(:=)g(NARROW\(sub.max,)e(Value.Ordinal\).ord)o(;)463
2261 y(IF)i(sub.base)f(=)i(integer)e(THEN)506 2308 y(RETURN)h("[")g(&)h
(Fmt.Int\(min\))d(&)j("..")f(&)g(Fmt.Int\(max\))f(&)h("]")463
2356 y(END;)463 2404 y(IF)g(sub.base)f(=)i(char)f(THEN)506
2452 y(RETURN)g("[VAL\(")f(&)i(Fmt.Int\(min\))d(&)j(",)f(CHAR\))g(..)g
(VAL\(")703 2499 y(&)g(Fmt.Int\(max\))e(&)j(",)f(CHAR\)]")p
eop
%%Page: 66 66
66 65 bop 58 141 a Fn(66)872 b Fi(CHAPTER)11 b(3.)24
b(IMPLEMENT)m(A)-5 b(TION)12 b(MODULES)376 258 y Fe(END;)376
305 y(ud)21 b(:=)g(NARROW\(sub.base,)e(UserDefined\);)376
353 y(RETURN)419 401 y("[")i(&)h(ToText\(sub.base\))c(&)k(".")f(&)h
(Atom.ToText\(ud.el)o(ts[m)o(in]\))c(&)k("..")463 449
y(&)f(ToText\(sub.base\))e(&)i(".")h(&)f(Atom.ToText\(ud.elts)o([max)o
(]\))e(&)i("]";)332 496 y(END;)245 544 y(|)h(Real)e(=>)i(RETURN)e
("REAL";)245 592 y(|)i(LongReal)e(=>)h(RETURN)g("LONGREAL";)245
640 y(|)h(Extended)e(=>)h(RETURN)g("EXTENDED";)245 687
y(|)h(Reference)d(\(ref\))i(=>)332 735 y(TYPECASE)f(ref)h(OF)332
783 y(|)h(Opaque)e(\(o\))h(=>)419 831 y(\(*)h(Type)f(can)g(only)g(be)g
(displayed)f(by)h(name)g(*\))419 878 y(RETURN)g("***Error***)e(Opaque)i
(type)g(only)g(printed)f(by)h(name:)g(")615 926 y(&)h("supertype)e(")h
(&)h(ToText\(o.revealed)o(Super)o(Type)o(\);)376 974
y(\(*)f(RETURN)g(Atom.ToText\(t.n)o(ame.i)o(ntf\))d(&)k(".")f(&)441
1021 y(Atom.ToText\(t.name)o(.ite)o(m\)*\))332 1069 y(|)h(Object,)e
(Ref)h(=>)419 1117 y(IF)h(ref.brand)e(#)h(NIL)g(THEN)463
1165 y(text)g(:=)g("BRANDED)f(\\"")h(&)h(Atom.ToText\(ref.br)o(and\))c
(&)k("\\")f(";)419 1212 y(ELSE)463 1260 y(text)g(:=)g("")419
1308 y(END;)419 1356 y(TYPECASE)f(ref)i(OF)419 1403 y(|)g(Object)e
(\(o\))i(=>)506 1451 y(RETURN)f(ToText\(o.super\))e(&)i(")h(")f(&)h
(text)f(&)h("OBJECT\\n")703 1499 y(&)f(FieldsToText\(o.fie)o(lds\))d(&)
k("\\nMETHODS\\n")703 1547 y(&)f(MethodsToText\(o.me)o(thods)o(\))e(&)j
("\\nEND";)419 1594 y(|)g(Ref)f(\(r\))g(=>)506 1642 y(IF)h(NOT)f
(r.traced)f(THEN)h(text)g(:=)g("UNTRACED)f(")i(&)g(text)e(END;)506
1690 y(RETURN)h(text)g(&)h("REF)e(")i(&)g(ToText\(r.target,)c(TRUE\);)
419 1738 y(ELSE)463 1785 y(<*ASSERT)i(FALSE*>)419 1833
y(END;)332 1881 y(ELSE)376 1928 y(<*ASSERT)g(FALSE*>)332
1976 y(END;)245 2024 y(|)i(Array)e(\(arr\))h(=>)332 2072
y(IF)g(arr.index)f(=)i(NIL)f(THEN)376 2119 y(text)g(:=)g("";)332
2167 y(ELSE)376 2215 y(text)g(:=)g(ToText\(arr.index\))o(;)332
2263 y(END;)332 2310 y(RETURN)g("ARRAY)f(")i(&)f(text)g(&)h(")f(OF)h(")
f(&)h(ToText\(arr.element)o(\);)245 2358 y(|)g(Packed)e(\(p\))h(=>)332
2406 y(RETURN)g("BITS)f(")i(&)g(Fmt.Int\(p.size\))c(&)k("FORF)f(")g(&)h
(ToText\(p.base\);)245 2454 y(|)g(Record)e(\(rec\))h(=>)g(RETURN)g
("RECORD)f(")i(&)f(FieldsToText\(rec.fi)o(elds)o(\))e(&)j(")f(END";)p
eop
%%Page: 67 67
67 66 bop 145 141 a Fi(3.9.)25 b(MODULE)11 b(TYPE)1324
b Fn(67)332 258 y Fe(|)22 b(Set)f(\(set\))g(=>)g(RETURN)g("SET)g(OF)g
(")g(&)h(ToText\(set.range\);)332 305 y(|)g(Procedure)e(\(proc\))g(=>)i
(RETURN)e("PROCEDURE")g(&)h(SigToText\(proc.sig)o(\);)332
353 y(ELSE)376 401 y(<*ASSERT)f(FALSE*>)332 449 y(END;)289
496 y(END)h(ToText;)245 575 y(PROCEDURE)f(QidToText)g(\(qid:)h(Qid\):)f
(TEXT)h(=)289 623 y(BEGIN)332 671 y(IF)g(qid.intf)g(=)g(nullAtm)g(THEN)
376 718 y(RETURN)f(Atom.ToText\(qid.ite)o(m\))332 766
y(ELSE)376 814 y(RETURN)g(Atom.ToText\(qid.int)o(f\))f(&)i(".")g(&)h
(Atom.ToText\(qid.it)o(em\))332 862 y(END;)289 909 y(END)f(QidToText;)
245 988 y(PROCEDURE)f(SigToText)g(\(sig:)h(Signature\):)e(TEXT)i(=)289
1036 y(VAR)332 1084 y(result:)f(TEXT;)332 1131 y(raises:)g(TEXT;)289
1179 y(BEGIN)332 1227 y(IF)h(sig.result)f(#)i(NIL)f(THEN)376
1275 y(result)f(:=)i(":)f(")h(&)f(ToText\(sig.result\))o(;)332
1322 y(ELSE)376 1370 y(result)f(:=)i("";)332 1418 y(END;)332
1466 y(IF)f(sig.raises)f(=)i(NIL)f(THEN)376 1513 y(raises)f(:=)i(")f
(RAISES)g(ANY")332 1561 y(ELSIF)g(NUMBER\(sig.raises)o(^\))e(=)i(0)h
(THEN)376 1609 y(raises)e(:=)i("";)332 1657 y(ELSE)376
1704 y(raises)e(:=)i(")f(RAISES)g({")g(&)h(QidToText\(sig.ra)o(ises[)o
(0].qi)o(d\);)376 1752 y(FOR)f(i)g(:=)h(1)f(TO)h(LAST\(sig.raises^)o
(\))d(DO)419 1800 y(raises)i(:=)g(raises)g(&)g(",)h(")f(&)h
(QidToText\(sig.rai)o(ses[i)o(].qid)o(\);)376 1848 y(END;)376
1895 y(raises)e(:=)i(raises)e(&)i("}";)332 1943 y(END;)332
1991 y(RETURN)f("\(")g(&)g(FormalsToText\(sig.f)o(ormal)o(s\))e(&)i
("\)")h(&)f(result)g(&)g(raises;)289 2038 y(END)g(SigToText;)245
2117 y(PROCEDURE)f(FieldsToText)f(\(f:)i(REF)h(ARRAY)e(OF)i(Field\):)e
(TEXT)h(=)289 2165 y(VAR)332 2213 y(notFirst)f(:=)i(FALSE;)332
2261 y(text)108 b(:=)22 b("";)289 2308 y(BEGIN)332 2356
y(FOR)f(i)h(:=)f(0)h(TO)f(LAST\(f^\))f(DO)376 2404 y(IF)h(notFirst)f
(THEN)h(text)g(:=)h(text)e(&)i(";)f(";)h(END;)376 2452
y(notFirst)e(:=)h(TRUE;)376 2499 y(text)g(:=)g(text)g(&)h
(Atom.ToText\(f[i)o(].nam)o(e\))d(&)i(":)h(")f(&)h(ToText\(f[i].type\))
o(;)p eop
%%Page: 68 68
68 67 bop 58 141 a Fn(68)872 b Fi(CHAPTER)11 b(3.)24
b(IMPLEMENT)m(A)-5 b(TION)12 b(MODULES)289 258 y Fe(IF)21
b(f[i].default)e(#)j(NIL)f(THEN)332 305 y(text)g(:=)g(text)g(&)h(":=)f
(")h(&)f(ValueProc.ToText\(f[)o(i].de)o(fault)o(,)e(f[i].type\);)289
353 y(END;)245 401 y(END;)245 449 y(RETURN)h(text;)201
496 y(END)i(FieldsToText;)158 567 y(PROCEDURE)e(MethodsToText)f(\(m:)i
(REF)g(ARRAY)g(OF)g(Method\):)f(TEXT)h(=)201 615 y(VAR)245
662 y(notFirst)f(:=)h(FALSE;)245 710 y(text)108 b(:=)21
b("";)201 758 y(BEGIN)245 806 y(FOR)g(i)h(:=)f(0)h(TO)f(LAST\(m^\))f
(DO)289 853 y(IF)h(notFirst)f(THEN)h(text)g(:=)g(text)g(&)h(";\\n";)e
(END;)289 901 y(notFirst)g(:=)h(TRUE;)289 949 y(text)f(:=)i(text)f(&)g
(Atom.ToText\(m[i].na)o(me\))e(&)i(SigToText\(m[i].sig)o(\);)289
997 y(IF)g(m[i].default)e(#)j(NIL)f(THEN)332 1044 y(text)g(:=)g(text)g
(&)h(":=)f(";)332 1092 y(TYPECASE)f(m[i].default)g(OF)376
1140 y(MethodDefault1)f(\(md1\))h(=>)i(text)f(:=)g(text)g(&)h
(QidToText\(md1.q)o(id\);)332 1187 y(|)g(MethodDefault2)d(\(md2\))h(=>)
419 1235 y(text)h(:=)463 1283 y(text)g(&)g(ToText\(md2.obType\))d(&)k
(".")f(&)h(Atom.ToText\(md2.)o(metho)o(d\);)332 1331
y(ELSE)376 1378 y(<*ASSERT)e(FALSE*>)332 1426 y(END;)289
1474 y(END;)245 1522 y(END;)245 1569 y(RETURN)g(text;)201
1617 y(END)i(MethodsToText;)158 1688 y(PROCEDURE)e(FormalsToText)f
(\(f:)i(REF)g(ARRAY)g(OF)g(Formal\):)f(TEXT)h(=)201 1735
y(VAR)245 1783 y(notFirst)151 b(:=)21 b(FALSE;)245 1831
y(text)239 b(:=)21 b("";)245 1879 y(modeName)151 b(:=)21
b(ARRAY)g(Mode)g(OF)g(TEXT{"",)f("VAR)h(",)h("READONLY)e("};)245
1926 y(outPrag)g(:)i(TEXT;)201 1974 y(BEGIN)245 2022
y(FOR)f(i)h(:=)f(0)h(TO)f(LAST\(f^\))f(DO)289 2070 y(IF)h(notFirst)f
(THEN)h(text)g(:=)g(text)g(&)h(";)f(";)h(END;)289 2117
y(notFirst)e(:=)h(TRUE;)289 2165 y(IF)g(f[i].outOnly)e(THEN)i(outPrag)f
(:=)i("<*OUT*>)e(")i(ELSE)f(outPrag)f(:=)h("")h(END;)289
2213 y(text)e(:=)i(text)f(&)g(modeName[f[i].mode])d(&)k(")f(")h(&)g
(outPrag)506 2261 y(&)g(Atom.ToText\(f[i].)o(name\))c(&)k(":)f(")h(&)f
(ToText\(f[i].type\);)289 2308 y(IF)g(f[i].default)e(#)j(NIL)f(THEN)332
2356 y(text)g(:=)g(text)g(&)h(":=)f(")h(&)f(ValueProc.ToText\(f[)o
(i].de)o(fault)o(,)e(f[i].type\);)289 2404 y(END;)245
2452 y(END;)245 2499 y(RETURN)h(text;)p eop
%%Page: 69 69
69 68 bop 145 141 a Fi(3.9.)25 b(MODULE)11 b(TYPE)1324
b Fn(69)289 258 y Fe(END)21 b(FormalsToText;)245 330
y(PROCEDURE)f(MayBeRefAny)f(\(t:)j(T\):)f(BOOLEAN)f(=)289
378 y(BEGIN)332 425 y(IF)h(t)h(=)g(refany)e(THEN)h(RETURN)g(TRUE;)f
(END;)332 473 y(TYPECASE)g(t)i(OF)332 521 y(|)g(Ref,)f(Object)f(=>)i
(RETURN)e(FALSE;)332 569 y(|)i(Opaque)e(\(o\))h(=>)h(RETURN)e
(MayBeRefAny\(o.revea)o(ledSu)o(perTy)o(pe\);)332 616
y(ELSE)376 664 y(RETURN)g(FALSE)326 b(\(*)21 b(e.g.)43
b(type)21 b(TEXT)g(*\))332 712 y(END;)289 759 y(END)g(MayBeRefAny;)245
832 y(PROCEDURE)f(NamedType)g(\(t:)h(T\):)g(BOOLEAN)f(=)289
879 y(BEGIN)332 927 y(RETURN)h(t.name)f(#)i(NIL;)289
977 y(END)f(NamedType;)208 1051 y Fn(PROCEDURE)10 b(Size)h(\(t:)h(T\):)
e(INTEGER)h(=)g(BEGIN)f(END)h(Size;)208 1101 y(PROCEDURE)f(MinSize)g
(\(t:)i(T\):)f(INTEGER)g(=)f(BEGIN)h(END)f(MinSize;)208
1151 y(PROCEDURE)g(Alignment)f(\(t:)j(T\):)f(INTEGER)f(=)h(BEGIN)f(END)
h(Alignment;)208 1201 y(PROCEDURE)f(Bounds)f(\(t:)k(T\):)d(Interval.T)g
(=)h(BEGIN)f(END)h(Bounds;)208 1250 y(PROCEDURE)f(Base)h(\(t:)i(T\):)d
(T)g(=)h(BEGIN)f(END)h(Base;)208 1300 y(PROCEDURE)f(IsT)o(raced)h(\(t:)
i(T\):)d(BOOLEAN)g(=)h(BEGIN)f(END)h(IsT)o(raced;)208
1350 y(PROCEDURE)f(IsEmpty)g(\(t:)i(T\):)f(BOOLEAN)f(=)h(BEGIN)f(END)h
(IsEmpty;)245 1447 y Fe(VAR)21 b(nullAtm:)f(Atom.T;)245
1519 y(BEGIN)289 1567 y(nullAtm)g(:=)h(Atom.FromText\(""\);)289
1614 y(integer)f(:=)h(NEW\(Subrange,)e(name)i(:=)h(NEW\(Qid,)e(intf)h
(:=)g(nullAtm,)1095 1662 y(item)g(:=)g(Atom.FromText\("INT)o(EGER")o
(\)\),)615 1710 y(min)h(:=)f(NEW\(Value.Ordinal)o(,)e(ord)i(:=)h
(FIRST\(INTEGER\)\))o(,)615 1758 y(max)g(:=)f(NEW\(Value.Ordinal)o(,)e
(ord)i(:=)h(LAST\(INTEGER\)\)\))o(;)289 1805 y(integer.base)d(:=)i
(integer;)289 1877 y(cardinal)f(:=)h(NEW\(Subrange,)e(name)i(:=)g
(NEW\(Qid,)g(intf)g(:=)g(nullAtm,)1117 1925 y(item)g(:=)g
(Atom.FromText\("CA)o(RDINA)o(L"\)\),)637 1973 y(base)g(:=)h(integer,)e
(min)h(:=)g(NEW\(Value.Ordinal,)d(ord)j(:=)h(0\),)637
2021 y(max)f(:=)h(integer.max\);)289 2093 y(boolean)e(:=)h(NEW\()572
2141 y(UserDefined,)e(name)i(:=)g(NEW\(Qid,)g(intf)g(:=)g(nullAtm,)1117
2188 y(item)g(:=)g(Atom.FromText\("BO)o(OLEAN)o("\)\)\);)289
2236 y(boolean.elts)e(:=)i(NEW\(REF)g(ARRAY)f(OF)i(Atom.T,)e(2\);)289
2284 y(boolean.elts[0])e(:=)k(Atom.FromText\(")o(FALSE)o("\);)289
2332 y(boolean.elts[1])c(:=)k(Atom.FromText\(")o(TRUE")o(\);)289
2404 y(char)e(:=)i(NEW\(Char,)e(name)h(:=)g(NEW\(Qid,)f(intf)h(:=)h
(nullAtm,)942 2452 y(item)f(:=)h(Atom.FromText\("C)o(HAR"\))o(\)\);)289
2499 y(real)e(:=)i(NEW\(Real,)e(name)h(:=)g(NEW\(Qid,)f(intf)h(:=)h
(nullAtm,)p eop
%%Page: 70 70
70 69 bop 58 141 a Fn(70)872 b Fi(CHAPTER)11 b(3.)24
b(IMPLEMENT)m(A)-5 b(TION)12 b(MODULES)855 258 y Fe(item)21
b(:=)g(Atom.FromText\("REAL")o(\)\)\);)201 305 y(longreal)f(:=)245
353 y(NEW\(LongReal,)f(name)i(:=)g(NEW\(Qid,)f(intf)h(:=)h(nullAtm,)812
401 y(item)e(:=)i(Atom.FromText\("LO)o(NGREA)o(L"\)\))o(\);)201
449 y(extended)e(:=)245 496 y(NEW\(Extended,)f(name)i(:=)g(NEW\(Qid,)f
(intf)h(:=)h(nullAtm,)812 544 y(item)e(:=)i(Atom.FromText\("EX)o(TENDE)
o(D"\)\))o(\);)201 592 y(refany)f(:=)g(NEW\(Reference,)e(name)i(:=)g
(NEW\(Qid,)g(intf)g(:=)g(nullAtm,)1008 640 y(item)g(:=)g
(Atom.FromText\("RE)o(FANY")o(\)\),)506 687 y(traced)g(:=)g(TRUE\);)201
735 y(address)g(:=)g(NEW\(Reference,)e(name)i(:=)g(NEW\(Qid,)f(intf)h
(:=)h(nullAtm,)1029 783 y(item)f(:=)h(Atom.FromText\("A)o(DDRES)o
(S"\)\),)528 831 y(traced)f(:=)g(FALSE\);)201 878 y(root)g(:=)h
(NEW\(Object,)d(name)i(:=)h(NEW\(Qid,)e(intf)h(:=)g(nullAtm,)899
926 y(item)g(:=)g(Atom.FromText\("ROO)o(T"\)\))o(,)463
974 y(traced)f(:=)i(TRUE,)f(fields)f(:=)h(NEW\(REF)g(ARRAY)g(OF)g
(Field,)f(0\),)463 1021 y(methods)g(:=)i(NEW\(REF)e(ARRAY)h(OF)g
(Method,)f(0\)\);)201 1069 y(untracedRoot)g(:=)245 1117
y(NEW\(Object,)f(name)i(:=)h(NEW\(Qid,)e(intf)h(:=)g(nullAtm,)768
1165 y(item)g(:=)g(Atom.FromText\("UNTR)o(ACED)d(ROOT"\)\),)332
1212 y(traced)j(:=)g(FALSE,)g(fields)f(:=)h(NEW\(REF)g(ARRAY)g(OF)g
(Field,)g(0\),)332 1260 y(methods)f(:=)i(NEW\(REF)e(ARRAY)h(OF)g
(Method,)g(0\)\);)201 1308 y(null)g(:=)h(NEW\(Reference,)d(name)i(:=)g
(NEW\(Qid,)f(intf)h(:=)g(nullAtm,)964 1356 y(item)g(:=)g
(Atom.FromText\("NULL)o("\)\)\);)201 1403 y(text)g(:=)h(NEW\(Opaque,)d
(name)i(:=)h(NEW\(Qid,)e(intf)h(:=)g(nullAtm,)899 1451
y(item)g(:=)g(Atom.FromText\("TEX)o(T"\)\))o(,)463 1499
y(revealedSuperType)d(:=)j(refany\);)201 1547 y(mutex)g(:=)g
(NEW\(Opaque,)f(name)h(:=)g(NEW\(Qid,)f(intf)h(:=)h(nullAtm,)920
1594 y(item)f(:=)h(Atom.FromText\("MU)o(TEX")o(\)\),)485
1642 y(revealedSuperTyp)o(e)d(:=)i(root\);)158 1692 y(END)g(Type.)58
1854 y Fg(3.10)59 b(Module)15 b(V)-5 b(alue)58 1970 y
Fn(File:)13 b(V)-5 b(alue.m3)58 2043 y(Last)11 b(Modi\256ed)f(On)g(Mon)
f(Feb)i(28)f(16:51:07)e(PST)j(1994)e(by)h(wobber)58 2116
y(Modi\256ed)g(On)g(Mon)g(May)g(17)g(13:39:12)e(PDT)j(1993)e(by)h
(mjordan)58 2189 y(Modi\256ed)g(On)g(T)o(ue)g(Nov)g(10)g(13:48:19)e
(PST)j(1992)e(by)h(owicki)58 2261 y(Modi\256ed)g(On)g(Fri)g(Feb)g(2)g
(10:35:09)e(PST)j(1990)f(by)g(gnelson)58 2334 y(Modi\256ed)g(On)g(W)m
(ed)g(Dec)h(20)f(18:07:50)e(1989)i(by)g(kalsow)158 2428
y Fe(MODULE)20 b(Value)h(EXPORTS)f(Value,)h(ValueProc;)158
2499 y(IMPORT)f(Atom,)h(Fmt,)g(Text,)g(Type;)p eop
%%Page: 71 71
71 70 bop 145 141 a Fi(3.10.)25 b(MODULE)10 b(V)-5 b(ALUE)1272
b Fn(71)245 258 y Fe(REVEAL)20 b(T)i(=)43 b(ROOT)21 b(BRANDED)g(OBJECT)
f(END;)245 328 y(EXCEPTION)g(FatalError;)85 b(<*FATAL)20
b(FatalError*>)245 399 y(PROCEDURE)g(ToText\(v:)g(T;)h(type:)g
(Type.T\):)f(TEXT)h(=)289 447 y(BEGIN)332 494 y(TYPECASE)f(v)i(OF)376
542 y(Ordinal)e(\(ordinal\))g(=>)419 590 y(IF)i(\(type)e(=)i
(Type.integer\))d(OR)i(\(type)g(=)h(Type.cardinal\))d(THEN)463
637 y(RETURN)h(Fmt.Int\(ordinal.ord)o(\);)419 685 y(ELSIF)h(type)g(=)h
(Type.boolean)d(THEN)463 733 y(RETURN)h(Fmt.Bool\(VAL\(ordina)o(l.ord)o
(,)f(BOOLEAN\)\);)419 781 y(ELSE)i(TYPECASE)f(type)h(OF)506
828 y(Type.Char)f(=>)44 b(RETURN)20 b("VAL\(")h(&)g
(Fmt.Int\(ordinal.ord)o(\))e(&)i(",)h(CHAR\)";)463 876
y(|)f(Type.UserDefined)e(\(ud\))i(=>)528 924 y(RETURN)g
(Atom.ToText\(ud.e)o(lts[o)o(rdina)o(l.ord)o(]\);)463
972 y(|)g(Type.Subrange)f(\(sub\))g(=>)528 1019 y(RETURN)h
(ToText\(NEW\(Ordin)o(al,)681 1067 y(ord)g(:=)g(ordinal.ord)f(+)43
b(NARROW\(sub.min,)19 b(Ordinal\).ord\),)833 1115 y(sub.base\);)463
1163 y(ELSE)i(RAISE)g(FatalError;)463 1210 y(END;)419
1258 y(END;)332 1306 y(|)h(Float)e(\(f\))i(=>)419 1354
y(RETURN)f(Fmt.Real\(f.val,)e(style)h(:=)i(Fmt.Style.Auto,)c(literal)j
(:=)g(TRUE\);)332 1401 y(|)h(LongFloat)e(\(lf\))h(=>)419
1449 y(RETURN)g(Fmt.LongReal\(lf.v)o(al,)d(style)j(:=)h
(Fmt.Style.Auto,)c(literal)j(:=)g(TRUE\);)332 1497 y(|)h(Extended)e
(\(e\))h(=>)419 1544 y(VAR)g(lr:=)g(FLOAT\(e.val,)f(LONGREAL\);)506
1592 y(txt)i(:=)f(Fmt.LongReal\(lr,)d(style)j(:=)h(Fmt.Style.Auto,)c
(literal)j(:=)g(TRUE\);)506 1640 y(pos)h(:=)f(Text.FindChar\(txt)o(,)e
('D'\);)419 1688 y(BEGIN)463 1735 y(RETURN)h(Text.Sub\(txt,)g(0,)h
(pos\))g(&)g("X")h(&)615 1783 y(Text.Sub\(txt,)e(pos+1,)g
(Text.Length\(txt\)\);)419 1831 y(END;)332 1879 y(|)i(Array)e(\(arr\))h
(=>)419 1926 y(VAR)g(eltList:)g(TEXT;)506 1974 y(eltType:)g(Type.T)f
(:=)i(NARROW\(type,)d(Type.Array\).eleme)o(nt;)419 2022
y(BEGIN)463 2070 y(IF)i(NUMBER\(arr.elements)o(^\))e(=)i(0)h(THEN)506
2117 y(eltList)f(:=)g("";)463 2165 y(ELSE)506 2213 y(eltList)g(:=)g
(ToText\(arr.element)o(s[0],)d(eltType\);)506 2261 y(FOR)k(i)f(:=)h(1)f
(TO)h(LAST\(arr.elemen)o(ts^\))c(DO)550 2308 y(eltList)i(:=)i(eltList)e
(&)i(",)f(")h(&)615 2356 y(ToText\(arr.elements)o([i],)c(eltType\);)506
2404 y(END;)463 2452 y(END;)463 2499 y(RETURN)i(Type.ToText\(type\))f
(&)i("{")g(&)h(eltList)e(&)i("}";)p eop
%%Page: 72 72
72 71 bop 58 141 a Fn(72)872 b Fi(CHAPTER)11 b(3.)24
b(IMPLEMENT)m(A)-5 b(TION)12 b(MODULES)332 258 y Fe(END;)245
305 y(|)22 b(Set)f(\(set\))f(=>)332 353 y(VAR)h(eltList:)f(TEXT)h(:=)h
("";)419 401 y(baseType:)e(Type.T)h(:=)g(NARROW\(type,)e
(Type.Set\).range;)419 449 y(notFirst)h(:=)i(FALSE;)332
496 y(BEGIN)376 544 y(FOR)f(i)g(:=)h(0)f(TO)h(LAST\(set.element)o(s^\))
d(DO)419 592 y(IF)j(set.elements[i])c(THEN)463 640 y(IF)j(notFirst)f
(THEN)h(eltList)g(:=)g(eltList)f(&)i(",)f(";)h(END;)463
687 y(notFirst)e(:=)h(TRUE;)463 735 y(eltList)f(:=)i(eltList)e(&)528
783 y(ToText\(NEW\(Ordinal)o(,)f(ord:=i\),)h(baseType\);)419
831 y(END;)376 878 y(END;)376 926 y(RETURN)g(Type.ToText\(type\))e(&)k
("{")f(&)h(eltList)e(&)i("}";)332 974 y(END;)245 1021
y(|)g(Record)e(\(rec\))h(=>)332 1069 y(VAR)g(fieldList:)f(TEXT)h(:=)g
("";)419 1117 y(recType)g(:=)g(NARROW\(type,)e(Type.Record\);)419
1165 y(notFirst)h(:=)i(FALSE;)332 1212 y(BEGIN)376 1260
y(FOR)f(i)g(:=)h(0)f(TO)h(LAST\(rec.element)o(s^\))d(DO)419
1308 y(IF)j(notFirst)e(THEN)h(fieldList)f(:=)h(fieldList)f(&)i(",)f(";)
g(END;)419 1356 y(notFirst)f(:=)i(TRUE;)419 1403 y(fieldList)e(:=)i
(fieldList)d(&)485 1451 y(ToText\(rec.eleme)o(nts[)o(i],)g
(recType.fields[i)o(].typ)o(e\);)376 1499 y(END;)376
1547 y(RETURN)h(Type.ToText\(type\))e(&)k("{")f(&)h(fieldList)e(&)h
("}";)332 1594 y(END;)245 1642 y(|)h(Txt)f(\(text\))f(=>)i(RETURN)e
("\\"")h(&)h(text.val)e(&)h("\\"";)245 1690 y(|)h(Null)42
b(=>)22 b(RETURN)e("NIL";)245 1738 y(ELSE)h(RAISE)g(FatalError;)245
1785 y(END;)201 1833 y(END)h(ToText;)158 1905 y(BEGIN)158
1979 y(END)f(Value.)58 2143 y Fg(3.1)m(1)59 b(Module)15
b(FRefRefTbl)58 2259 y Fn(Last)c(modi\256ed)f(on)g(Mon)g(May)g(17)g
(22:34:00)e(PDT)j(1993)e(by)h(mjordan)158 2355 y Fe(UNSAFE)20
b(MODULE)h(FRefRefTbl;)158 2427 y(IMPORT)f(RefRefTbl,)g(Refany,)g
(Word;)158 2499 y(REVEAL)p eop
%%Page: 73 73
73 72 bop 145 141 a Fi(3.12.)25 b(MODULE)10 b(ST)m(ABLEGENERROR)1030
b Fn(73)289 258 y Fe(Default)20 b(=)h(RefRefTbl.Default)e(BRANDED)h
(OBJECT)289 305 y(OVERRIDES)332 353 y(keyEqual)g(:=)i(KeyEqual;)332
401 y(keyHash)e(:=)i(KeyHash;)289 449 y(END;)245 518
y(PROCEDURE)e(KeyEqual\(<*UNUSED)o(*>)f(t:)i(Default;)f(READONLY)g(k1,)
i(k2:)f(Refany.T\):)e(BOOLEAN=)289 565 y(BEGIN)332 613
y(RETURN)i(k1)g(=)h(k2;)289 661 y(END)f(KeyEqual;)245
730 y(PROCEDURE)f(KeyHash\(<*UNUSED*)o(>)f(t:)i(Default;)f(READONLY)h
(k:)g(Refany.T\):)f(Word.T=)289 777 y(BEGIN)332 825 y(RETURN)h
(LOOPHOLE\(k,)e(Word.T\);)289 873 y(END)i(KeyHash;)245
942 y(BEGIN)245 992 y(END)g(FRefRefTbl.)145 1151 y Fg(3.12)60
b(Module)15 b(StablegenErr)o(or)245 1263 y Fe(MODULE)20
b(StablegenError;)245 1332 y(IMPORT)g(Wr,)i(Thread,)e(Stdio,)h
(Process;)245 1401 y(<*FATAL)f(Thread.Alerted,)f(Wr.Failure*>)245
1470 y(PROCEDURE)h(Warning)g(\(msg:)h(TEXT\))g(=)289
1517 y(BEGIN)332 1565 y(Wr.PutText\(Stdio.s)o(tderr)o(,)e("stablegen)h
(\(warning\):)f("\);)332 1613 y(Wr.PutText\(Stdio.s)o(tderr)o(,)g
(msg&"\\n"\);)332 1661 y(Wr.Flush\(Stdio.std)o(err\);)289
1708 y(END)i(Warning;)245 1777 y(PROCEDURE)f(Failure)g(\(msg:)h(TEXT\))
g(=)289 1825 y(BEGIN)332 1873 y(Wr.PutText\(Stdio.s)o(tderr)o(,)e
("stablegen)h(error:)g("\);)332 1920 y(Wr.PutText\(Stdio.s)o(tderr)o(,)
f(msg&"\\n"\);)332 1968 y(Wr.Flush\(Stdio.std)o(err\);)289
2016 y(END)i(Failure;)245 2085 y(PROCEDURE)f(Fatal)h(\(msg:)f(TEXT\))h
(=)289 2133 y(BEGIN)332 2180 y(Wr.PutText\(Stdio.s)o(tderr)o(,)e
("stablegen)h(\(warning\):)f("\);)332 2228 y(Wr.PutText\(Stdio.s)o
(tderr)o(,)g(msg&"\\n"\);)332 2276 y(Wr.PutText\(Stdio.s)o(tderr)o(,)g
("stablegen:)g(aborted\\n)h("\);)332 2324 y(Process.Exit\(1\);)289
2371 y(END)h(Fatal;)245 2419 y(BEGIN)245 2469 y(END)g(StablegenError.)p
eop
%%Page: 74 74
74 73 bop 58 141 a Fn(74)872 b Fi(CHAPTER)11 b(3.)24
b(IMPLEMENT)m(A)-5 b(TION)12 b(MODULES)58 258 y Fg(3.13)59
b(Copyright)58 350 y Fn(Copyright)8 b(1995)h(Digital)g(Equipment)h
(Corporation.)58 400 y(Distributed)e(only)h(by)h(permission.)58
491 y Fm(Last)25 b(modified)f(on)h(Thu)f(Jan)h(19)g(14:31:14)f(PST)g
(1995)h(by)g(kalsow)183 541 y(modified)f(on)h(Thu)f(Jan)h(12)g
(12:24:27)f(PST)g(1995)h(by)g(chaiken)183 591 y(modified)f(on)h(Tue)f
(Sep)h(27)g(11:52:22)f(PDT)g(1994)h(by)g(weich)p eop
%%Trailer
end
userdict /end-hook known{end-hook}if
%%EOF
