<HTML>
<HEAD>
<TITLE>SRC Modula-3: trestle_by_example/src/draw/Draw.m3</TITLE>
</HEAD>
<BODY>
<A NAME="0TOP0">
<H2>trestle_by_example/src/draw/Draw.m3</H2></A><HR>
<inModule>
<PRE>MODULE <module>Draw</module> EXPORTS <A HREF="../../../main/src/Main.i3.html"><implements>Main</A></implements>;
IMPORT <A HREF="../../../ui/src/vbt/Trestle.i3.html">Trestle</A>, <A HREF="../../../ui/src/vbt/VBT.i3.html">VBT</A>, <A HREF="../../../ui/src/split/TextVBT.i3.html">TextVBT</A>, <A HREF="../../../ui/src/split/HVSplit.i3.html">HVSplit</A>, <A HREF="../../../ui/src/split/RigidVBT.i3.html">RigidVBT</A>, <A HREF="../../../ui/src/split/BorderedVBT.i3.html">BorderedVBT</A>;
IMPORT <A HREF="../../../geometry/src/Region.i3.html">Region</A>, <A HREF="../../../geometry/src/Axis.i3.html">Axis</A>, <A HREF="../../../ui/src/vbt/PaintOp.i3.html">PaintOp</A>, <A HREF="../../../geometry/src/Path.i3.html">Path</A>, <A HREF="../../../geometry/src/Point.i3.html">Point</A>, <A HREF="../../../geometry/src/Rect.i3.html">Rect</A>;
FROM <A HREF="../common/Colors.i3.html">Colors</A> IMPORT red, white, blue;

TYPE
  TexasVBT = VBT.Leaf OBJECT
               path: Path.T := NIL;
             METHODS
               init (): TexasVBT := Init
             OVERRIDES
               repaint := Repaint;
             END;

PROCEDURE <A NAME="Init"><procedure>Init</procedure></A> (v: TexasVBT): TexasVBT =
  BEGIN
    v.path := NEW(Path.T);
    Path.Reset(v.path);
    Path.MoveTo(v.path, Point.T{0, 0});
    Path.LineTo(v.path, Point.T{-18, -18});
    Path.LineTo(v.path, Point.T{-22, -14});
    Path.LineTo(v.path, Point.T{-40, -32});
    Path.LineTo(v.path, Point.T{-24, -32});
    Path.LineTo(v.path, Point.T{-24, -52});
    Path.LineTo(v.path, Point.T{2, -52});
    Path.LineTo(v.path, Point.T{2, -42});
    Path.LineTo(v.path, Point.T{12, -42});
    Path.CurveTo(v.path, Point.T{12, -12}, Point.T{0, -30}, Point.T{0, 0});
    RETURN (v);
  END Init;

PROCEDURE <A NAME="Repaint"><procedure>Repaint</procedure></A> (v: TexasVBT; READONLY rgn: Region.T) =
  PROCEDURE Pair (READONLY row, col: INTEGER) =
    VAR
      dom := VBT.Domain(v);
      mid := Rect.Middle(dom);
      x   := row * 44 + col * 52 + 10;
      y   := -row * 62 - col * 10;
      or1 := Point.MoveHV(mid, x, y);
      or2 := Point.MoveHV(mid, x + 52, y - 10);
    BEGIN
      VBT.Fill(v, dom, Path.Translate(v.path, or1), op := red);
      VBT.Stroke(
        v, dom, Path.Translate(v.path, or2), width := 2, op := blue);
    END Pair;
  BEGIN
    VBT.PaintRegion(v, rgn, white);
    FOR row := -2 TO 1 DO Pair(row, -2); Pair(row, 0); Pair(row, 2); END;
  END Repaint;
VAR
  main := BorderedVBT.New(
            RigidVBT.FromHV(NEW(TexasVBT).init(), 50.0, 50.0));
BEGIN
  Trestle.Install(main);
  Trestle.AwaitDelete(main);
END Draw.
</PRE>
</inModule>
<PRE>























</PRE>
</BODY>
</HTML>
